{"meta":{"title":"è·›è¶³çš„ç™»å±±è€…","subtitle":null,"description":null,"author":"xxydliuy","url":"http://www.liuyong520.cn","root":"/"},"pages":[{"title":"toc","date":"2019-04-23T09:31:21.000Z","updated":"2019-04-27T08:01:14.825Z","comments":true,"path":"java.html","permalink":"http://www.liuyong520.cn/java.html","excerpt":"","text":"æˆ‘åª³å¦‡æ˜¯ä¸ªè€è‰²é¬¼"},{"title":"åˆ†ç±»","date":"2019-04-26T14:57:26.514Z","updated":"2019-04-26T14:57:26.514Z","comments":false,"path":"categories/index.html","permalink":"http://www.liuyong520.cn/categories/index.html","excerpt":"","text":""},{"title":"ä¹¦å•","date":"2019-04-26T15:28:00.106Z","updated":"2019-04-26T15:28:00.106Z","comments":false,"path":"books/index.html","permalink":"http://www.liuyong520.cn/books/index.html","excerpt":"","text":""},{"title":"å…³äº","date":"2019-04-26T10:36:36.781Z","updated":"2019-04-26T10:36:36.781Z","comments":false,"path":"about/index.html","permalink":"http://www.liuyong520.cn/about/index.html","excerpt":"","text":"æ¬¢è¿è®¿é—®æˆ‘çš„åšå®¢ï¼Œæˆ‘ä¼šä¸å®šæœŸæ›´æ–°ï¼1234567891011121314151617181920212223242526272829303132/** * _ooOoo_ * o8888888o * 88\" . \"88 * (| -_- |) * O\\ = /O * ____/`---'\\____ * .' \\\\| |// `. * / \\\\||| : |||// \\ * / _||||| -:- |||||- \\ * | | \\\\\\ - /// | | * | \\_| ''\\---/'' | | * \\ .-\\__ `-` ___/-. / * ___`. .' /--.--\\ `. . __ * .\"\" '&lt; `.___\\_&lt;|&gt;_/___.' &gt;'\"\". * | | : `- \\`.;`\\ _ /`;.`/ - ` : | | * \\ \\ `-. \\_ __\\ /__ _/ .-` / / * ======`-.____`-.___\\_____/___.-`____.-'====== * `=---=' * ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ * ä½›ç¥–ä¿ä½‘ æ°¸æ— BUG * ä½›æ›°: * å†™å­—æ¥¼é‡Œå†™å­—é—´ï¼Œå†™å­—é—´é‡Œç¨‹åºå‘˜ï¼› * ç¨‹åºäººå‘˜å†™ç¨‹åºï¼Œåˆæ‹¿ç¨‹åºæ¢é…’é’±ã€‚ * é…’é†’åªåœ¨ç½‘ä¸Šåï¼Œé…’é†‰è¿˜æ¥ç½‘ä¸‹çœ ï¼› * é…’é†‰é…’é†’æ—¥å¤æ—¥ï¼Œç½‘ä¸Šç½‘ä¸‹å¹´å¤å¹´ã€‚ * ä½†æ„¿è€æ­»ç”µè„‘é—´ï¼Œä¸æ„¿é èº¬è€æ¿å‰ï¼› * å¥”é©°å®é©¬è´µè€…è¶£ï¼Œå…¬äº¤è‡ªè¡Œç¨‹åºå‘˜ã€‚ * åˆ«äººç¬‘æˆ‘å¿’ç–¯ç™«ï¼Œæˆ‘ç¬‘è‡ªå·±å‘½å¤ªè´±ï¼› * ä¸è§æ»¡è¡—æ¼‚äº®å¦¹ï¼Œå“ªä¸ªå½’å¾—ç¨‹åºå‘˜ï¼Ÿ*/"},{"title":"æ ‡ç­¾","date":"2019-04-26T15:24:46.349Z","updated":"2019-04-26T15:24:46.349Z","comments":false,"path":"tags/index.html","permalink":"http://www.liuyong520.cn/tags/index.html","excerpt":"","text":""},{"title":"Repositories","date":"2019-04-26T11:51:41.915Z","updated":"2019-04-26T11:51:41.915Z","comments":false,"path":"repository/index.html","permalink":"http://www.liuyong520.cn/repository/index.html","excerpt":"","text":"qwqwwwwww"},{"title":"å‹æƒ…é“¾æ¥","date":"2019-04-26T15:44:12.763Z","updated":"2019-04-26T15:44:12.763Z","comments":true,"path":"links/index.html","permalink":"http://www.liuyong520.cn/links/index.html","excerpt":"","text":""}],"posts":[{"title":"storm åŸºæœ¬çŸ¥è¯†","slug":"storm-base","date":"2019-05-02T14:00:40.000Z","updated":"2019-05-09T16:02:25.209Z","comments":true,"path":"2019/05/02/storm-base/","link":"","permalink":"http://www.liuyong520.cn/2019/05/02/storm-base/","excerpt":"","text":"å¼•è¨€ä»‹ç»stormä¹‹å‰ï¼Œæˆ‘å…ˆæŠ›å‡ºè¿™ä¸¤ä¸ªé—®é¢˜ï¼š1.å®æ—¶è®¡ç®—éœ€è¦è§£å†³äº›ä»€ä¹ˆé—®é¢˜ï¼Ÿ2.stormä½œä¸ºå®æ—¶è®¡ç®—åˆ°åº•æœ‰ä½•ä¼˜åŠ¿ï¼Ÿstormç®€ä»‹å®˜æ–¹ä»‹ç»ï¼šApache Storm is a free and open source distributed realtime computation system. Storm makes it easy to reliably process unbounded streams of data, doing for realtime processing what Hadoop did for batch processing. Storm is simple, can be used with any programming language, and is a lot of fun to use!ç¿»è¯‘ï¼šApache Stormæ˜¯ä¸€ä¸ªå…è´¹çš„å¼€æºåˆ†å¸ƒå¼å®æ—¶è®¡ç®—ç³»ç»Ÿã€‚Stormå¯ä»¥è½»æ¾å¯é åœ°å¤„ç†æ— é™æ•°æ®æµï¼Œå®æ—¶å¤„ç†Hadoopä¸ºæ‰¹å¤„ç†æ‰€åšçš„å·¥ä½œã€‚stormå¾ˆç®€å•ï¼Œå¯ä»¥ä¸ä»»ä½•ç¼–ç¨‹è¯­è¨€ä¸€èµ·ä½¿ç”¨ï¼Œå¹¶ä¸”ä½¿ç”¨èµ·æ¥å¾ˆæœ‰è¶£ï¼ç®€å•çš„è¯´å°±æ˜¯ï¼šstormæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼å®æ—¶è®¡ç®—ç³»ç»Ÿã€‚1.å®æ—¶è®¡ç®—éœ€è¦è§£å†³äº›ä»€ä¹ˆé—®é¢˜ï¼Ÿä¼´éšç€ä¿¡æ¯ç§‘æŠ€çš„æ—¥æ–°æœˆå¼‚çš„å‘å±•ï¼Œä¿¡æ¯å‘ˆç°å‡ºçˆ†å‘å¼çš„è†¨èƒ€ï¼Œäººä»¬è·å–ä¿¡æ¯çš„æ¸ é“ä¹Ÿæ›´åŠ å¤šå…ƒåŒ–ï¼Œè·å–ä¿¡æ¯çš„æ–¹å¼ä¹Ÿæ›´åŠ ä¾¿æ·ï¼Œå¯¹ä¿¡æ¯çš„å®æ•ˆæ€§ä¹Ÿè¶Šæ¥è¶Šé«˜ï¼Œä¸¾ä¸ªç”µå•†ç³»ç»Ÿä¸€ä¸ªæœç´¢çš„ç®€å•ä¾‹å­ï¼Œå½“å–å®¶å‘å¸ƒä¸€æ¡å®è´ä¿¡æ¯æ—¶ï¼Œä¹°å®¶åœ¨æœç´¢çš„æ—¶å€™éœ€è¦èƒ½å¤Ÿé©¬ä¸Šå‘ˆç°å‡ºæ¥ï¼ŒåŒæ—¶ä¹°å®¶è´­ä¹°åï¼Œèƒ½å¤Ÿéœ€è¦ç»Ÿè®¡è¯¥å•†å“çš„å–å‡ºçš„æ•°é‡ä»¥åŠè¯¥å•†å“æ€»è¥ä¸šé¢ï¼Œåˆ©æ¶¦ç­‰ç­‰ã€‚è€Œä¸”å¯ä»¥æ ¹æ®æœ€è¿‘çš„è´­ä¹°çš„è®°å½•ï¼Œå¯ä»¥ç»™ç”¨æˆ·æ¨èåŒç±»å‹çš„äº§å“ã€‚è¯¸å¦‚æ­¤ç±»çš„éƒ½éœ€è¦ä»¥å¤§æ•°æ®ä¸ºåŸºç¡€çš„ï¼Œé€šè¿‡ç¦»çº¿æˆ–è€…å®æ—¶è®¡ç®—ï¼Œè·å–ç›¸å…³çš„ä¿¡æ¯ï¼Œä»è€Œè·å¾—å•†æœºã€‚åœ¨Stormä¹‹å‰ï¼Œè¿›è¡Œå®æ—¶å¤„ç†æ˜¯éå¸¸ç—›è‹¦çš„äº‹æƒ…: éœ€è¦ç»´æŠ¤ä¸€å †æ¶ˆæ¯é˜Ÿåˆ—å’Œæ¶ˆè´¹è€…ï¼Œä»–ä»¬æ„æˆäº†éå¸¸å¤æ‚çš„å›¾ç»“æ„ã€‚æ¶ˆè´¹è€…è¿›ç¨‹ä»é˜Ÿåˆ—é‡Œå–æ¶ˆæ¯ï¼Œå¤„ç†å®Œæˆåï¼Œå»æ›´æ–°æ•°æ®åº“ï¼Œæˆ–è€…ç»™å…¶ä»–é˜Ÿåˆ—å‘æ–°æ¶ˆæ¯ã€‚è¿™æ ·è¿›è¡Œå®æ—¶å¤„ç†æ˜¯éå¸¸ç—›è‹¦çš„ã€‚æˆ‘ä»¬ä¸»è¦çš„æ—¶é—´éƒ½èŠ±åœ¨å…³æ³¨å¾€å“ªé‡Œå‘æ¶ˆæ¯ï¼Œä»å“ªé‡Œæ¥æ”¶æ¶ˆæ¯ï¼Œæ¶ˆæ¯å¦‚ä½•åºåˆ—åŒ–ï¼ŒçœŸæ­£çš„ä¸šåŠ¡é€»è¾‘åªå äº†æºä»£ç çš„ä¸€å°éƒ¨åˆ†ã€‚ä¸€ä¸ªåº”ç”¨ç¨‹åºçš„é€»è¾‘è¿è¡Œåœ¨å¾ˆå¤šworkerä¸Šï¼Œä½†è¿™äº›workeréœ€è¦å„è‡ªå•ç‹¬éƒ¨ç½²ï¼Œè¿˜éœ€è¦éƒ¨ç½²æ¶ˆæ¯é˜Ÿåˆ—ã€‚æœ€å¤§é—®é¢˜æ˜¯ç³»ç»Ÿå¾ˆè„†å¼±ï¼Œè€Œä¸”ä¸æ˜¯å®¹é”™çš„ï¼šéœ€è¦è‡ªå·±ä¿è¯æ¶ˆæ¯é˜Ÿåˆ—å’Œworkerè¿›ç¨‹å·¥ä½œæ­£å¸¸ã€‚ä¾‹å¦‚ä¸Šé¢çš„ä¾‹å­ï¼Œç®€å•çš„ç»Ÿè®¡æ•°é‡ï¼Œç»Ÿè®¡è¥ä¸šé¢ï¼Œè®¡ç®—æ¯›åˆ©æ¶¦ï¼Œæ ¹æ®è´­ä¹°è®°å½•ï¼Œæ¨èç›¸ä¼¼å•†å“ç­‰ç­‰ï¼Œå°±æ˜¯é€šè¿‡ï¼Œå¼€å¯å¤šä¸ªå·¥ä½œçº¿ç¨‹ï¼Œå®æ—¶å»æ‰«è¡¨ï¼Œæˆ–è€…æ˜¯ä»æ¶ˆæ¯å¯¹åˆ—ä¸­æ‹¿å‡ºæ•°æ®ï¼Œè®¡ç®—ç»Ÿè®¡å€¼ï¼Œå†™å…¥å¯¹åº”çš„è¡¨ã€‚è¿™ç§å®šæ—¶ä»»åŠ¡ï¼Œå¾€å¾€æ•°æ®å¤„ç†ä¹Ÿä¸å¤ŸåŠæ—¶ï¼Œå®æ•ˆæ€§æ¯”è¾ƒå·®ã€‚2.å®æ—¶è®¡ç®—ç³»ç»Ÿè¦è€ƒè™‘å“ªäº›é—®é¢˜ï¼Ÿä½å»¶è¿Ÿ å¤„ç†æ¶ˆæ¯ä¸€å®šè¦åŠæ—¶ï¼Œå»¶è¿Ÿé«˜å°±ä¸å«å®æ—¶äº†ã€‚é«˜æ€§èƒ½ æ€§èƒ½ä¸é«˜ï¼Œé‚£ä¹ˆå°±è¦æµªè´¹æœºå™¨ï¼Œè¿™æ ·æµªè´¹æœºå™¨å°±æ˜¯æµªè´¹èµ„æºåˆ†å¸ƒå¼ ç³»ç»Ÿæ•°æ®å’Œæ¥æºå¯èƒ½æœ‰å¤šä¸ªï¼Œå¤„ç†æ•°æ®ç»“æœä¹Ÿæœ‰å¯èƒ½ä½œä¸ºåŸºç¡€æ•°æ®ç»™å…¶ä»–ç³»ç»Ÿã€‚å¦‚æœä½ çš„ç³»ç»Ÿåº”ç”¨å•æœºå°±èƒ½æå®šï¼Œé‚£ä¹ˆä¸éœ€è¦è€ƒè™‘è¿™ä¹ˆå¤æ‚äº†ï¼Œå®æ—¶è®¡ç®—ç³»ç»Ÿå°±æ˜¯ä¸ºäº†è§£å†³è¿™ç§å•æœºç³»ç»Ÿæ— æ³•è§£å†³çš„é—®é¢˜çš„ã€‚å¯æ‰©å±• ä¼´éšä¸šåŠ¡çš„çš„å‘å±•ï¼Œæˆ‘ä»¬çš„ä¸šåŠ¡é‡ï¼ŒåŠè®¡ç®—é‡å¯èƒ½ä¼šè¶Šæ¥è¶Šå¤§ï¼Œç³»ç»Ÿæ˜¯è¦æ±‚å¯ä»¥æ‰©å±•çš„ï¼Œå®¹é”™æ€§ è¿™ä¸ªæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿçš„é€šç”¨é—®é¢˜äº†ï¼Œä¸€ä¸ªèŠ‚ç‚¹æŒ‚äº†ï¼Œä¸èƒ½å½±å“åˆ°æ•´ä¸ªç³»ç»Ÿã€‚3.stormçš„ä¼˜åŠ¿ç®€å•çš„ç¼–ç¨‹æ¨¡å‹ã€‚ç±»ä¼¼äºMapReduceé™ä½äº†æ‰¹å¤„ç†çš„å¤æ‚æ€§ï¼Œstormé™ä½äº†è¿›è¡Œå®æ—¶å¤„ç†çš„å¤æ‚æ€§æœåŠ¡åŒ–ï¼Œä¸€ä¸ªæœåŠ¡æ¡†æ¶ï¼Œæ”¯æŒçƒ­éƒ¨ç½²ï¼Œå³æ—¶ä¸Šçº¿æˆ–è€…ä¸‹çº¿appæ”¯æŒå¤šç§è¯­è¨€ï¼Œä½ å¯ä»¥åœ¨stormä¹‹ä¸Šä½¿ç”¨å„ç§ç¼–ç¨‹è¯­è¨€ï¼Œé»˜è®¤æ”¯æŒçš„æœ‰clojure,java,ruby,pythonå®¹é”™æ€§ï¼Œstormä¼šç®¡ç†å·¥ä½œè¿›ç¨‹å’ŒèŠ‚ç‚¹æ•…éšœæ°´å¹³æ‰©å±•æ€§ï¼Œè®¡ç®—æ˜¯åœ¨å¤šä¸ªç³»ç»Ÿã€è¿›ç¨‹ã€æœåŠ¡å™¨ä¹‹é—´è¿›è¡Œçš„ã€‚å¯ä»¥æ°´å¹³æ‰©å±•æœºå™¨ï¼Œè¿›ç¨‹ï¼Œæˆ–è€…çº¿ç¨‹ç­‰ã€‚å¯é çš„æ¶ˆæ¯å¤„ç† storm èƒ½å¤Ÿä¿è¯æ¶ˆæ¯è‡³å°‘èƒ½å¤Ÿå¾—åˆ°ä¸€æ¬¡å®Œæ•´çš„æ¶ˆæ¯å¤„ç†ã€‚ä»»åŠ¡å¤±è´¥æ—¶ï¼Œå®ƒä¼šè´Ÿè´£ä»æ¶ˆæ¯æºå¤´é‡æ–°å¤„ç†ã€‚å¿«é€Ÿ ç³»ç»Ÿçš„è®¾è®¡ä¿è¯æ¶ˆæ¯çš„å¿«é€Ÿå¤„ç†ï¼Œä½ç‰ˆæœ¬çš„stormä½¿ç”¨çš„zeroMQä½œä¸ºå†…éƒ¨æ¶ˆæ¯ç³»ç»Ÿã€‚é«˜ç‰ˆæœ¬ä¸­ä½¿ç”¨nettyå®Œå…¨æ›¿ä»£äº†ZeroMQä½œä¸ºå†…éƒ¨æ¶ˆæ¯ç³»ç»Ÿæœ¬åœ°æ¨¡å¼ storm åˆä¸€ä¸ªæœ¬åœ°æ¨¡å¼ï¼Œèƒ½å¤Ÿæ¨¡æ‹Ÿé›†ç¾¤ï¼Œä½¿æˆ‘ä»¬çš„å¼€å‘æµ‹è¯•å˜å¾—æ›´åŠ ç®€å•ã€‚stormçš„åŸºæœ¬æ¦‚å¿µæ‹“æ‰‘(Topologies)å®æ—¶åº”ç”¨ç¨‹åºçš„é€»è¾‘è¢«æ‰“åŒ…åˆ°Stormæ‹“æ‰‘ä¸­ã€‚Stormæ‹“æ‰‘ç±»ä¼¼äºMapReduceä½œä¸šã€‚ä¸€ä¸ªå…³é”®çš„åŒºåˆ«æ˜¯MapReduceä½œä¸šæœ€ç»ˆå®Œæˆï¼Œè€Œæ‹“æ‰‘ç»“æ„æ°¸è¿œè¿è¡Œï¼ˆå½“ç„¶ï¼Œç›´åˆ°ä½ æ€æ­»å®ƒï¼‰ã€‚ä¸ªæ‹“æ‰‘æ˜¯ä¸€ä¸ªé€šè¿‡æµåˆ†ç»„(stream grouping)æŠŠSpoutå’ŒBoltè¿æ¥åˆ°ä¸€èµ·çš„æ‹“æ‰‘ç»“æ„ã€‚å›¾çš„æ¯æ¡è¾¹ä»£è¡¨ä¸€ä¸ªBoltè®¢é˜…äº†å…¶ä»–Spoutæˆ–è€…Boltçš„è¾“å‡ºæµã€‚ä¸€ä¸ªæ‹“æ‰‘å°±æ˜¯ä¸€ä¸ªå¤æ‚çš„å¤šé˜¶æ®µçš„æµè®¡ç®—ã€‚å…ƒç»„(Tuple)å…ƒç»„æ˜¯Stormæä¾›çš„ä¸€ä¸ªè½»é‡çº§çš„æ•°æ®æ ¼å¼ï¼Œå¯ä»¥ç”¨æ¥åŒ…è£…ä½ éœ€è¦å®é™…å¤„ç†çš„æ•°æ®ã€‚å…ƒç»„æ˜¯ä¸€æ¬¡æ¶ˆæ¯ä¼ é€’çš„åŸºæœ¬å•å…ƒã€‚ä¸€ä¸ªå…ƒç»„æ˜¯ä¸€ä¸ªå‘½åçš„å€¼åˆ—è¡¨ï¼Œå…¶ä¸­çš„æ¯ä¸ªå€¼éƒ½å¯ä»¥æ˜¯ä»»æ„ç±»å‹çš„ã€‚å…ƒç»„æ˜¯åŠ¨æ€åœ°è¿›è¡Œç±»å‹è½¬åŒ–çš„â€“å­—æ®µçš„ç±»å‹ä¸éœ€è¦äº‹å…ˆå£°æ˜ã€‚åœ¨Stormä¸­ç¼–ç¨‹æ—¶ï¼Œå°±æ˜¯åœ¨æ“ä½œå’Œè½¬æ¢ç”±å…ƒç»„ç»„æˆçš„æµã€‚é€šå¸¸ï¼Œå…ƒç»„åŒ…å«æ•´æ•°ï¼Œå­—èŠ‚ï¼Œå­—ç¬¦ä¸²ï¼Œæµ®ç‚¹æ•°ï¼Œå¸ƒå°”å€¼å’Œå­—èŠ‚æ•°ç»„ç­‰ç±»å‹ã€‚è¦æƒ³åœ¨å…ƒç»„ä¸­ä½¿ç”¨è‡ªå®šä¹‰ç±»å‹ï¼Œå°±éœ€è¦å®ç°è‡ªå·±çš„åºåˆ—åŒ–æ–¹å¼ã€‚æµ(Streams)æµæ˜¯Stormä¸­çš„æ ¸å¿ƒæŠ½è±¡ã€‚ä¸€ä¸ªæµç”±æ— é™çš„å…ƒç»„åºåˆ—ç»„æˆï¼Œè¿™äº›å…ƒç»„ä¼šè¢«åˆ†å¸ƒå¼å¹¶è¡Œåœ°åˆ›å»ºå’Œå¤„ç†ã€‚é€šè¿‡æµä¸­å…ƒç»„åŒ…å«çš„å­—æ®µåç§°æ¥å®šä¹‰è¿™ä¸ªæµã€‚æ¯ä¸ªæµå£°æ˜æ—¶éƒ½è¢«èµ‹äºˆäº†ä¸€ä¸ªIDã€‚åªæœ‰ä¸€ä¸ªæµçš„Spoutå’ŒBoltéå¸¸å¸¸è§ï¼Œæ‰€ä»¥OutputFieldsDeclareræä¾›äº†ä¸éœ€è¦æŒ‡å®šIDæ¥å£°æ˜ä¸€ä¸ªæµçš„å‡½æ•°(Spoutå’ŒBoltéƒ½éœ€è¦å£°æ˜è¾“å‡ºçš„æµ)ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œæµçš„IDæ˜¯é»˜è®¤çš„â€œdefaultâ€ã€‚Spouts(å–·å˜´)Spout(å–·å˜´ï¼Œè¿™ä¸ªåå­—å¾ˆå½¢è±¡)æ˜¯Stormä¸­æµçš„æ¥æºã€‚é€šå¸¸Spoutä»å¤–éƒ¨æ•°æ®æºï¼Œå¦‚æ¶ˆæ¯é˜Ÿåˆ—ä¸­è¯»å–å…ƒç»„æ•°æ®å¹¶ååˆ°æ‹“æ‰‘é‡Œã€‚Spoutå¯ä»¥æ˜¯å¯é çš„(reliable)æˆ–è€…ä¸å¯é (unreliable)çš„ã€‚å¯é çš„Spoutèƒ½å¤Ÿåœ¨ä¸€ä¸ªå…ƒç»„è¢«Stormå¤„ç†å¤±è´¥æ—¶é‡æ–°è¿›è¡Œå¤„ç†ï¼Œè€Œéå¯é çš„Spoutåªæ˜¯åæ•°æ®åˆ°æ‹“æ‰‘é‡Œï¼Œä¸å…³å¿ƒå¤„ç†æˆåŠŸè¿˜æ˜¯å¤±è´¥äº†ã€‚Spoutå¯ä»¥ä¸€æ¬¡ç»™å¤šä¸ªæµåæ•°æ®ã€‚æ­¤æ—¶éœ€è¦é€šè¿‡OutputFieldsDeclarerçš„declareStreamå‡½æ•°æ¥å£°æ˜å¤šä¸ªæµå¹¶åœ¨è°ƒç”¨SpoutOutputCollectoræä¾›çš„emitæ–¹æ³•æ—¶æŒ‡å®šå…ƒç»„åç»™å“ªä¸ªæµã€‚Spoutä¸­æœ€ä¸»è¦çš„å‡½æ•°æ˜¯nextTupleï¼ŒStormæ¡†æ¶ä¼šä¸æ–­è°ƒç”¨å®ƒå»åšå…ƒç»„çš„è½®è¯¢ã€‚å¦‚æœæ²¡æœ‰æ–°çš„å…ƒç»„è¿‡æ¥ï¼Œå°±ç›´æ¥è¿”å›ï¼Œå¦åˆ™æŠŠæ–°å…ƒç»„ååˆ°æ‹“æ‰‘é‡Œã€‚nextTupleå¿…é¡»æ˜¯éé˜»å¡çš„ï¼Œå› ä¸ºStormåœ¨åŒä¸€ä¸ªçº¿ç¨‹é‡Œæ‰§è¡ŒSpoutçš„å‡½æ•°ã€‚Spoutä¸­å¦å¤–ä¸¤ä¸ªä¸»è¦çš„å‡½æ•°æ˜¯ackå’Œfailã€‚å½“Stormæ£€æµ‹åˆ°ä¸€ä¸ªä»Spoutåå‡ºçš„å…ƒç»„åœ¨æ‹“æ‰‘ä¸­æˆåŠŸå¤„ç†å®Œæ—¶è°ƒç”¨ack,æ²¡æœ‰æˆåŠŸå¤„ç†å®Œæ—¶è°ƒç”¨failã€‚åªæœ‰å¯é å‹çš„Spoutä¼šè°ƒç”¨ackå’Œfailå‡½æ•°ã€‚Boltsåœ¨æ‹“æ‰‘ä¸­æ‰€æœ‰çš„è®¡ç®—é€»è¾‘éƒ½æ˜¯åœ¨Boltä¸­å®ç°çš„ã€‚ä¸€ä¸ªBoltå¯ä»¥å¤„ç†ä»»æ„æ•°é‡çš„è¾“å…¥æµï¼Œäº§ç”Ÿä»»æ„æ•°é‡æ–°çš„è¾“å‡ºæµã€‚Boltå¯ä»¥åšå‡½æ•°å¤„ç†ï¼Œè¿‡æ»¤ï¼Œæµçš„åˆå¹¶ï¼Œèšåˆï¼Œå­˜å‚¨åˆ°æ•°æ®åº“ç­‰æ“ä½œã€‚Boltå°±æ˜¯æµæ°´çº¿ä¸Šçš„ä¸€ä¸ªå¤„ç†å•å…ƒï¼ŒæŠŠæ•°æ®çš„è®¡ç®—å¤„ç†è¿‡ç¨‹åˆç†çš„æ‹†åˆ†åˆ°å¤šä¸ªBoltã€åˆç†è®¾ç½®Boltçš„taskæ•°é‡ï¼Œèƒ½å¤Ÿæé«˜Boltçš„å¤„ç†èƒ½åŠ›ï¼Œæå‡æµæ°´çº¿çš„å¹¶å‘åº¦ã€‚Boltå¯ä»¥ç»™å¤šä¸ªæµåå‡ºå…ƒç»„æ•°æ®ã€‚æ­¤æ—¶éœ€è¦ä½¿ç”¨OutputFieldsDeclarerçš„declareStreamæ–¹æ³•æ¥å£°æ˜å¤šä¸ªæµå¹¶åœ¨ä½¿ç”¨OutputColletorçš„emitæ–¹æ³•æ—¶æŒ‡å®šç»™å“ªä¸ªæµåæ•°æ®ã€‚å½“ä½ å£°æ˜äº†ä¸€ä¸ªBoltçš„è¾“å…¥æµï¼Œä¹Ÿå°±è®¢é˜…äº†å¦å¤–ä¸€ä¸ªç»„ä»¶çš„æŸä¸ªç‰¹å®šçš„è¾“å‡ºæµã€‚å¦‚æœå¸Œæœ›è®¢é˜…å¦ä¸€ä¸ªç»„ä»¶çš„æ‰€æœ‰æµï¼Œéœ€è¦å•ç‹¬æŒ¨ä¸ªè®¢é˜…ã€‚InputDeclareræœ‰è¯­æ³•ç³–æ¥è®¢é˜…IDä¸ºé»˜è®¤å€¼çš„æµã€‚ä¾‹å¦‚declarer.shuffleGrouping(â€œredBoltâ€)è®¢é˜…äº†redBoltç»„ä»¶ä¸Šçš„é»˜è®¤æµï¼Œè·Ÿdeclarer.shuffleGrouping(â€œredBoltâ€, DEFAULT_STREAM_ID)æ˜¯ç›¸åŒçš„ã€‚åœ¨Boltä¸­æœ€ä¸»è¦çš„å‡½æ•°æ˜¯executeå‡½æ•°ï¼Œå®ƒä½¿ç”¨ä¸€ä¸ªæ–°çš„å…ƒç»„å½“ä½œè¾“å…¥ã€‚Boltä½¿ç”¨OutputCollectorå¯¹è±¡æ¥åå‡ºæ–°çš„å…ƒç»„ã€‚Boltså¿…é¡»ä¸ºå¤„ç†çš„æ¯ä¸ªå…ƒç»„è°ƒç”¨OutputCollectorçš„ackæ–¹æ³•ä»¥ä¾¿äºStormçŸ¥é“å…ƒç»„ä»€ä¹ˆæ—¶å€™è¢«å„ä¸ªBoltå¤„ç†å®Œäº†ï¼ˆæœ€ç»ˆå°±å¯ä»¥ç¡®è®¤Spoutåå‡ºçš„æŸä¸ªå…ƒç»„å¤„ç†å®Œäº†ï¼‰ã€‚é€šå¸¸å¤„ç†ä¸€ä¸ªè¾“å…¥çš„å…ƒç»„æ—¶ï¼Œä¼šåŸºäºè¿™ä¸ªå…ƒç»„åå‡ºé›¶ä¸ªæˆ–è€…å¤šä¸ªå…ƒç»„ï¼Œç„¶åç¡®è®¤(ack)è¾“å…¥çš„å…ƒç»„å¤„ç†å®Œäº†ï¼ŒStormæä¾›äº†IBasicBoltæ¥å£æ¥è‡ªåŠ¨å®Œæˆç¡®è®¤ã€‚å¿…é¡»æ³¨æ„OutputCollectorä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæ‰€ä»¥æ‰€æœ‰çš„åæ•°æ®(emit)ã€ç¡®è®¤(ack)ã€é€šçŸ¥å¤±è´¥(fail)å¿…é¡»å‘ç”Ÿåœ¨åŒä¸€ä¸ªçº¿ç¨‹é‡Œä»»åŠ¡(Tasks)æ¯ä¸ªSpoutå’ŒBoltä¼šä»¥å¤šä¸ªä»»åŠ¡(Task)çš„å½¢å¼åœ¨é›†ç¾¤ä¸Šè¿è¡Œã€‚æ¯ä¸ªä»»åŠ¡å¯¹åº”ä¸€ä¸ªæ‰§è¡Œçº¿ç¨‹ï¼Œæµåˆ†ç»„å®šä¹‰äº†å¦‚ä½•ä»ä¸€ç»„ä»»åŠ¡(åŒä¸€ä¸ªBolt)å‘é€å…ƒç»„åˆ°å¦å¤–ä¸€ç»„ä»»åŠ¡(å¦å¤–ä¸€ä¸ªBolt)ä¸Šã€‚å¯ä»¥åœ¨è°ƒç”¨TopologyBuilderçš„setSpoutå’ŒsetBoltå‡½æ•°æ—¶è®¾ç½®æ¯ä¸ªSpoutå’ŒBoltçš„å¹¶å‘æ•°ã€‚ç»„ä»¶(Component)ç»„ä»¶(component)æ˜¯å¯¹Boltå’ŒSpoutçš„ç»Ÿç§°æµåˆ†ç»„(Stream groupings)å®šä¹‰æ‹“æ‰‘çš„æ—¶å€™ï¼Œä¸€éƒ¨åˆ†å·¥ä½œæ˜¯æŒ‡å®šæ¯ä¸ªBoltåº”è¯¥æ¶ˆè´¹å“ªäº›æµã€‚æµåˆ†ç»„å®šä¹‰äº†ä¸€ä¸ªæµåœ¨ä¸€ä¸ªæ¶ˆè´¹å®ƒçš„Boltå†…çš„å¤šä¸ªä»»åŠ¡(task)ä¹‹é—´å¦‚ä½•åˆ†ç»„ã€‚æµåˆ†ç»„è·Ÿè®¡ç®—æœºç½‘ç»œä¸­çš„è·¯ç”±åŠŸèƒ½æ˜¯ç±»ä¼¼çš„ï¼Œå†³å®šäº†æ¯ä¸ªå…ƒç»„åœ¨æ‹“æ‰‘ä¸­çš„å¤„ç†è·¯çº¿ã€‚åœ¨Stormä¸­æœ‰ä¸ƒä¸ªå†…ç½®çš„æµåˆ†ç»„ç­–ç•¥ï¼Œä½ ä¹Ÿå¯ä»¥é€šè¿‡å®ç°CustomStreamGroupingæ¥å£æ¥è‡ªå®šä¹‰ä¸€ä¸ªæµåˆ†ç»„ç­–ç•¥:æ´—ç‰Œåˆ†ç»„(Shuffle grouping): éšæœºåˆ†é…å…ƒç»„åˆ°Boltçš„æŸä¸ªä»»åŠ¡ä¸Šï¼Œè¿™æ ·ä¿è¯åŒä¸€ä¸ªBoltçš„æ¯ä¸ªä»»åŠ¡éƒ½èƒ½å¤Ÿå¾—åˆ°ç›¸åŒæ•°é‡çš„å…ƒç»„ã€‚å­—æ®µåˆ†ç»„(Fields grouping): æŒ‰ç…§æŒ‡å®šçš„åˆ†ç»„å­—æ®µæ¥è¿›è¡Œæµçš„åˆ†ç»„ã€‚ä¾‹å¦‚ï¼Œæµæ˜¯ç”¨å­—æ®µâ€œuser-idâ€æ¥åˆ†ç»„çš„ï¼Œé‚£æœ‰ç€ç›¸åŒâ€œuser-idâ€çš„å…ƒç»„å°±ä¼šåˆ†åˆ°åŒä¸€ä¸ªä»»åŠ¡é‡Œï¼Œä½†æ˜¯æœ‰ä¸åŒâ€œuser-idâ€çš„å…ƒç»„å°±ä¼šåˆ†åˆ°ä¸åŒçš„ä»»åŠ¡é‡Œã€‚è¿™æ˜¯ä¸€ç§éå¸¸é‡è¦çš„åˆ†ç»„æ–¹å¼ï¼Œé€šè¿‡è¿™ç§æµåˆ†ç»„æ–¹å¼ï¼Œæˆ‘ä»¬å°±å¯ä»¥åšåˆ°è®©Stormäº§å‡ºçš„æ¶ˆæ¯åœ¨è¿™ä¸ªâ€user-idâ€çº§åˆ«æ˜¯ä¸¥æ ¼æœ‰åºçš„ï¼Œè¿™å¯¹ä¸€äº›å¯¹æ—¶åºæ•æ„Ÿçš„åº”ç”¨(ä¾‹å¦‚ï¼Œè®¡è´¹ç³»ç»Ÿ)æ˜¯éå¸¸é‡è¦çš„ã€‚Partial Key grouping: è·Ÿå­—æ®µåˆ†ç»„ä¸€æ ·ï¼Œæµä¹Ÿæ˜¯ç”¨æŒ‡å®šçš„åˆ†ç»„å­—æ®µè¿›è¡Œåˆ†ç»„çš„ï¼Œä½†æ˜¯åœ¨å¤šä¸ªä¸‹æ¸¸Boltä¹‹é—´æ˜¯æœ‰è´Ÿè½½å‡è¡¡çš„ï¼Œè¿™æ ·å½“è¾“å…¥æ•°æ®æœ‰å€¾æ–œæ—¶å¯ä»¥æ›´å¥½çš„åˆ©ç”¨èµ„æºã€‚è¿™ç¯‡è®ºæ–‡å¾ˆå¥½çš„è§£é‡Šäº†è¿™æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œæœ‰å“ªäº›ä¼˜åŠ¿ã€‚All grouping: æµä¼šå¤åˆ¶ç»™Boltçš„æ‰€æœ‰ä»»åŠ¡ã€‚å°å¿ƒä½¿ç”¨è¿™ç§åˆ†ç»„æ–¹å¼ã€‚åœ¨æ‹“æ‰‘ä¸­ï¼Œå¦‚æœå¸Œæœ›æŸç±»å…ƒç¥–å‘é€åˆ°æ‰€æœ‰çš„ä¸‹æ¸¸æ¶ˆè´¹è€…ï¼Œå°±å¯ä»¥ä½¿ç”¨è¿™ç§All groupingçš„æµåˆ†ç»„ç­–ç•¥ã€‚Global grouping: æ•´ä¸ªæµä¼šåˆ†é…ç»™Boltçš„ä¸€ä¸ªä»»åŠ¡ã€‚å…·ä½“ä¸€ç‚¹ï¼Œä¼šåˆ†é…ç»™æœ‰æœ€å°IDçš„ä»»åŠ¡ã€‚ä¸åˆ†ç»„(None grouping): è¯´æ˜ä¸å…³å¿ƒæµæ˜¯å¦‚ä½•åˆ†ç»„çš„ã€‚ç›®å‰ï¼ŒNone groupingç­‰ä»·äºæ´—ç‰Œåˆ†ç»„ã€‚Direct groupingï¼šä¸€ç§ç‰¹æ®Šçš„åˆ†ç»„ã€‚å¯¹äºè¿™æ ·åˆ†ç»„çš„æµï¼Œå…ƒç»„çš„ç”Ÿäº§è€…å†³å®šæ¶ˆè´¹è€…çš„å“ªä¸ªä»»åŠ¡ä¼šæ¥æ”¶å¤„ç†è¿™ä¸ªå…ƒç»„ã€‚åªèƒ½åœ¨å£°æ˜åšç›´è¿çš„æµ(direct streams)ä¸Šå£°æ˜Direct groupingsåˆ†ç»„æ–¹å¼ã€‚åªèƒ½é€šè¿‡ä½¿ç”¨emitDirectç³»åˆ—å‡½æ•°æ¥åå…ƒç»„ç»™ç›´è¿æµã€‚ä¸€ä¸ªBoltå¯ä»¥é€šè¿‡æä¾›çš„TopologyContextæ¥è·å¾—æ¶ˆè´¹è€…çš„ä»»åŠ¡IDï¼Œä¹Ÿå¯ä»¥é€šè¿‡OutputCollectorå¯¹è±¡çš„emitå‡½æ•°(ä¼šè¿”å›å…ƒç»„è¢«å‘é€åˆ°çš„ä»»åŠ¡çš„ID)æ¥è·Ÿè¸ªæ¶ˆè´¹è€…çš„ä»»åŠ¡IDã€‚åœ¨ackçš„å®ç°ä¸­ï¼ŒSpoutæœ‰ä¸¤ä¸ªç›´è¿è¾“å…¥æµï¼Œackå’ŒackFailï¼Œä½¿ç”¨äº†è¿™ç§ç›´è¿åˆ†ç»„çš„æ–¹å¼ã€‚Local or shuffle groupingï¼šå¦‚æœç›®æ ‡Boltåœ¨åŒä¸€ä¸ªworkerè¿›ç¨‹é‡Œæœ‰ä¸€ä¸ªæˆ–å¤šä¸ªä»»åŠ¡ï¼Œå…ƒç»„å°±ä¼šé€šè¿‡æ´—ç‰Œçš„æ–¹å¼åˆ†é…åˆ°è¿™äº›åŒä¸€ä¸ªè¿›ç¨‹å†…çš„ä»»åŠ¡é‡Œã€‚å¦åˆ™ï¼Œå°±è·Ÿæ™®é€šçš„æ´—ç‰Œåˆ†ç»„ä¸€æ ·ã€‚è¿™ç§æ–¹å¼çš„å¥½å¤„æ˜¯å¯ä»¥æé«˜æ‹“æ‰‘çš„å¤„ç†æ•ˆç‡ï¼Œå› ä¸ºworkerå†…éƒ¨é€šä¿¡å°±æ˜¯è¿›ç¨‹å†…éƒ¨é€šä¿¡äº†ï¼Œç›¸æ¯”æ‹“æ‰‘é—´çš„è¿›ç¨‹é—´é€šä¿¡è¦é«˜æ•ˆçš„å¤šã€‚workerè¿›ç¨‹é—´é€šä¿¡æ˜¯é€šè¿‡ä½¿ç”¨Nettyæ¥è¿›è¡Œç½‘ç»œé€šä¿¡çš„ã€‚å¯é æ€§(Reliability)Stormä¿è¯äº†æ‹“æ‰‘ä¸­Spoutäº§ç”Ÿçš„æ¯ä¸ªå…ƒç»„éƒ½ä¼šè¢«å¤„ç†ã€‚Stormæ˜¯é€šè¿‡è·Ÿè¸ªæ¯ä¸ªSpoutæ‰€äº§ç”Ÿçš„æ‰€æœ‰å…ƒç»„æ„æˆçš„æ ‘å½¢ç»“æ„å¹¶å¾—çŸ¥è¿™æ£µæ ‘ä½•æ—¶è¢«å®Œæ•´åœ°å¤„ç†æ¥è¾¾åˆ°å¯é æ€§ã€‚æ¯ä¸ªæ‹“æ‰‘å¯¹è¿™äº›æ ‘å½¢ç»“æ„éƒ½æœ‰ä¸€ä¸ªå…³è”çš„â€œæ¶ˆæ¯è¶…æ—¶â€ã€‚å¦‚æœåœ¨è¿™ä¸ªè¶…æ—¶æ—¶é—´é‡ŒStormæ£€æµ‹åˆ°Spoutäº§ç”Ÿçš„ä¸€ä¸ªå…ƒç»„æ²¡æœ‰è¢«æˆåŠŸå¤„ç†å®Œï¼Œé‚£Sputçš„è¿™ä¸ªå…ƒç»„å°±å¤„ç†å¤±è´¥äº†ï¼Œåç»­ä¼šé‡æ–°å¤„ç†ä¸€éã€‚ä¸ºäº†å‘æŒ¥Stormçš„å¯é æ€§ï¼Œéœ€è¦ä½ åœ¨åˆ›å»ºä¸€ä¸ªå…ƒç»„æ ‘ä¸­çš„ä¸€æ¡è¾¹æ—¶å‘Šè¯‰Stormï¼Œä¹Ÿéœ€è¦åœ¨å¤„ç†å®Œæ¯ä¸ªå…ƒç»„ä¹‹åå‘Šè¯‰Stormã€‚è¿™äº›éƒ½æ˜¯é€šè¿‡Boltåå…ƒç»„æ•°æ®ç”¨çš„OutputCollectorå¯¹è±¡æ¥å®Œæˆçš„ã€‚æ ‡è®°æ˜¯åœ¨emitå‡½æ•°é‡Œå®Œæˆï¼Œå®Œæˆä¸€ä¸ªå…ƒç»„åéœ€è¦ä½¿ç”¨ackå‡½æ•°æ¥å‘Šè¯‰Stormã€‚Workers(å·¥ä½œè¿›ç¨‹)æ‹“æ‰‘ä»¥ä¸€ä¸ªæˆ–å¤šä¸ªWorkerè¿›ç¨‹çš„æ–¹å¼è¿è¡Œã€‚æ¯ä¸ªWorkerè¿›ç¨‹æ˜¯ä¸€ä¸ªç‰©ç†çš„Javaè™šæ‹Ÿæœºï¼Œæ‰§è¡Œæ‹“æ‰‘çš„ä¸€éƒ¨åˆ†ä»»åŠ¡ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‹“æ‰‘çš„å¹¶å‘è®¾ç½®æˆäº†300ï¼Œåˆ†é…äº†50ä¸ªWorkerï¼Œé‚£ä¹ˆæ¯ä¸ªWorkeræ‰§è¡Œ6ä¸ªä»»åŠ¡(ä½œä¸ºWorkerå†…éƒ¨çš„çº¿ç¨‹ï¼‰ã€‚Stormä¼šå°½é‡æŠŠæ‰€æœ‰çš„ä»»åŠ¡å‡åˆ†åˆ°æ‰€æœ‰çš„Workerä¸Šã€‚stormçš„å·¥ä½œæµç¨‹Stormå®ç°äº†ä¸€ä¸ªæ•°æ®æµ(data flow)çš„æ¨¡å‹ï¼Œåœ¨è¿™ä¸ªæ¨¡å‹ä¸­æ•°æ®æŒç»­ä¸æ–­åœ°æµç»ä¸€ä¸ªç”±å¾ˆå¤šè½¬æ¢å®ä½“æ„æˆçš„ç½‘ç»œã€‚ä¸€ä¸ªæ•°æ®æµçš„æŠ½è±¡å«åšæµ(stream)ï¼Œæµæ˜¯æ— é™çš„å…ƒç»„(Tuple)åºåˆ—ã€‚å…ƒç»„å°±åƒä¸€ä¸ªå¯ä»¥è¡¨ç¤ºæ ‡å‡†æ•°æ®ç±»å‹ï¼ˆä¾‹å¦‚intï¼Œfloatå’Œbyteæ•°ç»„ï¼‰å’Œç”¨æˆ·è‡ªå®šä¹‰ç±»å‹ï¼ˆéœ€è¦é¢å¤–åºåˆ—åŒ–ä»£ç çš„ï¼‰çš„æ•°æ®ç»“æ„ã€‚æ¯ä¸ªæµç”±ä¸€ä¸ªå”¯ä¸€çš„IDæ¥æ ‡ç¤ºçš„ï¼Œè¿™ä¸ªIDå¯ä»¥ç”¨æ¥æ„å»ºæ‹“æ‰‘ä¸­å„ä¸ªç»„ä»¶çš„æ•°æ®æºã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå…¶ä¸­çš„æ°´é¾™å¤´ä»£è¡¨äº†æ•°æ®æµçš„æ¥æºï¼Œä¸€æ—¦æ°´é¾™å¤´æ‰“å¼€ï¼Œæ•°æ®å°±ä¼šæºæºä¸æ–­åœ°æµç»Boltè€Œè¢«å¤„ç†ã€‚å›¾ä¸­æœ‰ä¸‰ä¸ªæµï¼Œç”¨ä¸åŒçš„é¢œè‰²æ¥è¡¨ç¤ºï¼Œæ¯ä¸ªæ•°æ®æµä¸­æµåŠ¨çš„æ˜¯å…ƒç»„(Tuple)ï¼Œå®ƒæ‰¿è½½äº†å…·ä½“çš„æ•°æ®ã€‚å…ƒç»„é€šè¿‡æµç»ä¸åŒçš„è½¬æ¢å®ä½“è€Œè¢«å¤„ç†ã€‚Stormå¯¹æ•°æ®è¾“å…¥çš„æ¥æºå’Œè¾“å‡ºæ•°æ®çš„å»å‘æ²¡æœ‰åšä»»ä½•é™åˆ¶ã€‚åƒHadoopï¼Œæ˜¯éœ€è¦æŠŠæ•°æ®æ”¾åˆ°è‡ªå·±çš„æ–‡ä»¶ç³»ç»ŸHDFSé‡Œçš„ã€‚åœ¨Stormé‡Œï¼Œå¯ä»¥ä½¿ç”¨ä»»æ„æ¥æºçš„æ•°æ®è¾“å…¥å’Œä»»æ„çš„æ•°æ®è¾“å‡ºï¼Œåªè¦ä½ å®ç°å¯¹åº”çš„ä»£ç æ¥è·å–/å†™å…¥è¿™äº›æ•°æ®å°±å¯ä»¥ã€‚å…¸å‹åœºæ™¯ä¸‹ï¼Œè¾“å…¥/è¾“å‡ºæ•°æ®æ¥æ˜¯åŸºäºç±»ä¼¼Kafkaæˆ–è€…ActiveMQè¿™æ ·çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œä½†æ˜¯æ•°æ®åº“ï¼Œæ–‡ä»¶ç³»ç»Ÿæˆ–è€…webæœåŠ¡ä¹Ÿéƒ½æ˜¯å¯ä»¥çš„ã€‚å¦‚å›¾ï¼šstorm æµ‹è¯•ç”¨ä¾‹å¹¶è¿è¡Œå¾€å¾€æˆ‘åœ¨å­¦ä¹ è¿™äº›å¼€æºæ¡†æ¶çš„æ—¶å€™ï¼ŒæŸ¥çœ‹å®˜æ–¹æ–‡æ¡£å’Œæºç ä¸­çš„ä¾‹å­æ˜¯å…¥é—¨ä¸Šæ‰‹æ¯”è¾ƒå¿«çš„ä¸€ç§æ–¹å¼ã€‚è¿™é‡Œæˆ‘ä¹Ÿæ˜¯ä»å®˜æ–¹æ–‡æ¡£å’Œgithubä¸Šçš„ä»£ç å…¥æ‰‹çš„1.clone ä¸‹æ¥1.2.2çš„æºç 1git clone --branch v1.2.2 https://github.com/apache/storm.git2.è¿›å…¥examplesç›®å½•ä¸‹æœ‰å¾ˆå¤šä¾‹å­ï¼Œå¦‚storm-starterè¿™ä¸ªé¡¹ç›®ã€‚åŒæ—¶åœ¨githubä¸Šè¿›å…¥è¿™ä¸ªä¾‹å­çš„ç›®å½•ä¸‹æœ‰README.mdæ–‡ä»¶ï¼Œä»‹ç»å¦‚ä½•è¿è¡Œæˆ‘ä»¬çš„æµ‹è¯•ä¾‹å­ã€‚æˆ‘ä»¬å¯ä»¥å…ˆæ„Ÿå®˜ä½“éªŒä¸€ä¸‹stormè¿è¡Œæ‹“æ‰‘æ˜¯æ€æ ·çš„ã€‚è¯¦æƒ…è¯·çœ‹storm-starterstep 1ï¼šç”¨idea æ‰“å¼€stormæºç  ç„¶åç”¨mavenæ‰“åŒ…æˆ–è€…è¿›å…¥storm-starteré¡¹ç›®é‡Œé¢æ‰§è¡Œ1mvn packageä¼šåœ¨targetç›®å½•é‡Œé¢ç”Ÿæˆä¸€ä¸ªstart-storm-{version}.jaråŒ…ä¸Šä¼ åˆ°stormçš„æœåŠ¡å™¨ã€‚step 2: æäº¤è¿è¡Œå®ä¾‹æ‹“æ‰‘ï¼Œæœ‰æœ¬åœ°å’Œé›†ç¾¤ä¸¤ç§æ¨¡å¼ã€‚æ˜¯ä¸æ˜¯æœ¬åœ°æ¨¡å¼ğŸ‰ï¸çœ‹ä»£ç å¦‚ä½•å®ç°çš„ã€‚12storm jar stormlib/storm-starter-1.2.2.jar org.apache.storm.starter.ExclamationTopology ##æœ¬åœ°æ¨¡å¼storm jar stormlib/storm-starter-1.2.2.jar org.apache.storm.starter.ExclamationTopology ExclamationTopology ## ExclamationTopologyä¸ºTopologyçš„åå­—step 3: org.apache.storm.starter.ExclamationTopology è¿™ä¸ªæ‹“æ‰‘ç±»å¦‚ä¸‹ï¼š1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192/** * Licensed to the Apache Software Foundation (ASF) under one * or more contributor license agreements. See the NOTICE file * distributed with this work for additional information * regarding copyright ownership. The ASF licenses this file * to you under the Apache License, Version 2.0 (the * \"License\"); you may not use this file except in compliance * with the License. You may obtain a copy of the License at * * http://www.apache.org/licenses/LICENSE-2.0 * * Unless required by applicable law or agreed to in writing, software * distributed under the License is distributed on an \"AS IS\" BASIS, * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. * See the License for the specific language governing permissions and * limitations under the License. */package org.apache.storm.starter;import org.apache.storm.Config;import org.apache.storm.LocalCluster;import org.apache.storm.StormSubmitter;import org.apache.storm.task.OutputCollector;import org.apache.storm.task.TopologyContext;import org.apache.storm.testing.TestWordSpout;import org.apache.storm.topology.OutputFieldsDeclarer;import org.apache.storm.topology.TopologyBuilder;import org.apache.storm.topology.base.BaseRichBolt;import org.apache.storm.tuple.Fields;import org.apache.storm.tuple.Tuple;import org.apache.storm.tuple.Values;import org.apache.storm.utils.Utils;import java.util.Map;/** * This is a basic example of a Storm topology. */public class ExclamationTopology &#123; public static class ExclamationBolt extends BaseRichBolt &#123; OutputCollector _collector; @Override public void prepare(Map conf, TopologyContext context, OutputCollector collector) &#123; _collector = collector; &#125; @Override public void execute(Tuple tuple) &#123; _collector.emit(tuple, new Values(tuple.getString(0) + \"!!!\")); _collector.ack(tuple); &#125; @Override public void declareOutputFields(OutputFieldsDeclarer declarer) &#123; declarer.declare(new Fields(\"word\")); &#125; &#125; public static void main(String[] args) throws Exception &#123; //æ„å»ºæ‹“æ‰‘ç±» TopologyBuilder builder = new TopologyBuilder(); //è®¾ç½®æ•°æ®è·å–æ¥æºspout builder.setSpout(\"word\", new TestWordSpout(), 10); //è®¾ç½®æ•°æ®å¤„ç†boltç±»æŒ‰ç…§wordåˆ†ç»„ builder.setBolt(\"exclaim1\", new ExclamationBolt(), 3).shuffleGrouping(\"word\"); //è®¾ç½®æ•°æ®å¤„ç†boltç±»æŒ‰ç…§exclaim1åˆ†ç»„ builder.setBolt(\"exclaim2\", new ExclamationBolt(), 2).shuffleGrouping(\"exclaim1\"); //è®¾ç½®é…ç½®å‚æ•°ï¼Œæ‰“å¼€debugæ¨¡å¼ Config conf = new Config(); conf.setDebug(true); // æ ¹æ®ä¼ å…¥å‚æ•°åˆ›å»ºå¯¹åº”æ‹“æ‰‘ï¼Œå¦‚æœå‚æ•°å¤§äº0ï¼Œå°±æäº¤åˆ°stormé›†ç¾¤ï¼Œé›†ç¾¤æ¨¡å¼è¿è¡Œ if (args != null &amp;&amp; args.length &gt; 0) &#123; conf.setNumWorkers(3); //é€šè¿‡nimbusæäº¤æ‹“æ‰‘åˆ°suppervisisorå·¥ä½œèŠ‚ç‚¹è¿è¡Œ StormSubmitter.submitTopologyWithProgressBar(args[0], conf, builder.createTopology()); &#125; else &#123; //å¦åˆ™å°±æ˜¯localæœ¬åœ°æ¨¡å¼è¿è¡Œï¼Œæœ¬åœ°æ¨¡å¼è¿è¡Œæ‰€æœ‰çš„æ—¥å¿—éƒ½ä¼šæ‰“å°åˆ°æœ¬åœ°ï¼Œå¯ä»¥ç”¨æ¥è°ƒè¯• LocalCluster cluster = new LocalCluster(); cluster.submitTopology(\"test\", conf, builder.createTopology()); Utils.sleep(10000); //è¿è¡Œ10ç§’åæ€æ‰æ‹“æ‰‘ cluster.killTopology(\"test\"); //åŒæ—¶é‡Šæ”¾èµ„æºï¼Œå…³æ‰storm cluster.shutdown(); &#125; &#125;&#125;org.apache.storm.testing.TestWordSpout;123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687/** * Licensed to the Apache Software Foundation (ASF) under one * or more contributor license agreements. See the NOTICE file * distributed with this work for additional information * regarding copyright ownership. The ASF licenses this file * to you under the Apache License, Version 2.0 (the * \"License\"); you may not use this file except in compliance * with the License. You may obtain a copy of the License at * * http://www.apache.org/licenses/LICENSE-2.0 * * Unless required by applicable law or agreed to in writing, software * distributed under the License is distributed on an \"AS IS\" BASIS, * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. * See the License for the specific language governing permissions and * limitations under the License. */package org.apache.storm.testing;import org.apache.storm.Config;import org.apache.storm.topology.OutputFieldsDeclarer;import java.util.Map;import org.apache.storm.spout.SpoutOutputCollector;import org.apache.storm.task.TopologyContext;import org.apache.storm.topology.base.BaseRichSpout;import org.apache.storm.tuple.Fields;import org.apache.storm.tuple.Values;import org.apache.storm.utils.Utils;import java.util.HashMap;import java.util.Random;import org.slf4j.Logger;import org.slf4j.LoggerFactory;public class TestWordSpout extends BaseRichSpout &#123; public static Logger LOG = LoggerFactory.getLogger(TestWordSpout.class); boolean _isDistributed; SpoutOutputCollector _collector; public TestWordSpout() &#123; this(true); &#125; public TestWordSpout(boolean isDistributed) &#123; _isDistributed = isDistributed; &#125; public void open(Map conf, TopologyContext context, SpoutOutputCollector collector) &#123; _collector = collector; &#125; public void close() &#123; &#125; public void nextTuple() &#123; Utils.sleep(100); final String[] words = new String[] &#123;\"nathan\", \"mike\", \"jackson\", \"golda\", \"bertels\"&#125;; final Random rand = new Random(); final String word = words[rand.nextInt(words.length)]; //éšæœºä»è¿™äº›å­—ç¬¦ä¸²ä¸­è·å–æ•°æ® _collector.emit(new Values(word)); &#125; public void ack(Object msgId) &#123; &#125; public void fail(Object msgId) &#123; &#125; public void declareOutputFields(OutputFieldsDeclarer declarer) &#123; declarer.declare(new Fields(\"word\")); &#125; @Override public Map&lt;String, Object&gt; getComponentConfiguration() &#123; if(!_isDistributed) &#123; Map&lt;String, Object&gt; ret = new HashMap&lt;String, Object&gt;(); ret.put(Config.TOPOLOGY_MAX_TASK_PARALLELISM, 1); return ret; &#125; else &#123; return null; &#125; &#125; &#125;storm API ç®€å•ä»‹ç»1.æ‹“æ‰‘æ„å»ºTopologyBuilderå…¬å¼€äº†Java APIï¼Œç”¨äºæŒ‡å®šè¦æ‰§è¡Œçš„Stormæ‹“æ‰‘ã€‚æ‹“æ‰‘ç»“æ„æœ€ç»ˆæ˜¯Thriftç»“æ„ï¼Œä½†ç”±äºThrift APIéå¸¸å†—é•¿ï¼ŒTopologyBuilderæå¤§åœ°ç®€åŒ–äº†åˆ›å»ºæ‹“æ‰‘çš„è¿‡ç¨‹ã€‚ç”¨äºåˆ›å»ºå’Œæäº¤æ‹“æ‰‘çš„æ¨¡æ¿ç±»ä¼¼äºï¼š12345678910111213TopologyBuilder builder = new TopologyBuilder();builder.setSpout(\"1\", new TestWordSpout(true), 5);builder.setSpout(\"2\", new TestWordSpout(true), 3);builder.setBolt(\"3\", new TestWordCounter(), 3) .fieldsGrouping(\"1\", new Fields(\"word\")) .fieldsGrouping(\"2\", new Fields(\"word\"));builder.setBolt(\"4\", new TestGlobalCount()) .globalGrouping(\"1\");Map conf = new HashMap();conf.put(Config.TOPOLOGY_WORKERS, 4);StormSubmitter.submitTopology(\"mytopology\", conf, builder.createTopology());åœ¨æœ¬åœ°æ¨¡å¼ï¼ˆæ­£åœ¨å¤„ç†ï¼‰ä¸­è¿è¡Œå®Œå…¨ç›¸åŒçš„æ‹“æ‰‘ï¼Œå¹¶å°†å…¶é…ç½®ä¸ºè®°å½•æ‰€æœ‰å‘å‡ºçš„å…ƒç»„ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚è¯·æ³¨æ„ï¼Œåœ¨å…³é—­æœ¬åœ°ç¾¤é›†ä¹‹å‰ï¼Œå®ƒå…è®¸æ‹“æ‰‘è¿è¡Œ10ç§’ã€‚123456789101112131415161718TopologyBuilder builder = new TopologyBuilder();builder.setSpout(\"1\", new TestWordSpout(true), 5);builder.setSpout(\"2\", new TestWordSpout(true), 3);builder.setBolt(\"3\", new TestWordCounter(), 3) .fieldsGrouping(\"1\", new Fields(\"word\")) .fieldsGrouping(\"2\", new Fields(\"word\"));builder.setBolt(\"4\", new TestGlobalCount()) .globalGrouping(\"1\");Map conf = new HashMap();conf.put(Config.TOPOLOGY_WORKERS, 4);conf.put(Config.TOPOLOGY_DEBUG, true);LocalCluster cluster = new LocalCluster();cluster.submitTopology(\"mytopology\", conf, builder.createTopology());Utils.sleep(10000);cluster.shutdown();æ¨¡å¼TopologyBuilderæ˜¯ä½¿ç”¨setSpoutå’ŒsetBoltæ–¹æ³•å°†ç»„ä»¶IDæ˜ å°„åˆ°ç»„ä»¶ã€‚è¿™äº›æ–¹æ³•è¿”å›çš„å¯¹è±¡éšåç”¨äºå£°æ˜è¯¥ç»„ä»¶çš„è¾“å…¥ã€‚è¯¦æƒ…å¯ä»¥æŸ¥çœ‹TopologyBuilder2.åˆ›å»ºspoutç›¸å…³ISpoutæ¥å£ï¼š123456789101112public interface ISpout extends Serializable &#123; //åˆå§‹åŒ–æ–¹æ³• void open(Map conf, TopologyContext context, SpoutOutputCollector collector); //å…³é—­ void close(); //éå†å…ƒç»„çš„æ–¹æ³•ï¼Œä¼šä¸€ç›´æ‰§è¡Œè¿™ä¸ªæ–¹æ³• void nextTuple(); //æˆåŠŸæ—¶è°ƒç”¨çš„ç¡®è®¤æ–¹æ³• void ack(Object msgId); //å¤±è´¥æ—¶è°ƒç”¨çš„å¤±è´¥æ–¹æ³• void fail(Object msgId);&#125;stormå·²ç»ç»™æˆ‘ä»¬æä¾›çš„å¾ˆå¤šçš„spoutæ¥å£å’Œå®ç°ç±»ï¼Œæˆ‘ä»¬åªéœ€è¦å®ç°æˆ–è€…å¯¹åº”çš„å®ç°ç±»å°±èƒ½å’Œå…¶ä»–æŠ€æœ¯é›†æˆåœ¨ä¸€èµ·ã€‚åŸºæœ¬çš„spoutï¼Œæˆ‘ä»¬å¯ä»¥å®ç°IRichSpoutæˆ–è€…ç»§æ‰¿BasicRichSpoutå®Œæˆspoutçš„åˆ›å»ºã€‚3.åˆ›å»ºBoltç±»stormå·²ç»ç»™æˆ‘ä»¬æä¾›çš„å¾ˆå¤šçš„Boltæ¥å£å’Œå®ç°ç±»ï¼Œæˆ‘ä»¬åªéœ€è¦å®ç°æˆ–è€…å¯¹åº”çš„å®ç°ç±»å°±èƒ½å’Œå…¶ä»–æŠ€æœ¯é›†æˆåœ¨ä¸€èµ·ã€‚åŸºæœ¬çš„spoutï¼Œæˆ‘ä»¬å¯ä»¥å®ç°IRichBoltæˆ–è€…ç»§æ‰¿BasicRichBoltå¦‚1234567891011121314151617181920212223/*** BaseRichBolt æ˜¯ä¸€ä¸ªä¸éœ€è¦å®ç°çš„ACKç¡®è®¤æ–¹æ³•å’Œfailï¼ˆï¼‰å¤±è´¥æ–¹æ³•* */public class ExampleBolt extends BaseRichBolt &#123; OutputCollector _collector; @Override public void prepare(Map conf, TopologyContext context, OutputCollector collector) &#123; _collector = collector; &#125; @Override public void execute(Tuple tuple) &#123; _collector.emit(tuple, new Values(tuple.getString(0) + \"!!!\")); _collector.ack(tuple); &#125; @Override public void declareOutputFields(OutputFieldsDeclarer declarer) &#123; declarer.declare(new Fields(\"word\")); &#125; &#125;Stormä½¿ç”¨å…¥é—¨èµ·æ¥æ˜¯éå¸¸ç®€å•çš„ã€‚ä¸‹é¢æˆ‘å°†ç®€å•çš„è‡ªå·±å®ç°ä¸€ä¸ªæ‹“æ‰‘123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146package com.sonly.storm.demo1;import org.apache.storm.Config;import org.apache.storm.LocalCluster;import org.apache.storm.StormSubmitter;import org.apache.storm.generated.AlreadyAliveException;import org.apache.storm.generated.AuthorizationException;import org.apache.storm.generated.InvalidTopologyException;import org.apache.storm.topology.TopologyBuilder;import org.apache.storm.tuple.Fields;import org.slf4j.Logger;import org.slf4j.LoggerFactory;/** * &lt;b&gt;package:com.sonly.storm.demo1&lt;/b&gt; * &lt;b&gt;project(é¡¹ç›®):stormstudy&lt;/b&gt; * &lt;b&gt;class(ç±»)HelloToplogy&lt;/b&gt; * &lt;b&gt;creat date(åˆ›å»ºæ—¶é—´):2019-05-09 21:55&lt;/b&gt; * &lt;b&gt;author(ä½œè€…):&lt;/b&gt;xxydliuyss&lt;/br&gt; * &lt;b&gt;note(å¤‡æ³¨)):&lt;/b&gt; * If you want to change the file header,please modify zhe File and Code Templates. */public class HelloToplogy &#123; public static final Logger LOGGER = LoggerFactory.getLogger(HelloToplogy.class); //Topology Name //component prefix //workers //spout executor (parallelism_hint) //spout task size //bolt executor (parallelism_hint) //bolt task size public static void main(String[] args) throws InterruptedException &#123; TopologyBuilder builder = new TopologyBuilder(); Config conf = new Config(); conf.setDebug(true); if (args==null || args.length &lt; 7) &#123; conf.setNumWorkers(3); builder.setSpout(\"spout\", new HellowordSpout(), 4).setNumTasks(4); builder.setBolt(\"split-bolt\", new SplitBolt(), 4).shuffleGrouping(\"spout\").setNumTasks(8); builder.setBolt(\"count-bolt\", new HellowordBolt(), 8).fieldsGrouping(\"split-bolt\", new Fields(\"word\")).setNumTasks(8); LocalCluster cluster = new LocalCluster(); cluster.submitTopology(\"word-count\", conf, builder.createTopology()); Thread.sleep(10000); cluster.killTopology(\"word-count\"); cluster.shutdown(); &#125; else &#123; Options options = Options.builder(args); conf.setNumWorkers(options.getWorkers()); builder.setSpout(options.getPrefix()+\"-spout\", new HellowordSpout(), options.getSpoutParallelismHint()).setNumTasks(options.getSpoutTaskSize()); builder.setBolt(options.getPrefix()+\"-split-bolt\", new SplitBolt(), options.getBoltParallelismHint()).shuffleGrouping(options.getPrefix()+\"-spout\").setNumTasks(options.getBoltTaskSize()); builder.setBolt(options.getPrefix()+\"-count-bolt\", new HellowordBolt(), options.getBoltParallelismHint()).fieldsGrouping(options.getPrefix()+\"-split-bolt\", new Fields(\"word\")).setNumTasks(options.getBoltTaskSize()); try &#123; StormSubmitter.submitTopologyWithProgressBar(options.getTopologyName(), conf, builder.createTopology()); LOGGER.warn(\"===========================================================\"); LOGGER.warn(\"The Topology &#123;&#125; is Submited \",options.getTopologyName()); LOGGER.warn(\"===========================================================\"); &#125; catch (AlreadyAliveException | InvalidTopologyException | AuthorizationException e) &#123; e.printStackTrace(); &#125; &#125; &#125; public static class Options&#123; private String topologyName; private String prefix; private Integer workers; private Integer spoutParallelismHint; private Integer spoutTaskSize; private Integer boltParallelismHint; private Integer boltTaskSize; public Options(String topologyName, String prefix, Integer workers, Integer spoutParallelismHint, Integer spoutTaskSize, Integer boltParallelismHint, Integer boltTaskSize) &#123; this.topologyName = topologyName; this.prefix = prefix; this.workers = workers; this.spoutParallelismHint = spoutParallelismHint; this.spoutTaskSize = spoutTaskSize; this.boltParallelismHint = boltParallelismHint; this.boltTaskSize = boltTaskSize; &#125; public static Options builder(String[] args)&#123; return new Options(args[0],args[1],Integer.parseInt(args[2]) ,Integer.parseInt(args[3]),Integer.parseInt(args[4]),Integer.parseInt(args[5]),Integer.parseInt(args[6]) ); &#125; public String getTopologyName() &#123; return topologyName; &#125; public void setTopologyName(String topologyName) &#123; this.topologyName = topologyName; &#125; public String getPrefix() &#123; return prefix; &#125; public void setPrefix(String prefix) &#123; this.prefix = prefix; &#125; public Integer getWorkers() &#123; return workers; &#125; public void setWorkers(Integer workers) &#123; this.workers = workers; &#125; public Integer getSpoutParallelismHint() &#123; return spoutParallelismHint; &#125; public void setSpoutParallelismHint(Integer spoutParallelismHint) &#123; this.spoutParallelismHint = spoutParallelismHint; &#125; public Integer getSpoutTaskSize() &#123; return spoutTaskSize; &#125; public void setSpoutTaskSize(Integer spoutTaskSize) &#123; this.spoutTaskSize = spoutTaskSize; &#125; public Integer getBoltParallelismHint() &#123; return boltParallelismHint; &#125; public void setBoltParallelismHint(Integer boltParallelismHint) &#123; this.boltParallelismHint = boltParallelismHint; &#125; public Integer getBoltTaskSize() &#123; return boltTaskSize; &#125; public void setBoltTaskSize(Integer boltTaskSize) &#123; this.boltTaskSize = boltTaskSize; &#125; &#125;&#125;spout ç±»ï¼š123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657package com.sonly.storm.demo1;import org.apache.storm.spout.SpoutOutputCollector;import org.apache.storm.task.TopologyContext;import org.apache.storm.topology.OutputFieldsDeclarer;import org.apache.storm.topology.base.BaseRichSpout;import org.apache.storm.tuple.Fields;import org.apache.storm.tuple.Values;import org.slf4j.Logger;import org.slf4j.LoggerFactory;import java.util.Currency;import java.util.Map;import java.util.Random;/** * &lt;b&gt;package:com.sonly.storm.demo1&lt;/b&gt; * &lt;b&gt;project(é¡¹ç›®):stormstudy&lt;/b&gt; * &lt;b&gt;class(ç±»)$&#123;HellowordSpout&#125;&lt;/b&gt; * &lt;b&gt;creat date(åˆ›å»ºæ—¶é—´):2019-05-09 20:27&lt;/b&gt; * &lt;b&gt;author(ä½œè€…):&lt;/b&gt;xxydliuyss&lt;/br&gt; * &lt;b&gt;note(å¤‡æ³¨)):&lt;/b&gt; * If you want to change the file header,please modify zhe File and Code Templates. */public class HellowordSpout extends BaseRichSpout &#123; public static final Logger LOGGER = LoggerFactory.getLogger(HellowordSpout.class); //æ‹“æ‰‘ä¸Šä¸‹æ–‡ private TopologyContext context; private SpoutOutputCollector collector; private Map config; private Random random; public void open(Map conf, TopologyContext topologyContext, SpoutOutputCollector collector) &#123; this.config = conf; this.context = topologyContext; this.collector = collector; this.random = new Random(); LOGGER.warn(\"HellowordSpout-&gt;open:hashcode:&#123;&#125;-&gt;ThreadId:&#123;&#125;,TaskId:&#123;&#125;\",this.hashCode(),Thread.currentThread().getId(),context.getThisTaskId()); &#125; public void nextTuple() &#123; String[] sentences = new String[]&#123;\"hello world !\", \"hello Storm !\", \"hello apache flink !\", \"hello apache kafka stream !\", \"hello apache spark !\"&#125;; final String sentence = sentences[random.nextInt(sentences.length)]; collector.emit(new Values(sentence)); LOGGER.warn(\"HellowordSpout-&gt;nextTuple:hashcode:&#123;&#125;-&gt;ThreadId:&#123;&#125;,TaskId:&#123;&#125;,Values:&#123;&#125;\",this.hashCode(),Thread.currentThread().getId(),context.getThisTaskId(),sentence); &#125; public void declareOutputFields(OutputFieldsDeclarer declarer) &#123; declarer.declare(new Fields(\"sentence\")); &#125; @Override public void close() &#123; LOGGER.warn(\"HellowordSpout-&gt;close:hashcode:&#123;&#125;-&gt;ThreadId:&#123;&#125;,TaskId:&#123;&#125;\",this.hashCode(),Thread.currentThread().getId(),context.getThisTaskId()); super.close(); &#125;&#125;å®ç°ä¸¤ä¸ªboltä¸€ä¸ªç”¨æ¥ç»Ÿè®¡å•è¯å‡ºç°ä¸ªæ•°ï¼Œä¸€ä¸ªç”¨æ¥æ‹†åˆ†è¯­å¥ã€‚12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152package com.sonly.storm.demo1;import org.apache.storm.task.OutputCollector;import org.apache.storm.task.TopologyContext;import org.apache.storm.topology.OutputFieldsDeclarer;import org.apache.storm.topology.base.BaseRichBolt;import org.apache.storm.tuple.Fields;import org.apache.storm.tuple.Tuple;import org.apache.storm.tuple.Values;import org.slf4j.Logger;import org.slf4j.LoggerFactory;import java.util.HashMap;import java.util.Map;/** * &lt;b&gt;package:com.sonly.storm.demo1&lt;/b&gt; * &lt;b&gt;project(é¡¹ç›®):stormstudy&lt;/b&gt; * &lt;b&gt;class(ç±»)$&#123;CLASS_NAME&#125;&lt;/b&gt; * &lt;b&gt;creat date(åˆ›å»ºæ—¶é—´):2019-05-09 21:19&lt;/b&gt; * &lt;b&gt;author(ä½œè€…):&lt;/b&gt;xxydliuyss&lt;/br&gt; * &lt;b&gt;note(å¤‡æ³¨)):&lt;/b&gt; * If you want to change the file header,please modify zhe File and Code Templates. */public class HellowordBolt extends BaseRichBolt &#123; public static final Logger LOGGER = LoggerFactory.getLogger(HellowordBolt.class); private TopologyContext context; private Map conf; private OutputCollector collector; private Map&lt;String,Integer&gt; counts = new HashMap(16); public void prepare(Map map, TopologyContext topologyContext, OutputCollector outputCollector) &#123; this.conf=map; this.context = topologyContext; this.collector = outputCollector; LOGGER.warn(\"HellowordBolt-&gt;prepare:hashcode:&#123;&#125;-&gt;ThreadId:&#123;&#125;,TaskId:&#123;&#125;\",this.hashCode(),Thread.currentThread().getId(),context.getThisTaskId()); &#125; public void execute(Tuple tuple) &#123; LOGGER.warn(\"HellowordBolt-&gt;execute:hashcode:&#123;&#125;-&gt;ThreadId:&#123;&#125;,TaskId:&#123;&#125;\",this.hashCode(),Thread.currentThread().getId(),context.getThisTaskId()); String word = tuple.getString(0); Integer count = counts.get(word); if (count == null) count = 0; count++; counts.put(word, count); collector.emit(new Values(word, count)); &#125; public void declareOutputFields(OutputFieldsDeclarer declarer) &#123; declarer.declare(new Fields(\"word\", \"count\")); &#125;&#125;12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849package com.sonly.storm.demo1;import org.apache.storm.task.OutputCollector;import org.apache.storm.task.TopologyContext;import org.apache.storm.topology.OutputFieldsDeclarer;import org.apache.storm.topology.base.BaseRichBolt;import org.apache.storm.tuple.Fields;import org.apache.storm.tuple.Tuple;import org.apache.storm.tuple.Values;import org.slf4j.Logger;import org.slf4j.LoggerFactory;import java.util.Map;/** * &lt;b&gt;package:com.sonly.storm.demo1&lt;/b&gt; * &lt;b&gt;project(é¡¹ç›®):stormstudy&lt;/b&gt; * &lt;b&gt;class(ç±»)$&#123;CLASS_NAME&#125;&lt;/b&gt; * &lt;b&gt;creat date(åˆ›å»ºæ—¶é—´):2019-05-09 21:29&lt;/b&gt; * &lt;b&gt;author(ä½œè€…):&lt;/b&gt;xxydliuyss&lt;/br&gt; * &lt;b&gt;note(å¤‡æ³¨)):&lt;/b&gt; * If you want to change the file header,please modify zhe File and Code Templates. */public class SplitBolt extends BaseRichBolt &#123; public static final Logger LOGGER = LoggerFactory.getLogger(SplitBolt.class); private TopologyContext context; private Map conf; private OutputCollector collector; public void prepare(Map map, TopologyContext topologyContext, OutputCollector outputCollector) &#123; this.conf=map; this.context = topologyContext; this.collector = outputCollector; LOGGER.warn(\"SplitBolt-&gt;prepare:hashcode:&#123;&#125;-&gt;ThreadId:&#123;&#125;,TaskId:&#123;&#125;\",this.hashCode(),Thread.currentThread().getId(),context.getThisTaskId()); &#125; public void execute(Tuple tuple) &#123; String words = tuple.getStringByField(\"sentence\"); String[] contents = words.split(\" +\"); for (String content : contents) &#123; collector.emit(new Values(content)); collector.ack(tuple); &#125; LOGGER.warn(\"SplitBolt-&gt;execute:hashcode:&#123;&#125;-&gt;ThreadId:&#123;&#125;,TaskId:&#123;&#125;\",this.hashCode(),Thread.currentThread().getId(),context.getThisTaskId()); &#125; public void declareOutputFields(OutputFieldsDeclarer declarer) &#123; declarer.declare(new Fields(\"word\")); &#125;&#125;localæ¨¡å¼å¯åŠ¨è¿è¡Œåœ¨pomæ–‡ä»¶ä¸­æ·»åŠ æ‰“åŒ…æ’ä»¶12345678910111213&lt;plugin&gt; &lt;artifactId&gt;maven-assembly-plugin&lt;/artifactId&gt; &lt;configuration&gt; &lt;descriptorRefs&gt; &lt;descriptorRef&gt;jar-with-dependencies&lt;/descriptorRef&gt; &lt;/descriptorRefs&gt; &lt;archive&gt; &lt;manifest&gt; &lt;mainClass&gt;com.sonly.storm.demo1.HelloToplogy&lt;/mainClass&gt; &lt;/manifest&gt; &lt;/archive&gt; &lt;/configuration&gt;&lt;/plugin&gt;åŒæ—¶ä¿®æ”¹dependency çš„scopeä¸ºprovide1&lt;scope&gt;provide&lt;/scope&gt;åŸå› æ˜¯æœåŠ¡å™¨ä¸Šstormç›¸å…³åŒ…éƒ½å·²ç»å­˜åœ¨äº†ï¼Œé˜²æ­¢é‡å¤æ‰“åŒ…å¯¼è‡´å†²çªã€‚1234567//Topology Name//component prefix//workers//spout executor (parallelism_hint)//spout task size//bolt executor (parallelism_hint)//bolt task sizeæ‰“åŒ…ä¸Šä¼ åï¼Œstorm jar jarName arg0 arg1 arg2 args3 â€¦åé¢è·Ÿå‚æ•°è¿è¡Œå³å¯ã€‚","categories":[{"name":"storm","slug":"storm","permalink":"http://www.liuyong520.cn/categories/storm/"}],"tags":[{"name":"storm","slug":"storm","permalink":"http://www.liuyong520.cn/tags/storm/"}]},{"title":"storm å®‰è£…ä½¿ç”¨","slug":"storm-install","date":"2019-05-02T13:37:40.000Z","updated":"2019-05-08T09:39:18.278Z","comments":true,"path":"2019/05/02/storm-install/","link":"","permalink":"http://www.liuyong520.cn/2019/05/02/storm-install/","excerpt":"","text":"ç¯å¢ƒå‡†å¤‡zookeeperé›†ç¾¤ç¯å¢ƒstormæ˜¯ä¾èµ–äºzookeeperæ³¨å†Œä¸­å¿ƒçš„ä¸€æ¬¾åˆ†å¸ƒå¼æ¶ˆæ¯å¯¹åˆ—ï¼Œæ‰€ä»¥éœ€è¦æœ‰zookeeperå•æœºæˆ–è€…é›†ç¾¤ç¯å¢ƒã€‚å‡†å¤‡ä¸‰å°æœåŠ¡å™¨ï¼š123172.16.18.198 k8s-n1172.16.18.199 k8s-n2172.16.18.200 k8s-n3ä¸‹è½½stormå®‰è£…åŒ…http://storm.apache.org/downloads.html ä¸­ä¸‹è½½ï¼Œç›®å‰æœ€æ–°ç‰ˆæœ¬çš„stromå·²ç»åˆ°1.2.2,æˆ‘è¿™é‡Œä¹‹å‰ä¸‹è½½çš„æ˜¯1.1.3ç‰ˆæœ¬çš„ã€‚å®‰è£…stormé›†ç¾¤ä¸Šä¼ å‹ç¼©åŒ…åˆ°ä¸‰å°æœåŠ¡å™¨è§£å‹ç¼©åˆ°/opt/ç›®å½•ä¸‹12tar -zxf apache-storm-1.1.3.tar.gz -C /optln -sf apache-storm-1.1.3/ stormä¿®æ”¹ confç›®å½•ä¸‹çš„storm.ymlæ–‡ä»¶StormåŒ…å«ä¸€ä¸ªconf/storm.yamlé…ç½®Stormå®ˆæŠ¤è¿›ç¨‹çš„æ–‡ä»¶ã€‚è¿™ä¸ªæ–‡ä»¶é‡Œé¢é…ç½®çš„å€¼ä¼šè¦†ç›–æ‰default.ymlé‡Œé¢çš„å€¼ï¼ŒåŒæ—¶é‡Œé¢æœ‰ä¸€äº›é…ç½®æ˜¯å¿…é¡»å¡«çš„æ³¨æ„ï¼šymlæ–‡ä»¶çš„å‰é¢çš„ç©ºæ ¼å¿…é¡»æœ‰ï¼Œä¸ç„¶å°±ä¼šå‡ºé—®é¢˜ï¼Œymlé…ç½®æ–‡ä»¶æœ‰ä¸¥æ ¼çš„æ ¼å¼1)storm.zookeeper.serversï¼šè¿™æ˜¯Stormé›†ç¾¤çš„Zookeeperé›†ç¾¤ä¸­çš„ä¸»æœºåˆ—è¡¨ã€‚å®ƒåº”è¯¥çœ‹èµ·æ¥åƒï¼š1234storm.zookeeper.servers: - &quot;k8s-n1&quot; - &quot;k8s-n2 - &quot;k8s-n3&quot;2)å¦‚æœzookeeperçš„é»˜è®¤ç«¯å£ä¸æ˜¯2181çš„è¯è¿˜éœ€è¦é…ç½®storm.zookeeper.port,å¦‚æœæ˜¯2181ï¼Œæ­¤é€‰é¡¹å¯ä»¥ä¸ç”¨é…ç½®1storm.zookeeper.port: 21813ï¼‰storm.local.dirï¼šNimbuså’ŒSupervisorå®ˆæŠ¤è¿›ç¨‹éœ€è¦æœ¬åœ°ç£ç›˜ä¸Šçš„ä¸€ä¸ªç›®å½•æ¥å­˜å‚¨å°‘é‡çŠ¶æ€ï¼ˆå¦‚jarï¼Œconfså’Œç±»ä¼¼çš„ä¸œè¥¿ï¼‰ã€‚æ‚¨åº”è¯¥åœ¨æ¯å°è®¡ç®—æœºä¸Šåˆ›å»ºè¯¥ç›®å½•ï¼Œä¸ºå…¶æä¾›é€‚å½“çš„æƒé™ï¼Œç„¶åä½¿ç”¨æ­¤é…ç½®å¡«å†™ç›®å½•ä½ç½®ã€‚ä¾‹å¦‚ï¼š1storm.local.dir: &quot;/data/storm&quot;4ï¼‰nimbus.seedsï¼šå·¥ä½œèŠ‚ç‚¹éœ€è¦çŸ¥é“å“ªäº›æœºå™¨æ˜¯ä¸»æœºçš„å€™é€‰è€…æ‰èƒ½ä¸‹è½½æ‹“æ‰‘ç½å’Œconfsã€‚ä¾‹å¦‚ï¼š1nimbus.seeds: [&quot;k8s-n1&quot;,&quot;k8s-n2&quot;,&quot;k8s-n3&quot;]4ï¼‰supervisor.slots.portsï¼šå¯¹äºæ¯ä¸ªå·¥ä½œè€…è®¡ç®—æœºï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æ­¤é…ç½®é…ç½®åœ¨è¯¥è®¡ç®—æœºä¸Šè¿è¡Œçš„å·¥ä½œç¨‹åºæ•°ã€‚æ¯ä¸ªå·¥ä½œäººå‘˜ä½¿ç”¨å•ä¸ªç«¯å£æ¥æ”¶æ¶ˆæ¯ï¼Œæ­¤è®¾ç½®å®šä¹‰å“ªäº›ç«¯å£å¯ä»¥ä½¿ç”¨ã€‚å¦‚æœæ‚¨åœ¨æ­¤å¤„å®šä¹‰äº†äº”ä¸ªç«¯å£ï¼Œé‚£ä¹ˆStormå°†åˆ†é…æœ€å¤šäº”ä¸ªå·¥ä½œäººå‘˜åœ¨æ­¤è®¡ç®—æœºä¸Šè¿è¡Œã€‚å¦‚æœæ‚¨å®šä¹‰äº†ä¸‰ä¸ªç«¯å£ï¼ŒStormæœ€å¤šåªèƒ½è¿è¡Œä¸‰ä¸ªç«¯å£ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ­¤è®¾ç½®é…ç½®ä¸ºåœ¨ç«¯å£6700,6701,6702å’Œ6703ä¸Šè¿è¡Œ4ä¸ªå·¥ä½œç¨‹åºã€‚ä¾‹å¦‚ï¼š12345supervisor.slots.ports: - 6700 - 6701 - 6702 - 67035)å¼€å¯ç›‘ç£æœºåˆ¶ç›‘ç£å¥åº·çŠ¶å†µStormæä¾›äº†ä¸€ç§æœºåˆ¶ï¼Œç®¡ç†å‘˜å¯ä»¥é€šè¿‡è¯¥æœºåˆ¶å®šæœŸç®¡ç†å‘˜å®šæœŸè¿è¡Œç®¡ç†å‘˜æä¾›çš„è„šæœ¬ï¼Œä»¥ç¡®å®šèŠ‚ç‚¹æ˜¯å¦å¥åº·ã€‚ç®¡ç†å‘˜å¯ä»¥è®©ä¸»ç®¡é€šè¿‡åœ¨storm.health.check.dirä¸­çš„è„šæœ¬ä¸­æ‰§è¡Œä»–ä»¬é€‰æ‹©çš„ä»»ä½•æ£€æŸ¥æ¥ç¡®å®šèŠ‚ç‚¹æ˜¯å¦å¤„äºå¥åº·çŠ¶æ€ã€‚å¦‚æœè„šæœ¬æ£€æµ‹åˆ°èŠ‚ç‚¹å¤„äºä¸å¥åº·çŠ¶æ€ï¼Œåˆ™å¿…é¡»ä»æ ‡å‡†è¾“å‡ºæ‰“å°ä¸€è¡Œï¼Œä»¥å­—ç¬¦ä¸²ERRORå¼€å¤´ã€‚ä¸»ç®¡å°†å®šæœŸè¿è¡Œè¿è¡ŒçŠ¶å†µæ£€æŸ¥ç›®å½•ä¸­çš„è„šæœ¬å¹¶æ£€æŸ¥è¾“å‡ºã€‚å¦‚æœè„šæœ¬çš„è¾“å‡ºåŒ…å«å­—ç¬¦ä¸²ERRORï¼Œå¦‚ä¸Šæ‰€è¿°ï¼Œä¸»ç®¡å°†å…³é—­æ‰€æœ‰å·¥ä½œäººå‘˜å¹¶é€€å‡ºã€‚å¦‚æœä¸»ç®¡åœ¨ç›‘ç£ä¸‹è¿è¡Œï¼Œåˆ™å¯ä»¥è°ƒç”¨â€œ/ bin / storm node-health-checkâ€æ¥ç¡®å®šæ˜¯å¦åº”è¯¥å¯åŠ¨ä¸»ç®¡æˆ–èŠ‚ç‚¹æ˜¯å¦è¿è¡ŒçŠ¶å†µä¸ä½³ã€‚è¿è¡ŒçŠ¶å†µæ£€æŸ¥ç›®å½•ä½ç½®å¯ä»¥é…ç½®ä¸ºï¼š1storm.health.check.dir: &quot;healthchecks&quot;è„šæœ¬å¿…é¡»å…·æœ‰æ‰§è¡Œæƒé™ã€‚å…è®¸ä»»ä½•ç»™å®šçš„è¿è¡ŒçŠ¶å†µæ£€æŸ¥è„šæœ¬åœ¨ç”±äºè¶…æ—¶è€Œæ ‡è®°ä¸ºå¤±è´¥ä¹‹å‰è¿è¡Œçš„æ—¶é—´å¯ä»¥é…ç½®ä¸ºï¼š1storm.health.check.timeout.ms: 5000å¯åŠ¨Nimbusï¼šåœ¨ä¸»æœºç›‘ç£ä¸‹è¿è¡Œå‘½ä»¤â€œbin / storm nimbusâ€ã€‚ä¸»ç®¡ï¼šåœ¨æ¯å°å·¥ä½œæœºå™¨çš„ç›‘ç£ä¸‹è¿è¡Œå‘½ä»¤â€œbin / storm supervisorâ€ã€‚ç®¡ç†ç¨‹åºå®ˆæŠ¤ç¨‹åºè´Ÿè´£å¯åŠ¨å’Œåœæ­¢è¯¥è®¡ç®—æœºä¸Šçš„å·¥ä½œè¿›ç¨‹ã€‚UIï¼šé€šè¿‡åœ¨ç›‘ç£ä¸‹è¿è¡Œå‘½ä»¤â€œbin / storm uiâ€ï¼Œè¿è¡ŒStorm UIï¼ˆæ‚¨å¯ä»¥ä»æµè§ˆå™¨è®¿é—®çš„ç«™ç‚¹ï¼Œè¯¥ç«™ç‚¹æä¾›å¯¹ç¾¤é›†å’Œæ‹“æ‰‘çš„è¯Šæ–­ï¼‰ã€‚å¯ä»¥é€šè¿‡å°†Webæµè§ˆå™¨å¯¼èˆªåˆ°httpï¼š// {ui host}ï¼š8080æ¥è®¿é—®UIã€‚å¦‚æ‚¨æ‰€è§ï¼Œè¿è¡Œå®ˆæŠ¤è¿›ç¨‹éå¸¸ç®€å•ã€‚å®ˆæŠ¤ç¨‹åºå°†åœ¨æ‚¨è§£å‹ç¼©Stormç‰ˆæœ¬çš„ä»»ä½•ä½ç½®ç™»å½•åˆ°logs /ç›®å½•ã€‚åå°å¯åŠ¨1nohup storm ui &gt;/dev/null 2&gt;&amp;1 &amp;","categories":[{"name":"storm","slug":"storm","permalink":"http://www.liuyong520.cn/categories/storm/"}],"tags":[{"name":"storm","slug":"storm","permalink":"http://www.liuyong520.cn/tags/storm/"}]},{"title":"kafka APIçš„ä½¿ç”¨","slug":"kafka-API","date":"2019-05-02T13:37:40.000Z","updated":"2019-05-03T13:16:45.720Z","comments":true,"path":"2019/05/02/kafka-API/","link":"","permalink":"http://www.liuyong520.cn/2019/05/02/kafka-API/","excerpt":"","text":"kafka APIkafka Consumeræä¾›ä¸¤å¥—Java APIï¼šé«˜çº§Consumer APIã€å’Œä½çº§Consumer APIã€‚é«˜çº§Consumer API ä¼˜ç‚¹ï¼šé«˜çº§APIå†™èµ·æ¥ç®€å•ï¼Œæ˜“ç”¨ã€‚ä¸éœ€è¦è‡ªè¡Œå»ç®¡ç†offsetï¼ŒAPIå·²ç»å°è£…å¥½äº†offsetè¿™å—çš„ä¸œè¥¿ï¼Œä¼šé€šè¿‡zookeeperè‡ªè¡Œç®¡ç†ä¸éœ€è¦ç®¡ç†åˆ†åŒºï¼Œå‰¯æœ¬ç­‰æƒ…å†µï¼Œç³»ç»Ÿè‡ªåŠ¨ç®¡ç†æ¶ˆè´¹è€…æ–­çº¿åä¼šè‡ªåŠ¨æ ¹æ®ä¸Šæ¬¡è®°å½•åœ¨zookeeperä¸­çš„offsetæ¥ç€æ¶ˆè´¹æ¶ˆæ¯ã€‚é«˜çº§Consumer API ç¼ºç‚¹ï¼šä¸èƒ½è‡ªè¡Œæ§åˆ¶offsetã€‚ä¸èƒ½è‡ªè¡Œç®¡ç†åˆ†åŒºï¼Œå‰¯æœ¬ï¼Œzkç­‰ç›¸å…³ä¿¡æ¯ã€‚ä½çº§API ä¼˜ç‚¹ï¼šèƒ½å¤Ÿè®©å¼€å‘è€…è‡ªå·±ç»´æŠ¤offset.æƒ³ä»å“ªé‡Œæ¶ˆè´¹å°±ä»å“ªé‡Œæ¶ˆè´¹è‡ªè¡Œæ§åˆ¶è¿æ¥åˆ†åŒºï¼Œå¯¹åˆ†åŒºè‡ªå®šä¹‰è´Ÿè½½å‡è¡¡å¯¹zookeeperçš„ä¾èµ–æ€§é™ä½ï¼ˆå¦‚ offset ä¸ä¸€å®šè¦ç”¨zkæ¥å­˜å‚¨ï¼Œå¯ä»¥å­˜åœ¨ç¼“å­˜é‡Œæˆ–è€…å†…å­˜ä¸­ï¼‰ç¼ºç‚¹ï¼šè¿‡äºå¤æ‚ï¼Œéœ€è¦è‡ªè¡Œæ§åˆ¶offsetï¼Œè¿æ¥å“ªä¸ªåˆ†åŒºï¼Œæ‰¾åˆ†åŒºleaderç­‰ã€‚ç®€å•å…¥é—¨ä½¿ç”¨å¼•å…¥mavenä¾èµ–12345dependency&gt; &lt;groupId&gt;org.apache.kafka&lt;/groupId&gt; &lt;artifactId&gt;kafka-clients&lt;/artifactId&gt; &lt;version&gt;2.2.0&lt;/version&gt;&lt;/dependency&gt;Producerç®€å•ä½¿ç”¨1234567891011121314151617181920212223242526272829303132package com.sonly.kafka;import org.apache.kafka.clients.producer.KafkaProducer;import org.apache.kafka.clients.producer.ProducerConfig;import org.apache.kafka.clients.producer.ProducerRecord;import java.util.Properties;/** * &lt;b&gt;package:com.sonly.kafka&lt;/b&gt; * &lt;b&gt;project(é¡¹ç›®):kafkaAPIdemo&lt;/b&gt; * &lt;b&gt;class(ç±»)demo&lt;/b&gt; * &lt;b&gt;creat date(åˆ›å»ºæ—¶é—´):2019-05-03 12:17&lt;/b&gt; * &lt;b&gt;author(ä½œè€…):&lt;/b&gt;xxydliuyss&lt;/br&gt; * &lt;b&gt;note(å¤‡æ³¨)):&lt;/b&gt; * If you want to change the file header,please modify zhe File and Code Templates. */public class demo &#123; public static void main(String[] args) &#123; Properties properties = new Properties(); properties.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG,\"k8s-n1:9092\"); properties.put(ProducerConfig.ACKS_CONFIG,\"1\"); properties.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG,\"org.apache.kafka.common.serialization.StringSerializer\"); properties.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG,\"org.apache.kafka.common.serialization.StringSerializer\"); KafkaProducer&lt;String, String&gt; producer = new KafkaProducer&lt;String, String&gt;(properties); for (int i = 0; i &lt; 100; i++) producer.send(new ProducerRecord&lt;String, String&gt;(\"mytest\", Integer.toString(i), Integer.toString(i))); producer.close(); &#125;&#125;å¸¦å›è°ƒå‡½æ•°çš„ç”Ÿäº§è€…123456789101112131415161718192021222324252627282930313233343536373839404142434445464748package com.sonly.kafka;import org.apache.kafka.clients.producer.*;import java.util.Properties;/** * &lt;b&gt;package:com.sonly.kafka&lt;/b&gt; * &lt;b&gt;project(é¡¹ç›®):kafkaAPIdemo&lt;/b&gt; * &lt;b&gt;class(ç±»)$&#123;CLASS_NAME&#125;&lt;/b&gt; * &lt;b&gt;creat date(åˆ›å»ºæ—¶é—´):2019-05-03 12:58&lt;/b&gt; * &lt;b&gt;author(ä½œè€…):&lt;/b&gt;xxydliuyss&lt;/br&gt; * &lt;b&gt;note(å¤‡æ³¨)):&lt;/b&gt; * If you want to change the file header,please modify zhe File and Code Templates. */public class demo1 &#123; public static void main(String[] args) &#123; Properties properties = new Properties(); //è®¾ç½®kafkaé›†ç¾¤ properties.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG,\"k8s-n1:9092\"); //è®¾ç½®brokeACKåº”ç­”æœºåˆ¶ properties.put(ProducerConfig.ACKS_CONFIG,\"1\"); //è®¾ç½®keyåºåˆ—åŒ– properties.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG,\"org.apache.kafka.common.serialization.StringSerializer\"); //è®¾ç½®valueåºåˆ—åŒ– properties.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG,\"org.apache.kafka.common.serialization.StringSerializer\"); //è®¾ç½®æ‰¹é‡å¤§å° properties.put(ProducerConfig.BATCH_SIZE_CONFIG,\"6238\"); //è®¾ç½®æäº¤å»¶æ—¶ properties.put(ProducerConfig.LINGER_MS_CONFIG,\"1\"); //è®¾ç½®producerç¼“å­˜ properties.put(ProducerConfig.BUFFER_MEMORY_CONFIG,Long.MAX_VALUE); KafkaProducer&lt;String, String&gt; producer = new KafkaProducer&lt;String, String&gt;(properties); for ( int i = 0; i &lt; 12; i++) &#123; final int finalI = i; producer.send(new ProducerRecord&lt;String, String&gt;(\"mytest\", Integer.toString(i), Integer.toString(i)), new Callback() &#123; public void onCompletion(RecordMetadata metadata, Exception exception) &#123; if(exception==null)&#123; System.out.println(\"å‘é€æˆåŠŸ: \" + finalI +\",\"+metadata.partition()+\",\"+ metadata.offset()); &#125; &#125; &#125;); &#125; producer.close(); &#125;&#125;ç»“æœï¼š123456789101112å‘é€æˆåŠŸ: 0,0,170å‘é€æˆåŠŸ: 2,0,171å‘é€æˆåŠŸ: 11,0,172å‘é€æˆåŠŸ: 4,1,101å‘é€æˆåŠŸ: 5,2,116å‘é€æˆåŠŸ: 6,2,117å‘é€æˆåŠŸ: 10,2,118å‘é€æˆåŠŸ: 1,3,175å‘é€æˆåŠŸ: 3,3,176å‘é€æˆåŠŸ: 7,3,177å‘é€æˆåŠŸ: 8,3,178å‘é€æˆåŠŸ: 9,3,179æ•°æ®ä¸å‡ç­‰çš„åˆ†é…åˆ°0-3 å·åˆ†åŒºä¸Šè‡ªå®šä¹‰åˆ†åŒºå‘é€12345678910111213141516171819202122232425262728package com.sonly.kafka;import org.apache.kafka.clients.producer.Partitioner;import org.apache.kafka.common.Cluster;import java.util.Map;/** * &lt;b&gt;package:com.sonly.kafka&lt;/b&gt; * &lt;b&gt;project(é¡¹ç›®):kafkaAPIdemo&lt;/b&gt; * &lt;b&gt;class(ç±»)$&#123;CLASS_NAME&#125;&lt;/b&gt; * &lt;b&gt;creat date(åˆ›å»ºæ—¶é—´):2019-05-03 13:43&lt;/b&gt; * &lt;b&gt;author(ä½œè€…):&lt;/b&gt;xxydliuyss&lt;/br&gt; * &lt;b&gt;note(å¤‡æ³¨)):&lt;/b&gt; * If you want to change the file header,please modify zhe File and Code Templates. */public class CustomProducer implements Partitioner &#123; public int partition(String topic, Object key, byte[] keyBytes, Object value, byte[] valueBytes, Cluster cluster) &#123; return 0; &#125; public void close() &#123; &#125; public void configure(Map&lt;String, ?&gt; configs) &#123; &#125;&#125;è®¾ç½®åˆ†åŒº12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849package com.sonly.kafka;import org.apache.kafka.clients.producer.*;import java.util.Properties;/** * &lt;b&gt;package:com.sonly.kafka&lt;/b&gt; * &lt;b&gt;project(é¡¹ç›®):kafkaAPIdemo&lt;/b&gt; * &lt;b&gt;class(ç±»)$&#123;CLASS_NAME&#125;&lt;/b&gt; * &lt;b&gt;creat date(åˆ›å»ºæ—¶é—´):2019-05-03 13:46&lt;/b&gt; * &lt;b&gt;author(ä½œè€…):&lt;/b&gt;xxydliuyss&lt;/br&gt; * &lt;b&gt;note(å¤‡æ³¨)):&lt;/b&gt; * If you want to change the file header,please modify zhe File and Code Templates. */public class demo2 &#123; public static void main(String[] args) &#123; Properties properties = new Properties(); //è®¾ç½®kafkaé›†ç¾¤ properties.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG,\"k8s-n1:9092\"); //è®¾ç½®brokeACKåº”ç­”æœºåˆ¶ properties.put(ProducerConfig.ACKS_CONFIG,\"1\"); //è®¾ç½®keyåºåˆ—åŒ– properties.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG,\"org.apache.kafka.common.serialization.StringSerializer\"); //è®¾ç½®valueåºåˆ—åŒ– properties.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG,\"org.apache.kafka.common.serialization.StringSerializer\"); //è®¾ç½®æ‰¹é‡å¤§å° properties.put(ProducerConfig.BATCH_SIZE_CONFIG,\"6238\"); //è®¾ç½®æäº¤å»¶æ—¶ properties.put(ProducerConfig.LINGER_MS_CONFIG,\"1\"); //è®¾ç½®producerç¼“å­˜ properties.put(ProducerConfig.BUFFER_MEMORY_CONFIG,Long.MAX_VALUE); //è®¾ç½®partition properties.put(ProducerConfig.PARTITIONER_CLASS_CONFIG,\"com.sonly.kafka.CustomProducer\"); KafkaProducer&lt;String, String&gt; producer = new KafkaProducer&lt;String, String&gt;(properties); for ( int i = 0; i &lt; 12; i++) &#123; final int finalI = i; producer.send(new ProducerRecord&lt;String, String&gt;(\"mytest\", Integer.toString(i), Integer.toString(i)), new Callback() &#123; public void onCompletion(RecordMetadata metadata, Exception exception) &#123; if(exception==null)&#123; System.out.println(\"å‘é€æˆåŠŸ: \" + finalI +\",\"+metadata.partition()+\",\"+ metadata.offset()); &#125; &#125; &#125;); &#125; producer.close(); &#125;&#125;æ¶ˆè´¹è€…é«˜çº§APIï¼š1234567891011121314151617181920212223242526272829303132333435363738394041424344454647package com.sonly.kafka.consumer;import org.apache.kafka.clients.consumer.ConsumerConfig;import org.apache.kafka.clients.consumer.ConsumerRecord;import org.apache.kafka.clients.consumer.ConsumerRecords;import org.apache.kafka.clients.consumer.KafkaConsumer;import org.apache.kafka.clients.producer.ProducerConfig;import java.util.Arrays;import java.util.Properties;/** * &lt;b&gt;package:com.sonly.kafka.consumer&lt;/b&gt; * &lt;b&gt;project(é¡¹ç›®):kafkaAPIdemo&lt;/b&gt; * &lt;b&gt;class(ç±»)$&#123;CLASS_NAME&#125;&lt;/b&gt; * &lt;b&gt;creat date(åˆ›å»ºæ—¶é—´):2019-05-03 13:59&lt;/b&gt; * &lt;b&gt;author(ä½œè€…):&lt;/b&gt;xxydliuyss&lt;/br&gt; * &lt;b&gt;note(å¤‡æ³¨)):&lt;/b&gt; * If you want to change the file header,please modify zhe File and Code Templates. */public class ConsumerDemo &#123; public static void main(String[] args) &#123; Properties properties = new Properties(); //è®¾ç½®kafkaé›†ç¾¤ properties.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG,\"k8s-n1:9092\"); //è®¾ç½®brokeACKåº”ç­”æœºåˆ¶ properties.put(ConsumerConfig.GROUP_ID_CONFIG,\"teste3432\"); //è®¾ç½®keyååºåˆ—åŒ– properties.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG,\"org.apache.kafka.common.serialization.StringDeserializer\"); //è®¾ç½®valueååºåˆ—åŒ– properties.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG,\"org.apache.kafka.common.serialization.StringDeserializer\"); //è®¾ç½®æ‹¿å–å¤§å° properties.put(ConsumerConfig.FETCH_MAX_BYTES_CONFIG,100*1024*1024); //è®¾ç½®è‡ªåŠ¨æäº¤offset properties.put(ConsumerConfig.ENABLE_AUTO_COMMIT_CONFIG,true); //è®¾ç½®è‡ªåŠ¨æäº¤å»¶æ—¶ properties.put(ConsumerConfig.AUTO_COMMIT_INTERVAL_MS_CONFIG,1000); KafkaConsumer&lt;String, String&gt; consumer = new KafkaConsumer&lt;String, String&gt;(properties); consumer.subscribe(Arrays.asList(\"mytest\",\"test\")); while (true)&#123; ConsumerRecords&lt;String, String&gt; records = consumer.poll(10); for (ConsumerRecord&lt;String, String&gt; record : records) &#123; System.out.println(record.topic()+\"--\"+record.partition()+\"--\"+record.value()); &#125; &#125; &#125;&#125;ä½çº§APIï¼š1.æ¶ˆè´¹è€…ä½¿ç”¨ä½çº§APIçš„ä¸»è¦æ­¥éª¤æ­¥éª¤ä¸»è¦å·¥ä½œ1æ ¹æ®æŒ‡å®šåˆ†åŒºä»topicå…ƒæ•°æ®ä¸­æ‰¾åˆ°leader2è·å–åˆ†åŒºæœ€æ–°çš„æ¶ˆè´¹è¿›åº¦3ä»ä¸»å‰¯æœ¬ä¸­æ‹‰å–åˆ†åŒºæ¶ˆæ¯4è¯†åˆ«ä¸»å‰¯æœ¬çš„å˜åŒ–ï¼Œé‡è¯•2.æ–¹æ³•æè¿°ï¼šæ–¹æ³•æè¿°findLeader()å®¢æˆ·ç«¯å‘ç§å­é˜¶æ®µå‘é€ä¸»é¢˜å…ƒæ•°æ®ï¼Œå°†å‰¯æœ¬åŠ å…¥å¤‡ç”¨èŠ‚ç‚¹getLastOffset()æ¶ˆè´¹è€…å®¢æˆ·ç«¯å‘é€åç§»é‡è¯·æ±‚ï¼Œè·å–åˆ†åŒºæœ€è¿‘çš„åç§»é‡run()æ¶ˆè´¹è€…ä½çº§APIæ‹‰å–æ¶ˆæ¯çš„æ–¹æ³•findNewLeader()å½“åˆ†åŒºä¸»å‰¯æœ¬èŠ‚ç‚¹å‘ç”Ÿæ•…éšœæ—¶ï¼Œå®¢æˆ·ç«¯å°†è¦æ‰¾å‡ºæ–°çš„ä¸»å‰¯æœ¬ä¿®æ”¹pom12345678910&lt;dependency&gt; &lt;groupId&gt;org.apache.kafka&lt;/groupId&gt; &lt;artifactId&gt;kafka_2.11&lt;/artifactId&gt; &lt;version&gt;1.1.1&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.apache.kafka&lt;/groupId&gt; &lt;artifactId&gt;kafka-clients&lt;/artifactId&gt; &lt;version&gt;1.1.1&lt;/version&gt;&lt;/dependency&gt;123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106package com.sonly.kafka.consumer;import kafka.api.FetchRequest;import kafka.api.FetchRequestBuilder;import kafka.api.KAFKA_0_8_1$;import kafka.cluster.BrokerEndPoint;import kafka.javaapi.*;import kafka.javaapi.consumer.SimpleConsumer;import kafka.javaapi.message.ByteBufferMessageSet;import kafka.message.MessageAndOffset;import org.apache.kafka.clients.consumer.Consumer;import java.nio.ByteBuffer;import java.util.*;import java.util.concurrent.TimeUnit;/** * &lt;b&gt;package:com.sonly.kafka.consumer&lt;/b&gt; * &lt;b&gt;project(é¡¹ç›®):kafkaAPIdemo&lt;/b&gt; * &lt;b&gt;class(ç±»)$&#123;CLASS_NAME&#125;&lt;/b&gt; * &lt;b&gt;creat date(åˆ›å»ºæ—¶é—´):2019-05-03 15:21&lt;/b&gt; * &lt;b&gt;author(ä½œè€…):&lt;/b&gt;xxydliuyss&lt;/br&gt; * &lt;b&gt;note(å¤‡æ³¨)):&lt;/b&gt; * If you want to change the file header,please modify zhe File and Code Templates. */public class LowerConsumer &#123; //ä¿å­˜offset private long offset; //ä¿å­˜åˆ†åŒºå‰¯æœ¬ private Map&lt;Integer,List&lt;BrokerEndPoint&gt;&gt; partitionsMap = new HashMap&lt;Integer, List&lt;BrokerEndPoint&gt;&gt;(1024); public static void main(String[] args) throws InterruptedException &#123; List&lt;String&gt; brokers = Arrays.asList(\"k8s-n1\", \"k8s-n2\",\"k8s-n3\"); int port = 9092; int partition = 1; long offset=2; LowerConsumer lowerConsumer = new LowerConsumer(); while(true)&#123;// offset = lowerConsumer.getOffset(); lowerConsumer.getData(brokers,port,\"mytest\",partition,offset); TimeUnit.SECONDS.sleep(1); &#125; &#125; public long getOffset() &#123; return offset; &#125; private BrokerEndPoint findLeader(Collection&lt;String&gt; brokers,int port,String topic,int partition)&#123; for (String broker : brokers) &#123; //åˆ›å»ºæ¶ˆè´¹è€…å¯¹è±¡æ“ä½œæ¯ä¸€å°æœåŠ¡å™¨ SimpleConsumer getLeader = new SimpleConsumer(broker, port, 10000, 1024 * 24, \"getLeader\"); //æ„é€ å…ƒæ•°æ®è¯·æ±‚ TopicMetadataRequest topicMetadataRequest = new TopicMetadataRequest(Collections.singletonList(topic)); //å‘é€å…ƒæ•°æ®è¯·æ±‚ TopicMetadataResponse response = getLeader.send(topicMetadataRequest); //è§£æå…ƒæ•°æ® List&lt;TopicMetadata&gt; topicMetadatas = response.topicsMetadata(); //éå†æ•°æ® for (TopicMetadata topicMetadata : topicMetadatas) &#123; //è·å–åˆ†åŒºå…ƒæ•°æ®ä¿¡æ¯ List&lt;PartitionMetadata&gt; partitionMetadatas = topicMetadata.partitionsMetadata(); //éå†åˆ†åŒºå…ƒæ•°æ® for (PartitionMetadata partitionMetadata : partitionMetadatas) &#123; if(partition == partitionMetadata.partitionId())&#123; //ä¿å­˜ï¼Œåˆ†åŒºå¯¹åº”çš„å‰¯æœ¬ï¼Œå¦‚æœéœ€è¦ä¸»å‰¯æœ¬æŒ‚æ‰é‡æ–°è·å–leaderåªéœ€è¦éå†è¿™ä¸ªç¼“å­˜å³å¯ List&lt;BrokerEndPoint&gt; isr = partitionMetadata.isr(); this.partitionsMap.put(partition,isr); return partitionMetadata.leader(); &#125; &#125; &#125; &#125; return null; &#125; private void getData(Collection&lt;String&gt; brokers,int port,String topic,int partition,long offset)&#123; //è·å–leader BrokerEndPoint leader = findLeader(brokers, port, topic, partition); if(leader==null) return; String host = leader.host(); //è·å–æ•°æ®çš„æ¶ˆè´¹è€…å¯¹è±¡ SimpleConsumer getData = new SimpleConsumer(host, port, 10000, 1024 * 10, \"getData\"); //æ„é€ è·å–æ•°æ®request è¿™é‡Œä¸€æ¬¡å¯ä»¥æ·»åŠ å¤šä¸ªtopic addFecth æ·»åŠ å³å¯ FetchRequest fetchRequestBuilder = new FetchRequestBuilder().addFetch(topic, partition, offset, 1024 * 10).build(); //å‘é€è·å–æ•°æ®è¯·æ±‚ FetchResponse fetchResponse = getData.fetch(fetchRequestBuilder); //è§£æå…ƒæ•°æ®è¿”å›ï¼Œè¿™æ˜¯messageçš„ä¸€ä¸ªseté›†åˆ ByteBufferMessageSet messageAndOffsets = fetchResponse.messageSet(topic, partition); //éå†æ¶ˆæ¯é›†åˆ for (MessageAndOffset messageAndOffset : messageAndOffsets) &#123; long offset1 = messageAndOffset.offset(); this.setOffset(offset); ByteBuffer payload = messageAndOffset.message().payload(); byte[] buffer = new byte[payload.limit()]; payload.get(buffer); String message = new String(buffer); System.out.println(\"offset:\"+ offset1 +\"--message:\"+ message); &#125; &#125; private void setOffset(long offset) &#123; this.offset = offset; &#125;&#125;è¿™ä¸ªä½çº§APIåœ¨æœ€æ–°çš„kafkaç‰ˆæœ¬ä¸­å·²ç»ä¸å†æä¾›äº†ã€‚","categories":[{"name":"æ¶ˆæ¯é˜Ÿåˆ—","slug":"æ¶ˆæ¯é˜Ÿåˆ—","permalink":"http://www.liuyong520.cn/categories/æ¶ˆæ¯é˜Ÿåˆ—/"}],"tags":[{"name":"kafka","slug":"kafka","permalink":"http://www.liuyong520.cn/tags/kafka/"}]},{"title":"Linuxä¸‹kafkaé›†ç¾¤æ­å»º","slug":"kafka-install","date":"2019-04-29T02:56:51.000Z","updated":"2019-04-30T02:48:31.425Z","comments":true,"path":"2019/04/29/kafka-install/","link":"","permalink":"http://www.liuyong520.cn/2019/04/29/kafka-install/","excerpt":"","text":"ç¯å¢ƒå‡†å¤‡zookeeperé›†ç¾¤ç¯å¢ƒkafkaæ˜¯ä¾èµ–äºzookeeperæ³¨å†Œä¸­å¿ƒçš„ä¸€æ¬¾åˆ†å¸ƒå¼æ¶ˆæ¯å¯¹åˆ—ï¼Œæ‰€ä»¥éœ€è¦æœ‰zookeeperå•æœºæˆ–è€…é›†ç¾¤ç¯å¢ƒã€‚ä¸‰å°æœåŠ¡å™¨ï¼š123172.16.18.198 k8s-n1172.16.18.199 k8s-n2172.16.18.200 k8s-n3ä¸‹è½½kafkaå®‰è£…åŒ…http://kafka.apache.org/downloads ä¸­ä¸‹è½½ï¼Œç›®å‰æœ€æ–°ç‰ˆæœ¬çš„kafkaå·²ç»åˆ°2.2.0,æˆ‘è¿™é‡Œä¹‹å‰ä¸‹è½½çš„æ˜¯kafka_2.11-2.2.0.tgz.å®‰è£…kafkaé›†ç¾¤ä¸Šä¼ å‹ç¼©åŒ…åˆ°ä¸‰å°æœåŠ¡å™¨è§£å‹ç¼©åˆ°/opt/ç›®å½•ä¸‹12tar -zxvf kafka_2.11-2.2.0.tgz -C /opt/ls -s kafka_2.11-2.2.0 kafkaä¿®æ”¹ server.properties123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121############################# Server Basics ############################## The id of the broker. This must be set to a unique integer for each broker.broker.id=0############################# Socket Server Settings ############################## The address the socket server listens on. It will get the value returned from # java.net.InetAddress.getCanonicalHostName() if not configured.# FORMAT:# listeners = listener_name://host_name:port# EXAMPLE:# listeners = PLAINTEXT://your.host.name:9092listeners=PLAINTEXT://k8s-n1:9092# Hostname and port the broker will advertise to producers and consumers. If not set, # it uses the value for &quot;listeners&quot; if configured. Otherwise, it will use the value# returned from java.net.InetAddress.getCanonicalHostName().advertised.listeners=PLAINTEXT://k8s-n1:9092# Maps listener names to security protocols, the default is for them to be the same. See the config documentation for more details#listener.security.protocol.map=PLAINTEXT:PLAINTEXT,SSL:SSL,SASL_PLAINTEXT:SASL_PLAINTEXT,SASL_SSL:SASL_SSL# The number of threads that the server uses for receiving requests from the network and sending responses to the networknum.network.threads=3# The number of threads that the server uses for processing requests, which may include disk I/Onum.io.threads=8# The send buffer (SO_SNDBUF) used by the socket serversocket.send.buffer.bytes=102400# The receive buffer (SO_RCVBUF) used by the socket serversocket.receive.buffer.bytes=102400# The maximum size of a request that the socket server will accept (protection against OOM)socket.request.max.bytes=104857600############################# Log Basics ############################## A comma separated list of directories under which to store log fileslog.dirs=/var/applog/kafka/# The default number of log partitions per topic. More partitions allow greater# parallelism for consumption, but this will also result in more files across# the brokers.num.partitions=5# The number of threads per data directory to be used for log recovery at startup and flushing at shutdown.# This value is recommended to be increased for installations with data dirs located in RAID array.num.recovery.threads.per.data.dir=1############################# Internal Topic Settings ############################## The replication factor for the group metadata internal topics &quot;__consumer_offsets&quot; and &quot;__transaction_state&quot;# For anything other than development testing, a value greater than 1 is recommended for to ensure availability such as 3.offsets.topic.replication.factor=1transaction.state.log.replication.factor=1transaction.state.log.min.isr=1############################# Log Flush Policy ############################## Messages are immediately written to the filesystem but by default we only fsync() to sync# the OS cache lazily. The following configurations control the flush of data to disk.# There are a few important trade-offs here:# 1. Durability: Unflushed data may be lost if you are not using replication.# 2. Latency: Very large flush intervals may lead to latency spikes when the flush does occur as there will be a lot of data to flush.# 3. Throughput: The flush is generally the most expensive operation, and a small flush interval may lead to excessive seeks.# The settings below allow one to configure the flush policy to flush data after a period of time or# every N messages (or both). This can be done globally and overridden on a per-topic basis.# The number of messages to accept before forcing a flush of data to disklog.flush.interval.messages=10000# The maximum amount of time a message can sit in a log before we force a flushlog.flush.interval.ms=1000############################# Log Retention Policy ############################## The following configurations control the disposal of log segments. The policy can# be set to delete segments after a period of time, or after a given size has accumulated.# A segment will be deleted whenever *either* of these criteria are met. Deletion always happens# from the end of the log.# The minimum age of a log file to be eligible for deletion due to agelog.retention.hours=24# A size-based retention policy for logs. Segments are pruned from the log unless the remaining# segments drop below log.retention.bytes. Functions independently of log.retention.hours.#log.retention.bytes=1073741824# The maximum size of a log segment file. When this size is reached a new log segment will be created.log.segment.bytes=1073741824# The interval at which log segments are checked to see if they can be deleted according# to the retention policieslog.retention.check.interval.ms=300000############################# Zookeeper ############################## Zookeeper connection string (see zookeeper docs for details).# This is a comma separated host:port pairs, each corresponding to a zk# server. e.g. &quot;127.0.0.1:3000,127.0.0.1:3001,127.0.0.1:3002&quot;.# You can also append an optional chroot string to the urls to specify the# root directory for all kafka znodes.zookeeper.connect=k8s-n1:2181,k8s-n2:2181,k8s-n3:2181# Timeout in ms for connecting to zookeeperzookeeper.connection.timeout.ms=6000############################# Group Coordinator Settings ############################## The following configuration specifies the time, in milliseconds, that the GroupCoordinator will delay the initial consumer rebalance.# The rebalance will be further delayed by the value of group.initial.rebalance.delay.ms as new members join the group, up to a maximum of max.poll.interval.ms.# The default value for this is 3 seconds.# We override this to 0 here as it makes for a better out-of-the-box experience for development and testing.# However, in production environments the default value of 3 seconds is more suitable as this will help to avoid unnecessary, and potentially expensive, rebalances during application startup.group.initial.rebalance.delay.ms=0delete.topic.enable=trueæ‹·è´ä¸¤ä»½åˆ°k8s-n2,k8s-n3123456789[root@k8s-n2 config]# cat server.properties broker.id=1listeners=PLAINTEXT://k8s-n2:9092advertised.listeners=PLAINTEXT://k8s-n2:9092[root@k8s-n3 config]# cat server.propertiesbroker.id=2listeners=PLAINTEXT://k8s-n3:9092advertised.listeners=PLAINTEXT://k8s-n3:9092æ·»åŠ ç¯å¢ƒå˜é‡ åœ¨/etc/profile ä¸­æ·»åŠ 12export ZOOKEEPER_HOME=/opt/kafka_2.11-2.2.0export PATH=$PATH:$ZOOKEEPER_HOME/binsource /etc/profile é‡è½½ç”Ÿæ•ˆå¯åŠ¨kafka1kafka-server-start.sh config/server.properties &amp;Zookeeper+Kafkaé›†ç¾¤æµ‹è¯•åˆ›å»ºtopic:1kafka-topics.sh --create --zookeeper k8s-n1:2181, k8s-n2:2181, k8s-n3:2181 --replication-factor 3 --partitions 3 --topic testæ˜¾ç¤ºtopic1kafka-topics.sh --describe --zookeeper k8s-n1:2181, k8s-n2:2181, k8s-n3:2181 --topic teståˆ—å‡ºtopic12kafka-topics.sh --list --zookeeper k8s-n1:2181, k8s-n2:2181, k8s-n3:2181teståˆ›å»º producer(ç”Ÿäº§è€…);12kafka-console-producer.sh --broker-list k8s-n1:9092 --topic testhelloåˆ›å»º consumerï¼ˆæ¶ˆè´¹è€…ï¼‰12kafka-console-consumer.sh --bootstrap-server k8s-n1:9092 --topic test --from-beginninghelloè‡³æ­¤ï¼Œkafkaé›†ç¾¤æ­å»ºå°±å·²ç»å®Œæˆäº†ã€‚","categories":[{"name":"æ¶ˆæ¯é˜Ÿåˆ—","slug":"æ¶ˆæ¯é˜Ÿåˆ—","permalink":"http://www.liuyong520.cn/categories/æ¶ˆæ¯é˜Ÿåˆ—/"}],"tags":[{"name":"kafka","slug":"kafka","permalink":"http://www.liuyong520.cn/tags/kafka/"},{"name":"linux","slug":"linux","permalink":"http://www.liuyong520.cn/tags/linux/"}]},{"title":"kafkaåŸºæœ¬ä»‹ç»","slug":"kafka-intruduce","date":"2019-04-29T02:56:51.000Z","updated":"2019-05-02T11:30:40.781Z","comments":true,"path":"2019/04/29/kafka-intruduce/","link":"","permalink":"http://www.liuyong520.cn/2019/04/29/kafka-intruduce/","excerpt":"","text":"kafkaæ˜¯ä»€ä¹ˆï¼ŸKafkaæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼æµå¼å­˜å‚¨å¹¶å¤„ç†çš„æ¶ˆæ¯é˜Ÿåˆ—ã€‚ç”±scale+javaè¯­è¨€ç¼–å†™ï¼Œå®ƒæä¾›äº†ç±»ä¼¼äºJMSçš„ç‰¹æ€§ï¼Œä½†æ˜¯åœ¨è®¾è®¡å®ç°ä¸Šåˆå®Œå…¨ä¸åŒï¼Œå› ä¸ºkafkaå¹¶ä¸æ˜¯æŒ‰ç…§JMSè§„èŒƒå®ç°çš„ã€‚kafkaé›†ç¾¤ç”±å¤šä¸ªbrokeï¼ˆKafkaå®ä¾‹ç§°ä¹‹ä¸ºbrokeï¼‰ç»„æˆï¼Œåœ¨é›†ç¾¤é‡Œï¼Œkafkaé€šè¿‡æ¶ˆæ¯è®¢é˜…å’Œå‘å¸ƒå°†æ¶ˆæ¯ä»¥topicçš„å½¢å¼å‘å¸ƒå‡ºæ¥ï¼ŒåŒæ—¶ï¼Œæ¶ˆæ¯ä¹Ÿæ˜¯å­˜å‚¨åœ¨topicä¸­çš„ï¼Œæ¶ˆæ¯çš„å‘é€è€…æˆä¸ºproducerï¼Œæ¶ˆæ¯æ¥å—è€…æˆä¸ºConsummerã€‚åŒæ—¶ï¼Œtopic æ˜¯æ ¹æ®åˆ†åŒºpartitionsï¼Œå’Œå‰¯æœ¬replicationsæ¥å®ç°çš„æ•°æ®çš„åˆ†å¸ƒå¼å­˜å‚¨ï¼Œå’ŒåŠ å¼ºæ•°æ®çš„å¯é æ€§ã€‚ä½•ä¸ºtopicï¼Ÿä¸€ä¸ªtopicå¯ä»¥è®¤ä¸ºæ˜¯ä¸€ç±»æ¶ˆæ¯ï¼Œæ¯ä¸ªtopicå°†è¢«åˆ†æˆå¤šä¸ªpartitionsï¼Œæ¯ä¸ªpartitionåœ¨å­˜å‚¨append logçš„å½¢å¼å­˜åœ¨æ–‡ä»¶é‡Œçš„ã€‚ä»»ä½•å‘å¸ƒåˆ°partitionçš„æ¶ˆæ¯éƒ½ä¼šç›´æ¥è¢«è¿½åŠ åˆ°logæ–‡ä»¶çš„æœ«å°¾ï¼Œæ¯æ¡æ¶ˆæ¯åœ¨æ–‡ä»¶ä¸­çš„ä½ç½®ç§°ä¹‹ä¸ºoffsetåç§»é‡ï¼Œoffsetä¸ºä¸€ä¸ªlongå‹æ•°å­—ï¼Œå®ƒå”¯ä¸€æ ‡è¯†ä¸€æ¡æ¶ˆæ¯ï¼Œkafkaå¹¶æ²¡æœ‰æä¾›å…¶ä»–ç´¢å¼•æ¥å­˜å‚¨offsetï¼Œå› æ­¤kafkaä¸æ”¯æŒæ¶ˆæ¯çš„éšæœºè¯»å†™ã€‚kafkaå’ŒJMSï¼ˆJava Message Serviceï¼‰å®ç°(activeMQ)ä¸åŒçš„æ˜¯:å³ä½¿æ¶ˆæ¯è¢«æ¶ˆè´¹,æ¶ˆæ¯ä»ç„¶ä¸ä¼šè¢«ç«‹å³åˆ é™¤.æ—¥å¿—æ–‡ä»¶å°†ä¼šæ ¹æ®brokerä¸­çš„é…ç½®è¦æ±‚,ä¿ç•™ä¸€å®šçš„æ—¶é—´ä¹‹å(é»˜è®¤æ˜¯7å¤©)åˆ é™¤;æ¯”å¦‚logæ–‡ä»¶ä¿ç•™2å¤©,é‚£ä¹ˆä¸¤å¤©å,æ–‡ä»¶ä¼šè¢«æ¸…é™¤,æ— è®ºå…¶ä¸­çš„æ¶ˆæ¯æ˜¯å¦è¢«æ¶ˆè´¹.kafkaé€šè¿‡è¿™ç§ç®€å•çš„æ‰‹æ®µ,æ¥é‡Šæ”¾ç£ç›˜ç©ºé—´,ä»¥åŠå‡å°‘æ¶ˆæ¯æ¶ˆè´¹ä¹‹åå¯¹æ–‡ä»¶å†…å®¹æ”¹åŠ¨çš„ç£ç›˜IOå¼€æ”¯.kafkaæ¶ˆæ¯å¦‚ä½•æ¶ˆè´¹çš„ï¼Ÿå¯¹äºconsumerè€Œè¨€,å®ƒéœ€è¦ä¿å­˜æ¶ˆè´¹æ¶ˆæ¯çš„offset,å¯¹äºoffsetçš„ä¿å­˜å’Œä½¿ç”¨,æœ‰consumeræ¥æ§åˆ¶;å½“consumeræ­£å¸¸æ¶ˆè´¹æ¶ˆæ¯æ—¶,offsetå°†ä¼šâ€çº¿æ€§â€çš„å‘å‰é©±åŠ¨,å³æ¶ˆæ¯å°†ä¾æ¬¡é¡ºåºè¢«æ¶ˆè´¹.äº‹å®ä¸Šconsumerå¯ä»¥ä½¿ç”¨ä»»æ„é¡ºåºæ¶ˆè´¹æ¶ˆæ¯,å®ƒåªéœ€è¦å°†offseté‡ç½®ä¸ºä»»æ„å€¼..(kafka è€ç‰ˆæœ¬ä¸­offsetå°†ä¼šä¿å­˜åœ¨zookeeperä¸­,1.xä¹‹åä¹Ÿä¼šå­˜å‚¨åœ¨brokeé›†ç¾¤é‡Œ,å‚è§ä¸‹æ–‡)kafka é›†ç¾¤é‡Œconsumerå’Œproducerçš„çŠ¶æ€ä¿¡æ¯æ˜¯å¦‚ä½•ä¿å­˜çš„ï¼Ÿkafkaé›†ç¾¤å‡ ä¹ä¸éœ€è¦ç»´æŠ¤ä»»ä½•consumerå’ŒproducerçŠ¶æ€ä¿¡æ¯,è¿™äº›ä¿¡æ¯ç”±zookeeperä¿å­˜;å› æ­¤producerå’Œconsumerçš„å®¢æˆ·ç«¯å®ç°éå¸¸è½»é‡çº§,å®ƒä»¬å¯ä»¥éšæ„ç¦»å¼€,è€Œä¸ä¼šå¯¹é›†ç¾¤é€ æˆé¢å¤–çš„å½±å“.kafkaä¸ºä½•è¦å¼•å…¥åˆ†åŒºçš„æ¦‚å¿µï¼Œæœ‰ä½•å¥½å¤„ï¼Ÿpartitionsçš„è®¾è®¡ç›®çš„æœ‰å¤šä¸ª.æœ€æ ¹æœ¬åŸå› æ˜¯kafkaåŸºäºæ–‡ä»¶å­˜å‚¨.é€šè¿‡åˆ†åŒº,å¯ä»¥å°†æ—¥å¿—å†…å®¹åˆ†æ•£åˆ°å¤šä¸ªkafkaå®ä¾‹ä¸Š,æ¥é¿å…æ–‡ä»¶å°ºå¯¸è¾¾åˆ°å•æœºç£ç›˜çš„ä¸Šé™,æ¯ä¸ªpartitonéƒ½ä¼šè¢«å½“å‰server(kafkaå®ä¾‹)ä¿å­˜;å¯ä»¥å°†ä¸€ä¸ªtopicåˆ‡åˆ†å¤šä»»æ„å¤šä¸ªpartitions,æ¥æ¶ˆæ¯ä¿å­˜/æ¶ˆè´¹çš„æ•ˆç‡.æ­¤å¤–è¶Šå¤šçš„partitionsæ„å‘³ç€å¯ä»¥å®¹çº³æ›´å¤šçš„consumer,æœ‰æ•ˆæå‡å¹¶å‘æ¶ˆè´¹çš„èƒ½åŠ›.æœ‰è´Ÿè½½å‡è¡¡çš„åŠŸæ•ˆ(å…·ä½“åŸç†å‚è§ä¸‹æ–‡).kakfaæ•°æ®æ˜¯å¦‚ä½•å†™å…¥åˆ°ç£ç›˜çš„ï¼Ÿä¸€ä¸ªTopicçš„å¤šä¸ªpartitions,è¢«åˆ†å¸ƒåœ¨kafkaé›†ç¾¤ä¸­çš„å¤šä¸ªserverä¸Š;æ¯ä¸ªserver(kafkaå®ä¾‹)è´Ÿè´£partitionsä¸­æ¶ˆæ¯çš„è¯»å†™æ“ä½œ;æ­¤å¤–kafkaè¿˜å¯ä»¥é…ç½®partitionséœ€è¦å¤‡ä»½çš„ä¸ªæ•°(replicas),æ¯ä¸ªpartitionå°†ä¼šè¢«å¤‡ä»½åˆ°å¤šå°æœºå™¨ä¸Š,ä»¥æé«˜å¯ç”¨æ€§.åŸºäºreplicatedæ–¹æ¡ˆ,é‚£ä¹ˆå°±æ„å‘³ç€éœ€è¦å¯¹å¤šä¸ªå¤‡ä»½è¿›è¡Œè°ƒåº¦;æ¯ä¸ªpartitionéƒ½æœ‰ä¸€ä¸ªserverä¸ºâ€leaderâ€;leaderè´Ÿè´£æ‰€æœ‰çš„è¯»å†™æ“ä½œ,å¦‚æœleaderå¤±æ•ˆ,é‚£ä¹ˆå°†ä¼šæœ‰å…¶ä»–followeræ¥æ¥ç®¡(æˆä¸ºæ–°çš„leader);followeråªæ˜¯å•è°ƒçš„å’Œleaderè·Ÿè¿›,åŒæ­¥æ¶ˆæ¯å³å¯..ç”±æ­¤å¯è§ä½œä¸ºleaderçš„serveræ‰¿è½½äº†å…¨éƒ¨çš„è¯·æ±‚å‹åŠ›,å› æ­¤ä»é›†ç¾¤çš„æ•´ä½“è€ƒè™‘,æœ‰å¤šå°‘ä¸ªpartitionså°±æ„å‘³ç€æœ‰å¤šå°‘ä¸ªâ€leaderâ€,kafkaä¼šå°†â€leaderâ€å‡è¡¡çš„åˆ†æ•£åœ¨æ¯ä¸ªå®ä¾‹ä¸Š,æ¥ç¡®ä¿æ•´ä½“çš„æ€§èƒ½ç¨³å®š.è¿™å’Œzookeeperçš„followeræ˜¯æœ‰åŒºåˆ«çš„ï¼šzookeeperçš„followeræ˜¯å¯ä»¥è¯»åˆ°æ•°æ®çš„ï¼Œè€Œkafkaçš„followeræ˜¯è¯»ä¸åˆ°æ•°æ®çš„ã€‚kafkaä½¿ç”¨æ–‡ä»¶å­˜å‚¨æ¶ˆæ¯,è¿™å°±ç›´æ¥å†³å®škafkaåœ¨æ€§èƒ½ä¸Šä¸¥é‡ä¾èµ–æ–‡ä»¶ç³»ç»Ÿçš„æœ¬èº«ç‰¹æ€§.ä¸”æ— è®ºä»»ä½•OSä¸‹,å¯¹æ–‡ä»¶ç³»ç»Ÿæœ¬èº«çš„ä¼˜åŒ–å‡ ä¹æ²¡æœ‰å¯èƒ½.æ–‡ä»¶ç¼“å­˜/ç›´æ¥å†…å­˜æ˜ å°„ç­‰æ˜¯å¸¸ç”¨çš„æ‰‹æ®µ.å› ä¸ºkafkaæ˜¯å¯¹æ—¥å¿—æ–‡ä»¶è¿›è¡Œappendæ“ä½œ,å› æ­¤ç£ç›˜æ£€ç´¢çš„å¼€æ”¯æ˜¯è¾ƒå°çš„;åŒæ—¶ä¸ºäº†å‡å°‘ç£ç›˜å†™å…¥çš„æ¬¡æ•°,brokerä¼šå°†æ¶ˆæ¯æš‚æ—¶bufferèµ·æ¥,å½“æ¶ˆæ¯çš„ä¸ªæ•°(æˆ–å°ºå¯¸)è¾¾åˆ°ä¸€å®šé˜€å€¼æ—¶,å†flushåˆ°ç£ç›˜,è¿™æ ·å‡å°‘äº†ç£ç›˜IOè°ƒç”¨çš„æ¬¡æ•°.kafkaä¸­æ¶ˆè´¹è€…ç»„å¦‚ä½•ç†è§£ï¼ŸProducerå°†æ¶ˆæ¯å‘å¸ƒåˆ°æŒ‡å®šçš„Topicä¸­,åŒæ—¶Producerä¹Ÿèƒ½å†³å®šå°†æ­¤æ¶ˆæ¯å½’å±äºå“ªä¸ªpartition;æ¯”å¦‚åŸºäºâ€round-robinâ€æ–¹å¼æˆ–è€…é€šè¿‡å…¶ä»–çš„ä¸€äº›ç®—æ³•ç­‰.æœ¬è´¨ä¸Škafkaåªæ”¯æŒTopic.æ¯ä¸ªconsumerå±äºä¸€ä¸ªconsumer group;åè¿‡æ¥è¯´,æ¯ä¸ªgroupä¸­å¯ä»¥æœ‰å¤šä¸ªconsumer.å‘é€åˆ°Topicçš„æ¶ˆæ¯,åªä¼šè¢«è®¢é˜…æ­¤Topicçš„æ¯ä¸ªgroupä¸­çš„ä¸€ä¸ªconsumeræ¶ˆè´¹.å¦‚æœæ‰€æœ‰çš„consumeréƒ½å…·æœ‰ç›¸åŒçš„group,è¿™ç§æƒ…å†µå’Œqueueæ¨¡å¼å¾ˆåƒ;æ¶ˆæ¯å°†ä¼šåœ¨consumersä¹‹é—´è´Ÿè½½å‡è¡¡.å¦‚æœæ‰€æœ‰çš„consumeréƒ½å…·æœ‰ä¸åŒçš„group,é‚£è¿™å°±æ˜¯â€å‘å¸ƒ-è®¢é˜…â€;æ¶ˆæ¯å°†ä¼šå¹¿æ’­ç»™æ‰€æœ‰çš„æ¶ˆè´¹è€….åœ¨kafkaä¸­,ä¸€ä¸ªpartitionä¸­çš„æ¶ˆæ¯åªä¼šè¢«groupä¸­çš„ä¸€ä¸ªconsumeræ¶ˆè´¹;æ¯ä¸ªgroupä¸­consumeræ¶ˆæ¯æ¶ˆè´¹äº’ç›¸ç‹¬ç«‹;æˆ‘ä»¬å¯ä»¥è®¤ä¸ºä¸€ä¸ªgroupæ˜¯ä¸€ä¸ªâ€è®¢é˜…â€è€…,ä¸€ä¸ªTopicä¸­çš„æ¯ä¸ªpartions,åªä¼šè¢«ä¸€ä¸ªâ€è®¢é˜…è€…â€ä¸­çš„ä¸€ä¸ªconsumeræ¶ˆè´¹,ä¸è¿‡ä¸€ä¸ªconsumerå¯ä»¥æ¶ˆè´¹å¤šä¸ªpartitionsä¸­çš„æ¶ˆæ¯.kafkaåªèƒ½ä¿è¯ä¸€ä¸ªpartitionä¸­çš„æ¶ˆæ¯è¢«æŸä¸ªconsumeræ¶ˆè´¹æ—¶,æ¶ˆæ¯æ˜¯é¡ºåºçš„.äº‹å®ä¸Š,ä»Topicè§’åº¦æ¥è¯´,æ¶ˆæ¯ä»ä¸æ˜¯æœ‰åºçš„. å› ä¸ºæ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯çš„æ—¶å€™æ˜¯æŒ‰ç…§åˆ†åŒºä¾æ¬¡è¯»å–çš„ï¼Œæ‰€ä»¥æ— æ³•ä¿è¯æ¶ˆæ¯çš„å…¨å±€é¡ºåºæ€§ï¼Œåªèƒ½ä¿è¯åœ¨åŒä¸€ä¸ªåˆ†åŒºå†…çš„æ¶ˆæ¯æ˜¯é¡ºåºçš„ã€‚å¦‚æœæƒ³è¦æ‰€æœ‰çš„æ¶ˆæ¯éƒ½æ˜¯é¡ºåºçš„ï¼Œå¯ä»¥æŠŠåˆ†åŒºæ•°è®¾ç½®ä¸º1.kafkaä¸­å¦‚ä½•ä¿è¯æ•°æ®ä¸€æ®µæ—¶é—´å†…ä¸ä¸¢å¤±ï¼Ÿkafka çš„produceræœ‰ACKæœºåˆ¶ã€‚å¯ä»¥ç”±ç”¨æˆ·è‡ªè¡Œè®¾å®šæ˜¯å¦å¼€å¯ç¡®è®¤æœºåˆ¶ï¼Œå¦‚æœå¼€å¯ç¡®è®¤æœºåˆ¶ï¼Œkafkaä¼šç­‰å‘é€æ¶ˆæ¯åˆ°kafkaé›†ç¾¤æ—¶ï¼Œå½“leaderæœåŠ¡å™¨ï¼Œä¼šè¿”å›å…ƒæ•°æ®ç»™producerå®¢æˆ·ç«¯ï¼ŒACKæœºåˆ¶ä¹Ÿåœ¨å…ƒæ•°æ®é‡Œï¼Œè¿™é‡Œçš„ACKæœ‰ä¸¤ç§ï¼Œä¸€ç§å°±æ˜¯leaderåªè¦æ¥æ”¶æˆåŠŸï¼Œå°±è¿”å›ç¡®è®¤ï¼Œå¦å¤–ä¸€ç§å°±æ˜¯ï¼šè¦ç­‰æ‰€æœ‰followeréƒ½æ”¶åˆ°äº†ä¹‹åæ‰è¿”å›ç¡®è®¤ã€‚produceråœ¨æ¥æ”¶åˆ°ç¡®è®¤ä¹‹åï¼Œæ‰ä¼šå‘ä¸‹ä¸€æ¡æ¶ˆæ¯ã€‚è€Œæ‰€æœ‰çš„æ¶ˆæ¯æœ€ç»ˆéƒ½æ˜¯å­˜å‚¨åœ¨ç£ç›˜ä¸€æ®µæ—¶é—´çš„ï¼Œæ‰€ä»¥ä¸€æ®µæ—¶é—´å†…æ¶ˆæ¯æ˜¯ä¸ä¼šä¸¢å¤±çš„ã€‚kafka çš„åº”ç”¨åœºæ™¯ä¸»è¦æœ‰å“ªäº›ï¼Ÿå®˜æ–¹ä»‹ç»æ˜¯è®²å¯ä»¥ç”¨ä½œmessage queueï¼Œæ•°æ®é‡‡é›†ï¼Œç®€å•æµå¼è®¡ç®—ç­‰ã€‚ç”¨ä½œæ¶ˆæ¯é˜Ÿåˆ—message queueæœ‰å“ªäº›ä¼˜ç¼ºç‚¹ï¼Ÿå¯¹äºä¸€äº›å¸¸è§„çš„æ¶ˆæ¯ç³»ç»Ÿ,kafkaæ˜¯ä¸ªä¸é”™çš„é€‰æ‹©;partitons/replicationå’Œå®¹é”™,å¯ä»¥ä½¿kafkaå…·æœ‰è‰¯å¥½çš„æ‰©å±•æ€§å’Œæ€§èƒ½ä¼˜åŠ¿.ä¸è¿‡åˆ°ç›®å‰ä¸ºæ­¢,æˆ‘ä»¬åº”è¯¥å¾ˆæ¸…æ¥šè®¤è¯†åˆ°,kafkaå¹¶æ²¡æœ‰æä¾›JMSä¸­çš„â€äº‹åŠ¡æ€§â€â€æ¶ˆæ¯ä¼ è¾“æ‹…ä¿(æ¶ˆæ¯ç¡®è®¤æœºåˆ¶)â€â€æ¶ˆæ¯åˆ†ç»„â€ç­‰ä¼ä¸šçº§ç‰¹æ€§;kafkaåªèƒ½ä½¿ç”¨ä½œä¸ºâ€å¸¸è§„â€çš„æ¶ˆæ¯ç³»ç»Ÿ,åœ¨ä¸€å®šç¨‹åº¦ä¸Š,å°šæœªç¡®ä¿æ¶ˆæ¯çš„å‘é€ä¸æ¥æ”¶ç»å¯¹å¯é (æ¯”å¦‚,æ¶ˆæ¯é‡å‘,æ¶ˆæ¯å‘é€ä¸¢å¤±ç­‰)kafkaæ˜¯å¦‚ä½•ä¿æŒé«˜æ€§èƒ½çš„ï¼Ÿéœ€è¦è€ƒè™‘çš„å½±å“æ€§èƒ½ç‚¹å¾ˆå¤š,é™¤ç£ç›˜IOä¹‹å¤–,æˆ‘ä»¬è¿˜éœ€è¦è€ƒè™‘ç½‘ç»œIO,è¿™ç›´æ¥å…³ç³»åˆ°kafkaçš„ååé‡é—®é¢˜.kafkaå¹¶æ²¡æœ‰æä¾›å¤ªå¤šé«˜è¶…çš„æŠ€å·§;å¯¹äºproducerç«¯,å¯ä»¥å°†æ¶ˆæ¯bufferèµ·æ¥,å½“æ¶ˆæ¯çš„æ¡æ•°è¾¾åˆ°ä¸€å®šé˜€å€¼æ—¶,æ‰¹é‡å‘é€ç»™broker;å¯¹äºconsumerç«¯ä¹Ÿæ˜¯ä¸€æ ·,æ‰¹é‡fetchå¤šæ¡æ¶ˆæ¯.ä¸è¿‡æ¶ˆæ¯é‡çš„å¤§å°å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶æ¥æŒ‡å®š.å¯¹äºkafka brokerç«¯,ä¼¼ä¹æœ‰ä¸ªsendfileç³»ç»Ÿè°ƒç”¨å¯ä»¥æ½œåœ¨çš„æå‡ç½‘ç»œIOçš„æ€§èƒ½:å°†æ–‡ä»¶çš„æ•°æ®æ˜ å°„åˆ°ç³»ç»Ÿå†…å­˜ä¸­,socketç›´æ¥è¯»å–ç›¸åº”çš„å†…å­˜åŒºåŸŸå³å¯,è€Œæ— éœ€è¿›ç¨‹å†æ¬¡copyå’Œäº¤æ¢. å…¶å®å¯¹äºproducer/consumer/brokerä¸‰è€…è€Œè¨€,CPUçš„å¼€æ”¯åº”è¯¥éƒ½ä¸å¤§,å› æ­¤å¯ç”¨æ¶ˆæ¯å‹ç¼©æœºåˆ¶æ˜¯ä¸€ä¸ªè‰¯å¥½çš„ç­–ç•¥;å‹ç¼©éœ€è¦æ¶ˆè€—å°‘é‡çš„CPUèµ„æº,ä¸è¿‡å¯¹äºkafkaè€Œè¨€,ç½‘ç»œIOæ›´åº”è¯¥éœ€è¦è€ƒè™‘.å¯ä»¥å°†ä»»ä½•åœ¨ç½‘ç»œä¸Šä¼ è¾“çš„æ¶ˆæ¯éƒ½ç»è¿‡å‹ç¼©.kafkaæ”¯æŒgzip/snappyç­‰å¤šç§å‹ç¼©æ–¹å¼.kafkaåœ¨æ¶ˆè´¹è€…ç«¯æœ‰å“ªäº›å¼‚å¸¸å¤„ç†ç­–ç•¥ï¼Ÿå¯¹äºJMSå®ç°,æ¶ˆæ¯ä¼ è¾“æ‹…ä¿éå¸¸ç›´æ¥:æœ‰ä¸”åªæœ‰ä¸€æ¬¡(exactly once).åœ¨kafkaä¸­ç¨æœ‰ä¸åŒ:1) at most once: æœ€å¤šä¸€æ¬¡,è¿™ä¸ªå’ŒJMSä¸­â€éæŒä¹…åŒ–â€æ¶ˆæ¯ç±»ä¼¼.å‘é€ä¸€æ¬¡,æ— è®ºæˆè´¥,å°†ä¸ä¼šé‡å‘.2) at least once: æ¶ˆæ¯è‡³å°‘å‘é€ä¸€æ¬¡,å¦‚æœæ¶ˆæ¯æœªèƒ½æ¥å—æˆåŠŸ,å¯èƒ½ä¼šé‡å‘,ç›´åˆ°æ¥æ”¶æˆåŠŸ.3) exactly once: æ¶ˆæ¯åªä¼šå‘é€ä¸€æ¬¡.at most once: æ¶ˆè´¹è€…fetchæ¶ˆæ¯,ç„¶åä¿å­˜offset,ç„¶åå¤„ç†æ¶ˆæ¯;å½“clientä¿å­˜offsetä¹‹å,ä½†æ˜¯åœ¨æ¶ˆæ¯å¤„ç†è¿‡ç¨‹ä¸­å‡ºç°äº†å¼‚å¸¸,å¯¼è‡´éƒ¨åˆ†æ¶ˆæ¯æœªèƒ½ç»§ç»­å¤„ç†.é‚£ä¹ˆæ­¤åâ€æœªå¤„ç†â€çš„æ¶ˆæ¯å°†ä¸èƒ½è¢«fetchåˆ°,è¿™å°±æ˜¯â€at most onceâ€.at least once: æ¶ˆè´¹è€…fetchæ¶ˆæ¯,ç„¶åå¤„ç†æ¶ˆæ¯,ç„¶åä¿å­˜offset.å¦‚æœæ¶ˆæ¯å¤„ç†æˆåŠŸä¹‹å,ä½†æ˜¯åœ¨ä¿å­˜offseté˜¶æ®µzookeeperå¼‚å¸¸å¯¼è‡´ä¿å­˜æ“ä½œæœªèƒ½æ‰§è¡ŒæˆåŠŸ,è¿™å°±å¯¼è‡´æ¥ä¸‹æ¥å†æ¬¡fetchæ—¶å¯èƒ½è·å¾—ä¸Šæ¬¡å·²ç»å¤„ç†è¿‡çš„æ¶ˆæ¯,è¿™å°±æ˜¯â€at least onceâ€ï¼ŒåŸå› offsetæ²¡æœ‰åŠæ—¶çš„æäº¤ç»™zookeeperï¼Œzookeeperæ¢å¤æ­£å¸¸è¿˜æ˜¯ä¹‹å‰offsetçŠ¶æ€.exactly once: kafkaä¸­å¹¶æ²¡æœ‰ä¸¥æ ¼çš„å»å®ç°åŸºäº2é˜¶æ®µæäº¤,äº‹åŠ¡),æˆ‘ä»¬è®¤ä¸ºè¿™ç§ç­–ç•¥åœ¨kafkaä¸­æ˜¯æ²¡æœ‰å¿…è¦çš„.é€šå¸¸æƒ…å†µä¸‹â€at-least-onceâ€æ˜¯æˆ‘ä»¬æœé€‰.(ç›¸æ¯”at most onceè€Œè¨€,é‡å¤æ¥æ”¶æ•°æ®æ€»æ¯”ä¸¢å¤±æ•°æ®è¦å¥½).kafka å·¥ä½œæµç¨‹æ˜¯æ€æ ·çš„ï¼Ÿä¸»è¦ç»“æ„å›¾ï¼šå¤§ä½“å¯ä»¥ä»ä¸‰ä¸ªæ–¹é¢åˆ†æï¼šç”Ÿäº§è€…äº§ç”Ÿæ¶ˆæ¯ã€æ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯ã€Broker clusterä¿å­˜æ¶ˆæ¯ã€‚ç”Ÿäº§è€…äº§ç”Ÿæ¶ˆæ¯è¿‡ç¨‹åˆ†æå†™å…¥æ–¹å¼ï¼šproducer é‡‡ç”¨pushçš„æ–¹å¼å°†æ¶ˆæ¯å‘é€åˆ°broker clusterï¼Œæ¯æ¡æ¶ˆæ¯éƒ½è¢«è¿½åŠ åˆ°åˆ†åŒºä¸­ï¼Œå±äºé¡ºåºå†™ç£ç›˜ï¼ˆé¡ºåºå†™ç£ç›˜æ•ˆç‡æ¯”éšæœºå†™å†…å­˜æ•ˆç‡è¦é«˜ï¼Œèƒ½æé«˜Kafkaååç‡ï¼‰è€Œä¸”brokeré›†ç¾¤å¹¶ä¸æ˜¯æ¯ä¸€æ¡æ¶ˆæ¯éƒ½åŠæ—¶å†™ç£ç›˜ï¼Œè€Œæ˜¯å…ˆå†™bufferï¼Œè¾¾åˆ°ä¸€å®šå¤§å°æˆ–è€…æ¯éš”ä¸€æ®µæ—¶é—´å†flushåˆ°ç£ç›˜ä¸Šã€‚å¤šä¸ªproducerå¯ä»¥ç»™åŒä¸€ä¸ªtopic å‘å¸ƒæ¶ˆæ¯ï¼Œè€Œä¸”å¯ä»¥æŒ‡å®šåˆ†åŒºå‘å¸ƒã€‚åˆ†åŒºPartitionæ¯ä¸ªTopicå¯ä»¥æœ‰å¤šä¸ªåˆ†åŒºï¼Œè€Œæ¶ˆæ¯æœ€ç»ˆæ˜¯å­˜å‚¨åœ¨ç£ç›˜çš„æ–‡ä»¶é‡Œçš„ï¼ŒPartitionåœ¨ç£ç›˜ä¸Šæ˜¯æ–‡ä»¶å¤¹çš„å½¢å¼å­˜åœ¨çš„ã€‚å¦‚12345678cd /var/applog/kafka/ ## èµšåˆ°kafkaæ•°æ®ç›®å½• å³log.dir=é…ç½®çš„ç›®å½•lscleaner-offset-checkpoint __consumer_offsets-22 __consumer_offsets-4 log-start-offset-checkpoint recovery-point-offset-checkpoint__consumer_offsets-1 __consumer_offsets-25 __consumer_offsets-40 meta.properties replication-offset-checkpoint__consumer_offsets-10 __consumer_offsets-28 __consumer_offsets-43 mytest-0 test-0__consumer_offsets-13 __consumer_offsets-31 __consumer_offsets-46 mytest-1__consumer_offsets-16 __consumer_offsets-34 __consumer_offsets-49 mytest-2__consumer_offsets-19 __consumer_offsets-37 __consumer_offsets-7 mytest-3å…¶ä¸­mytest-0 mytest-1 mytest-2 mytest-3 å³ä¸ºåˆ†åŒºPartitionï¼Œé‡Œé¢çš„æ–‡ä»¶å°±æ˜¯åˆ†åŒºé‡Œé¢å­˜æ”¾çš„æ•°æ®ã€‚broker cluster ä¿å­˜æ¶ˆæ¯broker æ”¶åˆ°æ¶ˆæ¯åï¼Œé¦–å…ˆä¼šå»æ‰¾topicå¯¹åº”åˆ†åŒºçš„leaderï¼Œæ‰¾åˆ°leaderåï¼Œå…ˆå°†æ•°æ®å†™å…¥bufferï¼Œå†flushåˆ°ç£ç›˜ã€‚ç„¶åzookeeperä¼šåè°ƒfollowerè‡ªåŠ¨åŒæ­¥leaderåˆ†åŒºçš„æ•°æ®ï¼Œä»¥è¾¾åˆ°replicationå¤‡ä»½çš„ç›®çš„ï¼ŒåŒæ—¶leaderä¼šæŒ‰ç…§å¤‡ä»½å®Œæˆçš„å…ˆåé¡ºåºç»™followerä½œä¸€æ¬¡æ’åºï¼Œä½œä¸ºleaderå‘ç”Ÿæ„å¤–æ—¶é€‰ä¸¾æ—¶é€‰ä¸¾ä¸ºleaderçš„é¡ºåºã€‚æ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯æ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯ï¼ŒåŒä¸€ä¸ªåˆ†åŒºé‡Œçš„æ•°æ®ä¸èƒ½å¤Ÿè¢«ä¸€ä¸ªæ¶ˆè´¹ç»„é‡Œé¢çš„å¤šä¸ªæ¶ˆè´¹è€…åŒæ—¶æ¶ˆè´¹ï¼ŒåŒä¸€ä¸ªæ¶ˆè´¹ç»„é‡Œçš„æ¶ˆè´¹è€…åªèƒ½æ¶ˆè´¹ä¸åŒåˆ†åŒºçš„æ•°æ®ã€‚ä¸åŒæ¶ˆè´¹è€…ç»„å¯ä»¥æ¶ˆè´¹åŒä¸€ä¸ªåˆ†åŒºé‡Œçš„æ•°æ®ã€‚æ¶ˆè´¹è€…æ¶ˆè´¹æ•°æ®æ—¶æ˜¯æŒ‰ç…§åˆ†åŒºçš„ä¸€ä¸ªä¸€ä¸ªåˆ†åŒºæ•°æ®è¿›è¡Œæ¶ˆè´¹çš„ã€‚zookeeperåœ¨kafkaä¸­çš„å…·ä½“ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿkafkaæ˜¯ä¾èµ–äºzookeeperæ³¨å†Œä¸­å¿ƒçš„ï¼Œä¸»è¦æ¥åè°ƒå„ä¸ªbrokerçš„åˆ†åŒºå¤‡ä»½ï¼Œbrokerçš„é€‰ä¸¾ï¼Œä»¥åŠæ¶ˆè´¹è€…ç›¸å…³çŠ¶ä¿¡æ¯çš„å­˜å‚¨ã€‚kafkaä½¿ç”¨zookeeperæ¥å­˜å‚¨ä¸€äº›metaä¿¡æ¯,å¹¶ä½¿ç”¨äº†zookeeper watchæœºåˆ¶æ¥å‘ç°metaä¿¡æ¯çš„å˜æ›´å¹¶ä½œå‡ºç›¸åº”çš„åŠ¨ä½œ(æ¯”å¦‚consumerå¤±æ•ˆ,è§¦å‘è´Ÿè½½å‡è¡¡ç­‰)1) Broker node registry: å½“ä¸€ä¸ªkafkabrokerå¯åŠ¨å,é¦–å…ˆä¼šå‘zookeeperæ³¨å†Œè‡ªå·±çš„èŠ‚ç‚¹ä¿¡æ¯(ä¸´æ—¶znode),åŒæ—¶å½“brokerå’Œzookeeperæ–­å¼€è¿æ¥æ—¶,æ­¤znodeä¹Ÿä¼šè¢«åˆ é™¤.æ ¼å¼: /broker/ids/[0â€¦N] â€“&gt;host:port;å…¶ä¸­[0..N]è¡¨ç¤ºbroker id,æ¯ä¸ªbrokerçš„é…ç½®æ–‡ä»¶ä¸­éƒ½éœ€è¦æŒ‡å®šä¸€ä¸ªæ•°å­—ç±»å‹çš„id(å…¨å±€ä¸å¯é‡å¤),znodeçš„å€¼ä¸ºæ­¤brokerçš„host:portä¿¡æ¯.123456789101112131415161718$ zkCli -server k8s-n1:2181$ ls /brokers[ids, topics, seqid]$ ls /brokers/ids[0, 1, 2]$ get /brokers/ids/0&#123;&quot;listener_security_protocol_map&quot;:&#123;&quot;PLAINTEXT&quot;:&quot;PLAINTEXT&quot;&#125;,&quot;endpoints&quot;:[&quot;PLAINTEXT://k8s-n1:9092&quot;],&quot;jmx_port&quot;:-1,&quot;host&quot;:&quot;k8s-n1&quot;,&quot;timestamp&quot;:&quot;1556568752340&quot;,&quot;port&quot;:9092,&quot;version&quot;:4&#125;cZxid = 0xd0000003cctime = Wed Apr 24 16:10:19 CST 2019mZxid = 0xd0000003cmtime = Wed Apr 24 16:10:19 CST 2019pZxid = 0xd0000003ccversion = 0dataVersion = 1aclVersion = 0ephemeralOwner = 0x26a4e173fc40002dataLength = 182numChildren = 02) Broker Topic Registry: å½“ä¸€ä¸ªbrokerå¯åŠ¨æ—¶,ä¼šå‘zookeeperæ³¨å†Œè‡ªå·±æŒæœ‰çš„topicå’Œpartitionsä¿¡æ¯,ä»ç„¶æ˜¯ä¸€ä¸ªä¸´æ—¶znode.æ ¼å¼: /broker/topics/[topic]/[0â€¦N] å…¶ä¸­[0..N]è¡¨ç¤ºpartitionç´¢å¼•å·.12$ ls /brokers/topics[test, __consumer_offsets]__consumer_offsets æ˜¯æ¶ˆè´¹ç«¯çš„offset12345678910111213141516171819$ ls /brokers/topics/test[partitions] ##testçš„åˆ†åŒºä¿¡æ¯$ ls /brokers/topics/test/partitions[0]$ ls /brokers/topics/test/partitions/0[state]$ get /brokers/topics/test/partitions/0/state &#123;&quot;controller_epoch&quot;:19,&quot;leader&quot;:0,&quot;version&quot;:1,&quot;leader_epoch&quot;:3,&quot;isr&quot;:[0]&#125;cZxid = 0x2000000b6ctime = Wed Apr 24 07:53:42 CST 2019mZxid = 0xd00000044mtime = Wed Apr 24 16:10:19 CST 2019pZxid = 0x2000000b6cversion = 0dataVersion = 3aclVersion = 0ephemeralOwner = 0x0dataLength = 73numChildren = 03) Consumer and Consumer group: æ¯ä¸ªconsumerå®¢æˆ·ç«¯è¢«åˆ›å»ºæ—¶,ä¼šå‘zookeeperæ³¨å†Œè‡ªå·±çš„ä¿¡æ¯;æ­¤ä½œç”¨ä¸»è¦æ˜¯ä¸ºäº†â€è´Ÿè½½å‡è¡¡â€.ä¸€ä¸ªgroupä¸­çš„å¤šä¸ªconsumerå¯ä»¥äº¤é”™çš„æ¶ˆè´¹ä¸€ä¸ªtopicçš„æ‰€æœ‰partitions;ç®€è€Œè¨€ä¹‹,ä¿è¯æ­¤topicçš„æ‰€æœ‰partitionséƒ½èƒ½è¢«æ­¤groupæ‰€æ¶ˆè´¹,ä¸”æ¶ˆè´¹æ—¶ä¸ºäº†æ€§èƒ½è€ƒè™‘,è®©partitionç›¸å¯¹å‡è¡¡çš„åˆ†æ•£åˆ°æ¯ä¸ªconsumerä¸Š.4) Consumer id Registry: æ¯ä¸ªconsumeréƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„ID(host:uuid,å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶æŒ‡å®š,ä¹Ÿå¯ä»¥ç”±ç³»ç»Ÿç”Ÿæˆ),æ­¤idç”¨æ¥æ ‡è®°æ¶ˆè´¹è€…ä¿¡æ¯.æ ¼å¼:/consumers/[group_id]/ids/[consumer_id]ä»ç„¶æ˜¯ä¸€ä¸ªä¸´æ—¶çš„znode,æ­¤èŠ‚ç‚¹çš„å€¼ä¸º{â€œtopic_nameâ€:#streamsâ€¦},å³è¡¨ç¤ºæ­¤consumerç›®å‰æ‰€æ¶ˆè´¹çš„topic + partitionsåˆ—è¡¨.å¯åŠ¨æ¶ˆè´¹è€…ï¼š1$ kafka-console-consumer.sh --bootstrap-server k8s-n2:9092 --topic testå¯åŠ¨ç”Ÿæˆè€…ï¼š1kafka-console-producer.sh --broker-list k8s-n1:9092 --topic testæŸ¥çœ‹zookeeperä¿¡æ¯ï¼š1234$ ls /[cluster, controller_epoch, controller, brokers, zookeeper, admin, isr_change_notification, consumers, log_dir_event_notification, latest_producer_id_block, config]$ ls /consumers[]å‘ç°consummerä¸‹å•¥ä¹Ÿæ²¡æœ‰ï¼Ÿè¿™æ˜¯å› ä¸ºæ–°ç‰ˆæœ¬çš„kafkaï¼Œconsumerä¸­offsetä¸æ˜¯æ”¾åœ¨è¿™ä¸ªä½ç½®çš„ï¼Œè€Œæ˜¯æ”¾åœ¨__consumer_offset è¿™ä¸ªtopicä¸‹çš„ã€‚é‚£ä¹ˆè¯¥å¦‚ä½•éªŒè¯å‘¢ï¼Ÿå¯åŠ¨æ¶ˆè´¹è€…ï¼š1$ kafka-console-consumer.sh --bootstrap-server k8s-n2:9092 --topic testå¯åŠ¨ç”Ÿæˆè€…ï¼š1kafka-console-producer.sh --broker-list k8s-n1:9092 --topic testéªŒè¯æ¶ˆæ¯ç”Ÿäº§æˆåŠŸ12345kafka-run-class.sh kafka.tools.GetOffsetShell --broker-list k8s-n1:9092 --topic mytest --time -1mytest:0:15mytest:1:16mytest:2:16mytest:3:15mytest topic ä¸Š 0å·åˆ†åŒºæœ‰15æ¡æ¶ˆæ¯ã€‚å¾ˆå¥½ç†è§£ã€‚å†åˆ›å»ºä¸€ä¸ªæ¶ˆè´¹è€…ç»„1kafka-console-consumer.sh --bootstrap-server k8s-n1:9092 --topic mytest --from-beginningæŸ¥è¯¢ä¸€ä¸‹æ¶ˆè´¹è€…ç»„ä¿¡æ¯123kafka-consumer-groups.sh --bootstrap-server k8s-n1:9092 --listconsole-consumer-24766console-consumer-52794æŸ¥è¯¢ä¸€ä¸‹topicé‡Œçš„å†…å®¹ï¼š1kafka-console-consumer.sh --topic __consumer_offsets --bootstrap-server k8s-n1:9092 --formatter &quot;kafka.coordinator.group.GroupMetadataManager\\$OffsetsMessageFormatter&quot; --consumer.config config/consumer.properties --from-beginningç»“æœï¼š1234567891011 [console-consumer-52794,__consumer_offsets,12]::OffsetAndMetadata(offset=0, leaderEpoch=Optional.empty, metadata=, commitTimestamp=1556122524504, expireTimestamp=None)[console-consumer-52794,__consumer_offsets,45]::OffsetAndMetadata(offset=0, leaderEpoch=Optional.empty, metadata=, commitTimestamp=1556122524504, expireTimestamp=None)[console-consumer-52794,__consumer_offsets,1]::OffsetAndMetadata(offset=0, leaderEpoch=Optional.empty, metadata=, commitTimestamp=1556122524504, expireTimestamp=None)[console-consumer-52794,__consumer_offsets,5]::OffsetAndMetadata(offset=0, leaderEpoch=Optional.empty, metadata=, commitTimestamp=1556122524504, expireTimestamp=None)[console-consumer-52794,__consumer_offsets,26]::OffsetAndMetadata(offset=0, leaderEpoch=Optional.empty, metadata=, commitTimestamp=1556122524504, expireTimestamp=None)[console-consumer-52794,__consumer_offsets,29]::OffsetAndMetadata(offset=0, leaderEpoch=Optional.empty, metadata=, commitTimestamp=1556122524504, expireTimestamp=None)[console-consumer-52794,__consumer_offsets,34]::OffsetAndMetadata(offset=0, leaderEpoch=Optional.empty, metadata=, commitTimestamp=1556122524504, expireTimestamp=None)[console-consumer-52794,__consumer_offsets,10]::OffsetAndMetadata(offset=0, leaderEpoch=Optional.empty, metadata=, commitTimestamp=1556122524504, expireTimestamp=None)[console-consumer-52794,__consumer_offsets,32]::OffsetAndMetadata(offset=5, leaderEpoch=Optional.empty, metadata=, commitTimestamp=1556122524504, expireTimestamp=None)[console-consumer-52794,__consumer_offsets,40]::OffsetAndMetadata(offset=3, leaderEpoch=Optional.empty, metadata=, commitTimestamp=1556122524504, expireTimestamp=None)^CProcessed a total of 1674 messageså‚è€ƒäº† http://www.cnblogs.com/huxi2b/p/6061110.htmlè¿™ç¯‡blogçš„ä½œæ³•ï¼Œä½†æ˜¯æˆ‘çš„ç‰ˆæœ¬æ˜¯kafka_2.2.0é‡Œé¢å¹¶æ²¡æœ‰æ‰¾offsetçš„å‘½ä»¤ã€‚5) Consumer offset Tracking: ç”¨æ¥è·Ÿè¸ªæ¯ä¸ªconsumerç›®å‰æ‰€æ¶ˆè´¹çš„partitionä¸­æœ€å¤§çš„offset.æ ¼å¼:/consumers/[group_id]/offsets/[topic]/[broker_id-partition_id]â€“&gt;offset_valueæ­¤znodeä¸ºæŒä¹…èŠ‚ç‚¹,å¯ä»¥çœ‹å‡ºoffsetè·Ÿgroup_idæœ‰å…³,ä»¥è¡¨æ˜å½“groupä¸­ä¸€ä¸ªæ¶ˆè´¹è€…å¤±æ•ˆ,å…¶ä»–consumerå¯ä»¥ç»§ç»­æ¶ˆè´¹.6) Partition Owner registry: ç”¨æ¥æ ‡è®°partitionè¢«å“ªä¸ªconsumeræ¶ˆè´¹.ä¸´æ—¶znodeæ ¼å¼:/consumers/[group_id]/owners/[topic]/[broker_id-partition_id]â€“&gt;consumer_node_idå½“consumerå¯åŠ¨æ—¶,æ‰€è§¦å‘çš„æ“ä½œ:A) é¦–å…ˆè¿›è¡Œâ€Consumer id Registryâ€;B) ç„¶ååœ¨â€Consumer id Registryâ€èŠ‚ç‚¹ä¸‹æ³¨å†Œä¸€ä¸ªwatchç”¨æ¥ç›‘å¬å½“å‰groupä¸­å…¶ä»–consumerçš„â€leaveâ€å’Œâ€joinâ€;åªè¦æ­¤znode pathä¸‹èŠ‚ç‚¹åˆ—è¡¨å˜æ›´,éƒ½ä¼šè§¦å‘æ­¤groupä¸‹consumerçš„è´Ÿè½½å‡è¡¡.(æ¯”å¦‚ä¸€ä¸ªconsumerå¤±æ•ˆ,é‚£ä¹ˆå…¶ä»–consumeræ¥ç®¡partitions).C) åœ¨â€Broker id registryâ€èŠ‚ç‚¹ä¸‹,æ³¨å†Œä¸€ä¸ªwatchç”¨æ¥ç›‘å¬brokerçš„å­˜æ´»æƒ…å†µ;å¦‚æœbrokeråˆ—è¡¨å˜æ›´,å°†ä¼šè§¦å‘æ‰€æœ‰çš„groupsä¸‹çš„consumeré‡æ–°balance.","categories":[{"name":"æ¶ˆæ¯é˜Ÿåˆ—","slug":"æ¶ˆæ¯é˜Ÿåˆ—","permalink":"http://www.liuyong520.cn/categories/æ¶ˆæ¯é˜Ÿåˆ—/"}],"tags":[{"name":"kafka","slug":"kafka","permalink":"http://www.liuyong520.cn/tags/kafka/"},{"name":"linux","slug":"linux","permalink":"http://www.liuyong520.cn/tags/linux/"}]},{"title":"Linuxä¸‹zookeeperé›†ç¾¤æ­å»º","slug":"zookeeper-install","date":"2019-04-29T02:56:51.000Z","updated":"2019-04-29T10:04:56.654Z","comments":true,"path":"2019/04/29/zookeeper-install/","link":"","permalink":"http://www.liuyong520.cn/2019/04/29/zookeeper-install/","excerpt":"","text":"éƒ¨ç½²å‰å‡†å¤‡ä¸‹è½½zookeeperçš„å®‰è£…åŒ…http://zookeeper.apache.org/releases.html æˆ‘ä¸‹è½½çš„ç‰ˆæœ¬æ˜¯zookeeper-3.4.10ã€‚å‡†å¤‡ä¸‰å°æœåŠ¡å™¨ipåœ°å€ä¸ºï¼š123172.16.18.198172.16.18.199172.16.18.200æ£€æŸ¥jdkç‰ˆæœ¬ï¼Œå®‰è£…jdkç¯å¢ƒï¼Œjdkéœ€è¦1.7ä»¥ä¸Šã€‚å®‰è£…zookeeperä¸‰å°æœåŠ¡å™¨åˆ†åˆ«ä¸Šä¼ zookeeperå®‰è£…åŒ…ï¼Œä¸Šä¼ åˆ°/opt/ç›®å½•ä¸‹ï¼Œç„¶åtar zxvf zookeeper-3.4.10.tar.gzæ‹·è´zoo_sample.cfg ä¸ºzoo.cfg ä¿®æ”¹/opt/zookeeper-3.4.10/conf/zoo.cfgé…ç½®æ–‡ä»¶ï¼Œæ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š123server.1=172.16.18.198:2888:3888server.2=172.16.18.199:2888:3888server.3=172.16.18.200:2888:3888ä¿®æ”¹zookeeperæ•°æ®æ–‡ä»¶å­˜æ”¾ç›®å½•1dataDir=/data/zookeeperæ­¤æ—¶zoo.cfg é…ç½®æ–‡ä»¶å†…å®¹ä¸ºï¼š12345678910111213141516171819202122232425262728293031# The number of milliseconds of each ticktickTime=2000 ##zookeeperå•ä½æ—¶é—´ä¸º2ms# The number of ticks that the initial # synchronization phase can takeinitLimit=10 ##å¯¹äºä»èŠ‚ç‚¹æœ€åˆè¿æ¥åˆ°ä¸»èŠ‚ç‚¹æ—¶çš„è¶…æ—¶æ—¶é—´ï¼Œå•ä½ä¸ºtickå€¼çš„å€æ•°ã€‚å³20ms# The number of ticks that can pass between # sending a request and getting an acknowledgementsyncLimit=5 ##å¯¹äºä¸»èŠ‚ç‚¹ä¸ä»èŠ‚ç‚¹è¿›è¡ŒåŒæ­¥æ“ä½œæ—¶çš„è¶…æ—¶æ—¶é—´ï¼Œå•ä½ä¸ºtickå€¼çš„å€æ•°ã€‚å³10ms# the directory where the snapshot is stored.# do not use /tmp for storage, /tmp here is just # example sakes.dataDir=/data/zookeeper# the port at which the clients will connectclientPort=2181 ##å®¢æˆ·ç«¯é“¾æ¥ç«¯å£# the maximum number of client connections.# increase this if you need to handle more clientsmaxClientCnxns=60 ##å®¢æˆ·ç«¯æœ€å¤§é“¾æ¥æ•°## Be sure to read the maintenance section of the # administrator guide before turning on autopurge.## http://zookeeper.apache.org/doc/current/zookeeperAdmin.html#sc_maintenance## The number of snapshots to retain in dataDir#autopurge.snapRetainCount=3# Purge task interval in hours# Set to &quot;0&quot; to disable auto purge feature#autopurge.purgeInterval=1server.1=172.16.18.198:2888:3888 server.2=172.16.18.199:2888:3888server.3=172.16.18.200:2888:3888æ–°å»ºmyidæ–‡ä»¶åœ¨ä¸‰å°æœåŠ¡å™¨çš„æ•°æ®å­˜æ”¾ç›®å½•ä¸‹æ–°å»ºmyidæ–‡ä»¶ï¼Œå¹¶å†™å…¥å¯¹åº”çš„server.num ä¸­çš„numæ•°å­—å¦‚ï¼šåœ¨172.16.18.198ä¸Šå°†server.1ä¸­1å†™å…¥myid1echo 1 &gt;/data/zookeeper/myidæ·»åŠ ç¯å¢ƒå˜é‡ï¼Œæ–¹ä¾¿æˆ‘ä»¬æ‰§è¡Œè„šæœ¬å‘½ä»¤vi etc/profile åœ¨æœ€åæ·»åŠ å¦‚ä¸‹ä¸¤ä¸ªã€‚12export ZOOKEEPER_HOME=/opt/zookeeper-3.4.9export PATH=$PATH:$ZOOKEEPER_HOME/bin:$ZOOKEEPER_HOME/confä¿å­˜åé‡æ–°åŠ è½½ä¸€ä¸‹ï¼š1source /etc/profileä¿®æ”¹æ—¥å¿—å­˜æ”¾ç›®å½•ï¼ˆå¯é€‰ï¼‰vi /opt/zookeeper/bin/zkEnv.sh æ‰¾åˆ°ZOO_LOG_DIR å’Œ ZOO_LOG4J_PROPä½ç½®1234567891011if [ &quot;x$&#123;ZOO_LOG_DIR&#125;&quot; = &quot;x&quot; ] then #é…ç½®zookeeperæ—¥å¿—è¾“å‡ºå­˜æ”¾è·¯å¾„ ZOO_LOG_DIR=&quot;/var/applog/zookeeper&quot; fi if [ &quot;x$&#123;ZOO_LOG4J_PROP&#125;&quot; = &quot;x&quot; ] then #é…ç½®æ—¥å¿—è¾“å‡ºçº§åˆ«,è¿™é‡ŒæŠŠå‡ ä¸ªçº§åˆ«ä¸€å¹¶é…ä¸Š ZOO_LOG4J_PROP=&quot;INFO,CONSOLE,ROLLINGFILE,TRACEFILE&quot; fiç¼–è¾‘confç›®å½•ä¸‹log4j.properties123456789# Define some default values that can be overridden by system properties zookeeper.root.logger=INFO, CONSOLE, ROLLINGFILE, TRACEFILE zookeeper.console.threshold=INFO zookeeper.log.dir=. zookeeper.log.file=zookeeper.log zookeeper.log.threshold=ERROR zookeeper.tracelog.dir=. zookeeper.tracelog.file=zookeeper_trace.log log4j.rootLogger=$&#123;zookeeper.root.logger&#125;å®Œæˆlogçš„æ—¥å¿—ç›®å½•çš„ä¿®æ”¹ã€‚7.å¯åŠ¨zookeeperæœåŠ¡zkServer.sh startæ¥å¯åŠ¨ã€‚zkServer.sh restart (é‡å¯)zkServer.sh status (æŸ¥çœ‹çŠ¶æ€)zkServer.sh stop (å…³é—­)zkServer.sh start-foreground (ä»¥æ‰“å°æ—¥å¿—æ–¹å¼å¯åŠ¨)ä¸‰å°æœåŠ¡å™¨åˆ†åˆ«æ‰§è¡Œï¼š1zkServer.sh startç„¶åç”¨ status æ£€æŸ¥ä¸‹çŠ¶æ€ å¦‚æœå‡ºç° Modeï¼šleader æˆ–è€…Mode:follower è¡¨ç¤ºæ­å»ºæˆåŠŸã€‚å¦åˆ™å‰å°æ‰§è¡Œçœ‹ä¸€ä¸‹æ—¥å¿—ã€‚1234$ zkServer.sh statusZooKeeper JMX enabled by defaultUsing config: /opt/zookeeper-3.4.10/bin/../conf/zoo.cfgMode: followerå¦‚å‡ºç°ï¼š123456789102019-04-29 14:04:05,992 [myid:3] - INFO [ListenerThread:QuorumCnxManager$Listener@739] - My election bind port: /172.16.18.200:38882019-04-29 14:04:06,019 [myid:3] - INFO [QuorumPeer[myid=3]/0:0:0:0:0:0:0:0:2181:QuorumPeer@865] - LOOKING2019-04-29 14:04:06,025 [myid:3] - INFO [QuorumPeer[myid=3]/0:0:0:0:0:0:0:0:2181:FastLeaderElection@818] - New election. My id = 3, proposed zxid=0x02019-04-29 14:04:06,056 [myid:3] - WARN [WorkerSender[myid=3]:QuorumCnxManager@588] - Cannot open channel to 1 at election address /172.16.18.198:3888java.net.NoRouteToHostException: æ²¡æœ‰åˆ°ä¸»æœºçš„è·¯ç”± at java.net.PlainSocketImpl.socketConnect(Native Method) at java.net.AbstractPlainSocketImpl.doConnect(AbstractPlainSocketImpl.java:345) at java.net.AbstractPlainSocketImpl.connectToAddress(AbstractPlainSocketImpl.java:206) at java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:188)&quot;zookeeper.log&quot; 303L, 35429CæŠ¥è¿™ç§å¼‚å¸¸ä¸€èˆ¬æœ‰ä¸‰ç§æƒ…å†µï¼š1ï¼‰ï¼šzoo.cfgé…ç½®æ–‡ä»¶ä¸­ï¼Œserver.x:2888:3888é…ç½®å‡ºç°é”™è¯¯ï¼›2ï¼‰ï¼šmyidæ–‡ä»¶å†…å®¹å’Œserver.xä¸å¯¹åº”ï¼Œæˆ–è€…myidä¸åœ¨dataç›®å½•ä¸‹ï¼›3ï¼‰ï¼šç³»ç»Ÿé˜²ç«å¢™æ˜¯å¦åœ¨å¯åŠ¨ã€‚æˆ‘æ£€æŸ¥äº†ä¸‰ç§åŸå› åå‘ç°æ˜¯é˜²ç«å¢™runningã€‚centos7ä¸‹æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€çš„å‘½ä»¤ï¼š1firewall-cmd --stateå…³é—­é˜²ç«å¢™çš„å‘½ä»¤ï¼š12systemctl stop firewalld.servicesystemctl disable firewalld.service ï¼ˆç¦æ­¢å¼€æœºå¯åŠ¨ï¼Œæ°¸ä¹…å…³é—­é˜²ç«å¢™ï¼‰å…³é—­é˜²ç«å¢™åé‡å¯å³å¯ã€‚éªŒè¯æ˜¯å¦æˆåŠŸåœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥ï¼šzkCli.sh -server 172.16.18.198:2181ï¼ˆç”±äºæœ¬äººåœ¨ä¸åŒçš„åŠå…¬åœ°ç‚¹åœ¨ä¿®æ”¹è¯¥æ–‡ç« ï¼Œæ‰€ä»¥ipåœ°å€ä¹Ÿåœ¨å˜åŒ–ï¼ŒçŸ¥é“åŸç†å³å¯ï¼‰å³å¯è¿æ¥åˆ°å…¶ä¸­ä¸€å°ZooKeeperæœåŠ¡å™¨ã€‚å…¶ä»–è‡ªåŠ¨å®ç°åŒæ­¥ï¼Œå®¢æˆ·ç«¯åªéœ€è¦å’Œä¸€å°ä¿æŒè¿æ¥å³å¯ã€‚å‡ºç°å¦‚ä¸‹è¡¨ç¤ºé“¾æ¥æˆåŠŸ1234WATCHER::WatchedEvent state:SyncConnected type:None path:null[zk: 172.16.18.198:2181(CONNECTED) 0]","categories":[{"name":"åˆ†å¸ƒå¼é›†ç¾¤","slug":"åˆ†å¸ƒå¼é›†ç¾¤","permalink":"http://www.liuyong520.cn/categories/åˆ†å¸ƒå¼é›†ç¾¤/"}],"tags":[{"name":"linux","slug":"linux","permalink":"http://www.liuyong520.cn/tags/linux/"},{"name":"ZooKeeper","slug":"ZooKeeper","permalink":"http://www.liuyong520.cn/tags/ZooKeeper/"}]},{"title":"hexoåšå®¢ä¸»é¢˜ä¼˜åŒ–","slug":"hexo-promise","date":"2017-08-29T02:56:51.000Z","updated":"2019-04-28T08:58:06.799Z","comments":true,"path":"2017/08/29/hexo-promise/","link":"","permalink":"http://www.liuyong520.cn/2017/08/29/hexo-promise/","excerpt":"","text":"åœ¨ä»‹ç»åšå®¢ä¸»é¢˜ä¼˜åŒ–è¿™ä¸ªè¯é¢˜ä¹‹å‰ï¼Œæˆ‘æƒ³å…ˆä»‹ç»hexoä¸»é¢˜çš„å¤§ä½“ç»“æ„ï¼Œä¾¿äºåé¢å°†ä¸»é¢˜ä¼˜åŒ–æ–¹é¢çš„ä¸œè¥¿ã€‚hexoä¸»é¢˜ç»“æ„æˆ‘è¿™é‡Œé€‰ç”¨pureä¸»é¢˜ä¸ºä¾‹è¿›è¡Œè®²è§£ã€‚è¿›å…¥themes/pureæ–‡ä»¶å¤¹ä¸‹æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158$ tree.â”œâ”€â”€ LICENSEâ”œâ”€â”€ README.cn.mdâ”œâ”€â”€ README.mdâ”œâ”€â”€ _config.yml #ä¸»é¢˜ä¸»é…ç½®æ–‡ä»¶â”œâ”€â”€ _config.yml.example #ä¸»é¢˜é…ç½®æ–‡ä»¶ä¾‹å­â”œâ”€â”€ _source #åšå®¢é¡µé¢ä¾‹å­æ–‡ä»¶å¤¹â”‚ â”œâ”€â”€ 404 #åšå®¢404é¡µé¢åªè¦æ‹·è´åˆ°ç«™ç‚¹soureå°±è¡Œâ”‚ â”‚ â””â”€â”€ index.mdâ”‚ â”œâ”€â”€ _data #åšå®¢å‹æƒ…é“¾æ¥é¡µé¢â”‚ â”‚ â”œâ”€â”€ gallery.ymlâ”‚ â”‚ â””â”€â”€ links.ymlâ”‚ â”œâ”€â”€ about #åšå®¢å…³äºé¡µé¢â”‚ â”‚ â””â”€â”€ index.mdâ”‚ â”œâ”€â”€ books #åšå®¢ä¹¦å•é¡µé¢â”‚ â”‚ â””â”€â”€ index.mdâ”‚ â”œâ”€â”€ categories #åšå®¢åˆ†ç±»é¡µé¢â”‚ â”‚ â””â”€â”€ index.mdâ”‚ â”œâ”€â”€ links #åšå®¢å‹æƒ…é“¾æ¥â”‚ â”‚ â””â”€â”€ index.mdâ”‚ â”œâ”€â”€ repository #åšå®¢ä»“åº“æ¨¡ç‰ˆé¡µé¢â”‚ â”‚ â””â”€â”€ index.mdâ”‚ â””â”€â”€ tags #åšå®¢æ ‡ç­¾é¡µé¢â”‚ â””â”€â”€ index.mdâ”œâ”€â”€ languages #åšå®¢è¯­è¨€åˆ‡æ¢é…ç½®æ–‡ä»¶å¤¹â”‚ â”œâ”€â”€ default.ymlâ”‚ â”œâ”€â”€ en.ymlâ”‚ â”œâ”€â”€ zh-CN.ymlâ”‚ â””â”€â”€ zh-TW.ymlâ”œâ”€â”€ layout #åšå®¢å¸ƒå±€æ–‡ä»¶å¤¹ è¿™é‡Œå°±æ˜¯ç”Ÿæˆé¡µé¢çš„ç²¾åéƒ¨åˆ†äº†â”‚ â”œâ”€â”€ _commonâ”‚ â”‚ â”œâ”€â”€ footer.ejsâ”‚ â”‚ â”œâ”€â”€ head.ejsâ”‚ â”‚ â”œâ”€â”€ header.ejsâ”‚ â”‚ â”œâ”€â”€ script.ejsâ”‚ â”‚ â””â”€â”€ social.ejsâ”‚ â”œâ”€â”€ _partialâ”‚ â”‚ â”œâ”€â”€ archive-book.ejsâ”‚ â”‚ â”œâ”€â”€ archive-category.ejsâ”‚ â”‚ â”œâ”€â”€ archive-link.ejsâ”‚ â”‚ â”œâ”€â”€ archive-list.ejsâ”‚ â”‚ â”œâ”€â”€ archive-post.ejsâ”‚ â”‚ â”œâ”€â”€ archive-repository.ejsâ”‚ â”‚ â”œâ”€â”€ archive-tag.ejsâ”‚ â”‚ â”œâ”€â”€ archive.ejsâ”‚ â”‚ â”œâ”€â”€ article-about.ejsâ”‚ â”‚ â”œâ”€â”€ article.ejsâ”‚ â”‚ â”œâ”€â”€ item-post.ejsâ”‚ â”‚ â”œâ”€â”€ pagination.ejsâ”‚ â”‚ â”œâ”€â”€ postâ”‚ â”‚ â”‚ â”œâ”€â”€ category.ejsâ”‚ â”‚ â”‚ â”œâ”€â”€ comment.ejsâ”‚ â”‚ â”‚ â”œâ”€â”€ copyright.ejsâ”‚ â”‚ â”‚ â”œâ”€â”€ date.ejsâ”‚ â”‚ â”‚ â”œâ”€â”€ donate.ejsâ”‚ â”‚ â”‚ â”œâ”€â”€ gallery.ejsâ”‚ â”‚ â”‚ â”œâ”€â”€ nav.ejsâ”‚ â”‚ â”‚ â”œâ”€â”€ pv.ejsâ”‚ â”‚ â”‚ â”œâ”€â”€ tag.ejsâ”‚ â”‚ â”‚ â”œâ”€â”€ thumbnail.ejsâ”‚ â”‚ â”‚ â”œâ”€â”€ title.ejsâ”‚ â”‚ â”‚ â””â”€â”€ wordcount.ejsâ”‚ â”‚ â”œâ”€â”€ sidebar-about.ejsâ”‚ â”‚ â”œâ”€â”€ sidebar-toc.ejsâ”‚ â”‚ â””â”€â”€ sidebar.ejsâ”‚ â”œâ”€â”€ _scriptâ”‚ â”‚ â”œâ”€â”€ _analyticsâ”‚ â”‚ â”‚ â”œâ”€â”€ baidu-analytics.ejsâ”‚ â”‚ â”‚ â”œâ”€â”€ google-analytics.ejsâ”‚ â”‚ â”‚ â””â”€â”€ tencent-analytics.ejsâ”‚ â”‚ â”œâ”€â”€ _commentâ”‚ â”‚ â”‚ â”œâ”€â”€ disqus.ejsâ”‚ â”‚ â”‚ â”œâ”€â”€ gitalk.ejsâ”‚ â”‚ â”‚ â”œâ”€â”€ gitment.ejsâ”‚ â”‚ â”‚ â”œâ”€â”€ livere.ejsâ”‚ â”‚ â”‚ â”œâ”€â”€ valine.ejsâ”‚ â”‚ â”‚ â””â”€â”€ youyan.ejsâ”‚ â”‚ â”œâ”€â”€ _searchâ”‚ â”‚ â”‚ â”œâ”€â”€ baidu.ejsâ”‚ â”‚ â”‚ â””â”€â”€ insight.ejsâ”‚ â”‚ â”œâ”€â”€ analytics.ejsâ”‚ â”‚ â”œâ”€â”€ comment.ejsâ”‚ â”‚ â”œâ”€â”€ douban.ejsâ”‚ â”‚ â”œâ”€â”€ fancybox.ejsâ”‚ â”‚ â”œâ”€â”€ mathjax.ejsâ”‚ â”‚ â”œâ”€â”€ pv.ejsâ”‚ â”‚ â”œâ”€â”€ repository.ejsâ”‚ â”‚ â””â”€â”€ search.ejsâ”‚ â”œâ”€â”€ _searchâ”‚ â”‚ â”œâ”€â”€ baidu.ejsâ”‚ â”‚ â”œâ”€â”€ index-mobile.ejsâ”‚ â”‚ â”œâ”€â”€ index.ejsâ”‚ â”‚ â”œâ”€â”€ insight.ejsâ”‚ â”‚ â””â”€â”€ swiftype.ejsâ”‚ â”œâ”€â”€ _widgetâ”‚ â”‚ â”œâ”€â”€ archive.ejsâ”‚ â”‚ â”œâ”€â”€ board.ejsâ”‚ â”‚ â”œâ”€â”€ category.ejsâ”‚ â”‚ â”œâ”€â”€ recent_posts.ejsâ”‚ â”‚ â”œâ”€â”€ tag.ejsâ”‚ â”‚ â””â”€â”€ tagcloud.ejsâ”‚ â”œâ”€â”€ about.ejsâ”‚ â”œâ”€â”€ archive.ejsâ”‚ â”œâ”€â”€ books.ejsâ”‚ â”œâ”€â”€ categories.ejsâ”‚ â”œâ”€â”€ category.ejsâ”‚ â”œâ”€â”€ index.ejsâ”‚ â”œâ”€â”€ layout.ejsâ”‚ â”œâ”€â”€ links.ejsâ”‚ â”œâ”€â”€ page.ejsâ”‚ â”œâ”€â”€ post.ejsâ”‚ â”œâ”€â”€ repository.ejsâ”‚ â”œâ”€â”€ tag.ejsâ”‚ â””â”€â”€ tags.ejsâ”œâ”€â”€ package.jsonâ”œâ”€â”€ screenshot #ä¸»é¢˜é¢œè‰²åˆ‡æ¢èƒŒæ™¯â”‚ â”œâ”€â”€ pure-theme-black.pngâ”‚ â”œâ”€â”€ pure-theme-blue.pngâ”‚ â”œâ”€â”€ pure-theme-green.pngâ”‚ â”œâ”€â”€ pure-theme-purple.pngâ”‚ â”œâ”€â”€ pure.pngâ”‚ â””â”€â”€ pure.psdâ”œâ”€â”€ scriptsâ”‚ â””â”€â”€ thumbnail.jsâ””â”€â”€ source #ä¸»é¢˜é™æ€èµ„æºæ–‡ä»¶ç›®å½• â”œâ”€â”€ css â”‚ â”œâ”€â”€ style.css â”‚ â””â”€â”€ style.min.css â”œâ”€â”€ favicon.png â”œâ”€â”€ fonts â”‚ â”œâ”€â”€ README.md â”‚ â”œâ”€â”€ iconfont.eot â”‚ â”œâ”€â”€ iconfont.svg â”‚ â”œâ”€â”€ iconfont.ttf â”‚ â””â”€â”€ iconfont.woff â”œâ”€â”€ images â”‚ â”œâ”€â”€ avatar.jpg â”‚ â”œâ”€â”€ avatar.jpg1 â”‚ â”œâ”€â”€ donate â”‚ â”‚ â”œâ”€â”€ alipayimg.png â”‚ â”‚ â””â”€â”€ wechatpayimg.png â”‚ â”œâ”€â”€ favatar â”‚ â”‚ â”œâ”€â”€ SzsFox-logo.png â”‚ â”‚ â”œâ”€â”€ chuangzaoshi-logo.png â”‚ â”‚ â””â”€â”€ idesign-logo.png â”‚ â”œâ”€â”€ thumb-default.png â”‚ â””â”€â”€ xingqiu-qrcode.jpg â””â”€â”€ js â”œâ”€â”€ application.js â”œâ”€â”€ application.min.js â”œâ”€â”€ insight.js â”œâ”€â”€ jquery.min.js â”œâ”€â”€ plugin.js â”œâ”€â”€ plugin.js.map â””â”€â”€ plugin.min.js29 directories, 125 fileslayouté‡Œé¢çš„æ–‡ä»¶ä½¿ç”¨ejs ï¼ˆjsæ¨¡ç‰ˆè¯­è¨€ï¼‰ejså®˜ç½‘å®ç°çš„ï¼Œé‡Œé¢æŠŠæ•´ä¸ªé¡µé¢é€šè¿‡jsæŠ½å–å„ä¸ªå°çš„æ¨¡å—æ¨¡ç‰ˆæ–‡ä»¶ï¼ŒåŒæ—¶æ•°æ®å’Œæ ‡ç­¾é¡µé¢æ˜¯åˆ†ç¦»çš„ï¼Œæ‰€ä»¥åœ¨é¡µé¢é‡Œé¢å¯ä»¥åŠ è½½config.yml é‡Œé¢çš„é…ç½®ã€‚æ•´ä¸ªé¡µé¢å…¥å£æ–‡ä»¶å°±æ˜¯layout.js12345678910111213141516171819202122232425262728&lt;!DOCTYPE html&gt;&lt;html&lt;%= config.language ? &quot; lang=&quot; + config.language.substring(0, 2) : &quot;&quot;%&gt;&gt;&lt;%- partial(&apos;_common/head&apos;, &#123;post: page&#125;) %&gt;##è¿™é‡Œä¼šåˆ¤æ–­æ˜¯å¦å¯ç”¨layouté…ç½®&lt;% var bodyClass = &apos;main-center&apos;; if (theme.config.layout) &#123; bodyClass = theme.config.layout; &#125; if (theme.config.skin) &#123; bodyClass += &apos; &apos; + theme.config.skin; &#125; bodyClass = page.sidebar === &apos;none&apos; ? (bodyClass + &apos; no-sidebar&apos;) : bodyClass;%&gt;&lt;body class=&quot;&lt;%= bodyClass %&gt;&quot; itemscope itemtype=&quot;http://schema.org/WebPage&quot;&gt; &lt;%- partial(&apos;_common/header&apos;, null, &#123;cache: !config.relative_link&#125;) %&gt; &lt;% if (theme.sidebar &amp;&amp; (page.sidebar!=&apos;none&apos; || page.sidebar!=&apos;custom&apos;))&#123; %&gt; &lt;% if (theme.config.toc &amp;&amp; page.toc)&#123; %&gt; &lt;%- partial(&apos;_partial/sidebar-toc&apos;, &#123;post: page&#125;) %&gt; &lt;% &#125;else&#123; %&gt; &lt;%- partial(&apos;_partial/sidebar&apos;, null, &#123;cache: !config.relative_link&#125;) %&gt; &lt;% &#125; %&gt; &lt;% &#125; %&gt; &lt;%- body %&gt; &lt;%- partial(&apos;_common/footer&apos;, null, &#123;cache: !config.relative_link&#125;) %&gt; &lt;%- partial(&apos;_common/script&apos;, &#123;post: page&#125;) %&gt;&lt;/body&gt;&lt;/html&gt;å…¶ä¸­&lt;%- partial(â€˜_common/footerâ€™, null, {cache: !config.relative_link}) %&gt; è¡¨ç¤ºå¼•å…¥å­æ¨¡å—_common/footer.ejsæ–‡ä»¶ï¼Œ{cache: !config.relative_link}è¡¨ç¤ºå‚æ•°æˆ‘ä»¬çš„åˆ›å»ºçš„åšå®¢æ–‡ç« éƒ½ä¼šåŠ è½½è¿™ä¸ªå¸ƒå±€æ–‡ä»¶ã€‚æˆ‘ä»¬æ–°åˆ›å»ºçš„åšå®¢æ–‡ç« æœ‰å¦‚ä¸‹çš„é…ç½®ï¼š123456789title: æ–‡ç« æ ‡é¢˜categories: - æ–‡ç« åˆ†ç±»tags: - æ–‡ç« æ ‡ç­¾toc: true # æ˜¯å¦å¯ç”¨å†…å®¹ç´¢å¼•comment:true #æ˜¯å¦å¯ç”¨è¯„è®ºlayout:æ¨¡ç‰ˆæ–‡ä»¶ï¼Œå¦‚æœæ²¡æœ‰é»˜è®¤ä¸åŠ è½½ä»»ä½•æ¨¡ç‰ˆsidebar: none # æ˜¯å¦å¯ç”¨sidebarä¾§è¾¹æ ï¼Œnoneï¼šä¸å¯ç”¨ï¼Œä¸é…ç½®é»˜è®¤å¯åŠ¨ä»¥ä¸Šé…ç½®å±äºpage åŸŸçš„é…ç½®æ–‡ä»¶å±äºå•ä¸ªé¡µé¢çš„ï¼Œè€Œconfig.language è¿™ç§æ˜¯å…¨å±€é…ç½®æ–‡ä»¶ï¼ˆä¹Ÿå°±æ˜¯ç«™ç‚¹é…ç½®æ–‡ä»¶config.ymlï¼‰ï¼Œæ¯ä¸ªé¡µé¢éƒ½èƒ½ä½¿ç”¨ã€‚theme.config åŠ è½½çš„å°±æ˜¯ä¸»é¢˜çš„é…ç½®æ–‡ä»¶config.yml æ–‡ä»¶ã€‚ä¸»é¢˜é…ç½®æ–‡ä»¶config.yml123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236 # menumenu: Home: . Archives: archives # å½’æ¡£ Categories: categories # åˆ†ç±» Tags: tags # æ ‡ç­¾ Repository: repository # github repositories Books: books # è±†ç“£ä¹¦å• Links: links # å‹é“¾ About: about # å…³äº# Enable/Disable menu iconsmenu_icons: enable: true # æ˜¯å¦å¯ç”¨å¯¼èˆªèœå•å›¾æ ‡ home: icon-home-fill archives: icon-archives-fill categories: icon-folder tags: icon-tags repository: icon-project books: icon-book-fill links: icon-friendship about: icon-cup-fill# rssrss: /atom.xml# Sitesite: logo: enabled: true width: 40 height: 40 url: ../images/logo.png title: Hexo # é¡µé¢title favicon: /favicon.png board: &lt;p&gt;æ¬¢è¿äº¤æµä¸åˆ†äº«ç»éªŒ!&lt;/p&gt; # ç«™ç‚¹å…¬å‘Š copyright: false # åº•éƒ¨ç‰ˆæƒä¿¡æ¯# configconfig: skin: theme-black # ä¸»é¢˜é¢œè‰² theme-black theme-blue theme-green theme-purple layout: main-center # å¸ƒå±€æ–¹å¼ main-left main-center main-right toc: true # æ˜¯å¦å¼€å¯æ–‡ç« ç« èŠ‚ç›®å½•å¯¼èˆª menu_highlight: false # æ˜¯å¦å¼€å¯å½“å‰èœå•é«˜äº®æ˜¾ç¤º thumbnail: false # enable posts thumbnail, options: true, false excerpt_link: Read More# Pagination åˆ†é¡µpagination: number: false #æ˜¯å¦å¼€å¯æ•°å­— prev: alwayShow: true next: alwayShow: true# Sidebarsidebar: rightwidgets: - board - category - tag - tagcloud - archive - recent_posts# display widgets at the bottom of index pages (pagination == 2)index_widgets:# - category# - tagcloud# - archive # widget behaviorarchive_type: &apos;monthly&apos;show_count: true# Fancyboxfancybox: false# Searchsearch: insight: true # you need to install `hexo-generator-json-content` before using Insight Search baidu: false # you need to disable other search engines to use Baidu search, options: true, false# Donatedonate: enable: true # å¾®ä¿¡æ‰“èµ wechatpay: qrcode: images/donate/wechatpayimg.png title: å¾®ä¿¡æ”¯ä»˜ # æ”¯ä»˜å®æ‰“èµ alipay: qrcode: images/donate/alipayimg.png title: æ”¯ä»˜å®# Share# weibo,qq,qzone,wechat,tencent,douban,diandian,facebook,twitter,google,linkedinshare: enable: true # æ˜¯å¦å¯ç”¨åˆ†äº« sites: weibo,qq,wechat,facebook,twitter # PCç«¯æ˜¾ç¤ºçš„åˆ†äº«å›¾æ ‡ mobile_sites: weibo,qq,qzone # ç§»åŠ¨ç«¯æ˜¾ç¤ºçš„åˆ†äº«å›¾æ ‡# Githubgithub: username: ***# Comment# Gitment# Introduction: https://imsun.net/posts/gitment-introduction/comment: type: youyan disqus: # enter disqus shortname here youyan: uid: 1783844 # enter youyan uid livere: uid: # enter youyan uid gitment: githubID: repo: ClientID: ClientSecret: lazy: false gitalk: # gitalk. https://gitalk.github.io/ owner: #å¿…é¡». GitHub repository æ‰€æœ‰è€…ï¼Œå¯ä»¥æ˜¯ä¸ªäººæˆ–è€…ç»„ç»‡ã€‚ admin: #å¿…é¡». GitHub repository çš„æ‰€æœ‰è€…å’Œåˆä½œè€… (å¯¹è¿™ä¸ª repository æœ‰å†™æƒé™çš„ç”¨æˆ·)ã€‚ repo: #å¿…é¡». GitHub repository. ClientID: #å¿…é¡». GitHub Application Client ID. ClientSecret: #å¿…é¡». GitHub Application Client Secret. valine: # Valine. https://valine.js.org appid: # your leancloud application appid appkey: # your leancloud application appkey notify: false # mail notifier , https://github.com/xCss/Valine/wiki verify: false # Verification code placeholder: Just go go # comment box placeholder avatar: mm # gravatar style meta: nick,mail,link # custom comment header pageSize: 10 # pagination size visitor: false # Article reading statistic https://valine.js.org/visitor.html# douban è±†ç“£ä¹¦å•# Apiï¼š # https://developers.douban.com/wiki/?title=book_v2 å›¾ä¹¦ # https://developers.douban.com/wiki/?title=movie_v2 ç”µå½±# booksï¼š # https://api.douban.com/v2/book/user/:name/collections?start=0&amp;count=100 ä¸ªäººä¹¦å•åˆ—è¡¨# movies: # https://api.douban.com/v2/movie/in_theaters æ­£åœ¨ä¸Šæ˜ çš„ç”µå½± # https://api.douban.com/v2/movie/coming_soon å³å°†ä¸Šæ˜ çš„ç”µå½± # https://api.douban.com/v2/movie/subject/:id å•ä¸ªç”µå½±ä¿¡æ¯ # https://api.douban.com/v2/movie/search?q=&#123;text&#125; ç”µå½±æœç´¢douban: user: # è±†ç“£ç”¨æˆ·å start: 0 # ä»å“ªä¸€æ¡è®°å½•å¼€å§‹ count: 100 # è·å–è±†ç“£ä¹¦å•æ•°æ®æ¡æ•° # PVpv: busuanzi: enable: false # ä¸è’œå­ç»Ÿè®¡ leancloud: enable: false # leancloudç»Ÿè®¡ app_id: # leancloud &lt;AppID&gt; app_key: # leancloud &lt;AppKey&gt; # wordcountpostCount: enable: false wordcount: true # æ–‡ç« å­—æ•°ç»Ÿè®¡ min2read: true # é˜…è¯»æ—¶é•¿é¢„è®¡ # Pluginsplugins: google_analytics: # enter the tracking ID for your Google Analytics google_site_verification: # enter Google site verification code baidu_analytics: # enter Baidu Analytics hash key tencent_analytics: # Miscellaneoustwitter:google_plus:fb_admins:fb_app_id: # profileprofile: enabled: true # Whether to show profile bar avatar: images/avatar.jpg gravatar: # Gravatar email address, if you enable Gravatar, your avatar config will be overriden author: æ˜µç§° author_title: Web Developer &amp; Designer author_description: ä¸ªäººç®€ä»‹ã€‚ location: Shenzhen, China follow: https://github.com/cofess # Social Links social: links: github: https://github.com/cofess weibo: http://weibo.com/cofess twitter: https://twitter.com/iwebued # facebook: / # dribbble: / behance: https://www.behance.net/cofess rss: atom.xml link_tooltip: true # enable the social link tooltip, options: true, false # My Skills skills: Git: â˜…â˜…â˜…â˜†â˜† Gulp: â˜…â˜…â˜…â˜†â˜† Javascript: â˜…â˜…â˜…â˜†â˜† HTML+CSS: â˜…â˜…â˜…â˜†â˜† Bootstrap: â˜…â˜…â˜…â˜†â˜† ThinkPHP: â˜…â˜…â˜…â˜†â˜† å¹³é¢è®¾è®¡: â˜…â˜…â˜…â˜†â˜† # My Personal Links links: Github: https://github.com/cofess Blog: http://blog.cofess.com å¾®åš: http://weibo.com/cofess èŠ±ç“£: http://huaban.com/cofess Behance: https://www.behance.net/cofess # My Personal Labels labels: - å‰ç«¯ - å‰ç«¯å¼€å‘ - å‰ç«¯é‡æ„ - Webå‰ç«¯ - ç½‘é¡µé‡æ„ # My Personal Works works: name: link: http://www.example.com date: 2016 # My Personal Projects projects: cofess/gulp-startpro: https://github.com/cofess/gulp-startpro cofess/hexo-theme-pure: https://github.com/cofess/hexo-theme-pureåŸºæœ¬ä¸Šæ¯ä¸ªé…ç½®åšä»€ä¹ˆç”¨çš„ï¼Œé…ç½®æ–‡ä»¶é‡Œé¢åŸºæœ¬å†™äº†æ³¨è§£ã€‚ä¹Ÿå¾ˆå®¹æ˜“ç†è§£ã€‚å¦‚æœè¿˜ä¸æ˜¯å¾ˆèƒ½ç†è§£é…ç½®é¡¹ã€‚å¯ä»¥æŸ¥çœ‹https://github.com/cofess/hexo-theme-pure/blob/master/README.cn.md æ–‡ä»¶ã€‚è‡³æ­¤ï¼Œhexoæ¨¡ç‰ˆçš„å¤§ä½“ç»“æ„å·²ç»æ¸…æ¥šäº†ã€‚ä¸»é¢˜ä¼˜åŒ–ä¿®æ”¹ä¸»é¢˜åœ¨config.yml æ–‡ä»¶ä¸­ä¿®æ”¹1234 # Extensions## Plugins: https://hexo.io/plugins/## Themes: https://hexo.io/themes/theme: pureä¿®æ”¹è¯­è¨€åœ¨config.yml æ–‡ä»¶ä¸­ä¿®æ”¹12# Sitelanguage: zh-CN #ä¿®æ”¹æˆä¸­æ–‡æ·»åŠ Rssè®¢é˜…å®‰è£…feedæ’ä»¶1npm install hexo-generator-feed --saveåœ¨config.ymlæ·»åŠ 12345 # Extensions## Plugins: https://hexo.io/plugins/#RSSè®¢é˜…plugin:- hexo-generator-feedè®¾ç½®feedæ’ä»¶å‚æ•°12345 #Feed Atomfeed: type: atom path: atom.xml limit: 20ç”Ÿæˆé¢„è§ˆ12hexo ghexo dé¢„è§ˆä¸‹å°±æ˜¯å¦‚ä¸‹æ·»åŠ ç«™ç‚¹åœ°å›¾ç«™ç‚¹åœ°å›¾æ˜¯ä¸€ç§æ–‡ä»¶ï¼Œæ‚¨å¯ä»¥é€šè¿‡è¯¥æ–‡ä»¶åˆ—å‡ºæ‚¨ç½‘ç«™ä¸Šçš„ç½‘é¡µï¼Œä»è€Œå°†æ‚¨ç½‘ç«™å†…å®¹çš„ç»„ç»‡æ¶æ„å‘ŠçŸ¥Googleå’Œå…¶ä»–æœç´¢å¼•æ“ã€‚Googlebotç­‰æœç´¢å¼•æ“ç½‘é¡µæŠ“å–å·¥å…·ä¼šè¯»å–æ­¤æ–‡ä»¶ï¼Œä»¥ä¾¿æ›´åŠ æ™ºèƒ½åœ°æŠ“å–æ‚¨çš„ç½‘ç«™åˆ†åˆ«å®‰è£…ç™¾åº¦å’Œgoogleæ’ä»¶12npm install hexo-generator-sitemap --savenpm install hexo-generator-baidu-sitemap --saveåœ¨åšå®¢ç›®å½•çš„_config.ymlä¸­æ·»åŠ å¦‚ä¸‹ä»£ç 12345# è‡ªåŠ¨ç”Ÿæˆsitemapsitemap:path: sitemap.xmlbaidusitemap:path: baidusitemap.xmlç¼–è¯‘ä½ çš„åšå®¢12hexo ghexo så¦‚æœä½ åœ¨ä½ çš„åšå®¢æ ¹ç›®å½•çš„publicä¸‹é¢å‘ç°ç”Ÿæˆäº†sitemap.xmlä»¥åŠbaidusitemap.xmlå°±è¡¨ç¤ºæˆåŠŸäº†,åœ¨æœ¬åœ°è®¿é—® http://127.0.0.4000/sitemap.xml å’Œ http://127.0.0.4000/baidusitemap.xml å°±èƒ½æ­£ç¡®çš„å±•ç¤ºå‡ºä¸¤ä¸ªsitemap æ–‡ä»¶äº†ã€‚æ³¨å†Œç™¾åº¦ç«™é•¿å¹³å°4.1 è®¿é—®ï¼šhttps://ziyuan.baidu.com/linksubmit/index4.2 æäº¤é“¾æ¥æäº¤é“¾æ¥æ–¹å¼æœ‰ä¸»åŠ¨æ¨é€ã€è‡ªåŠ¨æ¨é€ã€sitemapã€æ‰‹åŠ¨ä¸Šä¼ ç­‰ã€‚4.3ä¸»åŠ¨æ¨é€å®‰è£…å¯¹åº”æäº¤æ’ä»¶1npm install hexo-baidu-url-submit --saveä¿®æ”¹é…ç½®ï¼š123456789101112131415##é…ç½®æ’ä»¶plugin:- hexo-generator-baidu-sitemap- hexo-generator-sitemap- hexo-baidu-url-submitbaidu_url_submit: ## æ¯”å¦‚3ï¼Œä»£è¡¨æäº¤æœ€æ–°çš„ä¸‰ä¸ªé“¾æ¥ count: 3 # åœ¨ç™¾åº¦ç«™é•¿å¹³å°ä¸­æ³¨å†Œçš„åŸŸå host: www.liuyong520.cn ## è¯·æ³¨æ„è¿™æ˜¯æ‚¨çš„ç§˜é’¥ï¼Œ è¯·ä¸è¦å‘å¸ƒåœ¨å…¬ä¼—ä»“åº“é‡Œ! token: upR0BjzCYxTC2CPq ## æ–‡æœ¬æ–‡æ¡£çš„åœ°å€ï¼Œ æ–°é“¾æ¥ä¼šä¿å­˜åœ¨æ­¤æ–‡æœ¬æ–‡æ¡£é‡Œ path: baidu_urls.txtç¼–è¯‘åšå®¢12hexo ghexo då¦‚æœå‡ºç°ä¸‹å›¾å³è¡¨ç¤ºæˆåŠŸäº†4.4 è‡ªåŠ¨æ¨é€å°†å¦‚ä¸‹ä»£ç æ·»åŠ åˆ°head.ejsä¸­å³å¯ç”Ÿæ•ˆ1234567891011121314&lt;script&gt; (function()&#123; var bp = document.createElement(&apos;script&apos;); var curProtocol = window.location.protocol.split(&apos;:&apos;)[0]; if (curProtocol === &apos;https&apos;) &#123; bp.src = &apos;https://zz.bdstatic.com/linksubmit/push.js&apos;; &#125; else &#123; bp.src = &apos;http://push.zhanzhang.baidu.com/push.js&apos;; &#125; var s = document.getElementsByTagName(&quot;script&quot;)[0]; s.parentNode.insertBefore(bp, s); &#125;)(); &lt;/script&gt;4.5 sitemap æäº¤æ–¹å¼æ‰“å¼€ç™¾åº¦ç«™é•¿å¹³å°ï¼Œç‚¹å‡»sitemapï¼Œå¡«å…¥æˆ‘ä»¬çš„sitemapæ–‡ä»¶è·¯å¾„ï¼š&lt;åŸŸå&gt;/&lt;sitemapåå­—&gt;å¦‚ä¸‹æäº¤å³å¯.ä½†æ˜¯æ­¤æ—¶ä½ çš„åŸŸåå…¶å®å¹¶æ²¡æœ‰è¢«ç™¾åº¦ç«™é•¿æ‰€æ”¶å½•ï¼šç™¾åº¦ä¾ç„¶æ£€ç´¢ä¸åˆ°ä½ çš„ç½‘ç«™ï¼Œéœ€è¦10å¤šä¸ªå·¥ä½œæ—¥ä¹‹åæ‰èƒ½å®¡æ ¸é€šè¿‡ã€‚ç»‘å®šç«™ç‚¹åˆ°ç†ŠæŒIDï¼Œè¿™æ ·ç†ŠæŒIDç«™ç‚¹ç®¡ç†é‡Œé¢å°±èƒ½çœ‹åˆ°ç›¸å…³ç«™ç‚¹æ•°æ®äº†ç™»å½•ç«™é•¿å¹³å°ï¼Œæ³¨å†Œç†ŠæŒIDï¼Œæäº¤å®¡æ ¸è¿‡åç‚¹å‡»ç«™ç‚¹æ”¶å½•ï¼šé™æ€èµ„æºå‹ç¼©hexo çš„æ–‡ç« æ˜¯é€šè¿‡mdæ ¼å¼çš„æ–‡ä»¶ç»è¿‡swigè½¬æ¢æˆçš„htmlï¼Œç”Ÿæˆçš„htmlä¼šæœ‰å¾ˆå¤šç©ºæ ¼ï¼Œè€Œä¸”è‡ªå·±å†™çš„jsä»¥åŠcssä¸­ä¼šæœ‰å¾ˆå¤šçš„ç©ºæ ¼å’Œæ³¨é‡Šã€‚jså’Œjavaä¸ä¸€æ ·ï¼Œæ³¨é‡Šä¹Ÿä¼šå½±å“ä¸€éƒ¨åˆ†çš„æ€§èƒ½ï¼Œç©ºæ ¼åŒæ ·æ˜¯çš„ã€‚é™æ€èµ„æºå‹ç¼©ä¹Ÿæœ‰å¤šç§æ‰‹æ®µï¼šæœ‰gulpæ’ä»¶å’Œhexoè‡ªå¸¦çš„neatæ’ä»¶ã€‚1.hexo-neat æ’ä»¶ï¼šå®‰è£…hexo-neatæ’ä»¶1npm install hexo-neat --saveä¿®æ”¹ç«™ç‚¹é…ç½®æ–‡ä»¶_config.ymlï¼š12345678910111213141516171819202122 # hexo-neat# åšæ–‡å‹ç¼©neat_enable: true# å‹ç¼©htmlneat_html: enable: true exclude:# å‹ç¼©css neat_css: enable: true exclude: - &apos;**/*.min.css&apos;# å‹ç¼©jsneat_js: enable: true mangle: true output: compress: exclude: - &apos;**/*.min.js&apos; - &apos;**/jquery.fancybox.pack.js&apos; - &apos;**/index.js&apos;ç¼–è¯‘åšå®¢12hexo g hexo dgulpæ’ä»¶æ–¹å¼å®‰è£…gulpåŠç›¸å…³æ’ä»¶123456npm install gulp -gnpm install gulp-minify-css --savenpm install gulp-uglify --savenpm install gulp-htmlmin --savenpm install gulp-htmlclean --savenpm install gulp-imagemin --saveåœ¨ Hexo ç«™ç‚¹ä¸‹æ–°å»º gulpfile.jsæ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š123456789101112131415161718192021222324252627282930313233343536373839404142434445var gulp = require(&apos;gulp&apos;);var minifycss = require(&apos;gulp-minify-css&apos;);var uglify = require(&apos;gulp-uglify&apos;);var htmlmin = require(&apos;gulp-htmlmin&apos;);var htmlclean = require(&apos;gulp-htmlclean&apos;);var imagemin = require(&apos;gulp-imagemin&apos;);// å‹ç¼©cssæ–‡ä»¶gulp.task(&apos;minify-css&apos;, function() &#123; return gulp.src(&apos;./public/**/*.css&apos;) .pipe(minifycss()) .pipe(gulp.dest(&apos;./public&apos;));&#125;);// å‹ç¼©htmlæ–‡ä»¶gulp.task(&apos;minify-html&apos;, function() &#123; return gulp.src(&apos;./public/**/*.html&apos;) .pipe(htmlclean()) .pipe(htmlmin(&#123; removeComments: true, minifyJS: true, minifyCSS: true, minifyURLs: true, &#125;)) .pipe(gulp.dest(&apos;./public&apos;))&#125;);// å‹ç¼©jsæ–‡ä»¶gulp.task(&apos;minify-js&apos;, function() &#123; return gulp.src([&apos;./public/**/.js&apos;,&apos;!./public/js/**/*min.js&apos;]) .pipe(uglify()) .pipe(gulp.dest(&apos;./public&apos;));&#125;);// å‹ç¼© public/demo ç›®å½•å†…å›¾ç‰‡gulp.task(&apos;minify-images&apos;, function() &#123; gulp.src(&apos;./public/demo/**/*.*&apos;) .pipe(imagemin(&#123; optimizationLevel: 5, //ç±»å‹ï¼šNumber é»˜è®¤ï¼š3 å–å€¼èŒƒå›´ï¼š0-7ï¼ˆä¼˜åŒ–ç­‰çº§ï¼‰ progressive: true, //ç±»å‹ï¼šBoolean é»˜è®¤ï¼šfalse æ— æŸå‹ç¼©jpgå›¾ç‰‡ interlaced: false, //ç±»å‹ï¼šBoolean é»˜è®¤ï¼šfalse éš”è¡Œæ‰«ægifè¿›è¡Œæ¸²æŸ“ multipass: false, //ç±»å‹ï¼šBoolean é»˜è®¤ï¼šfalse å¤šæ¬¡ä¼˜åŒ–svgç›´åˆ°å®Œå…¨ä¼˜åŒ– &#125;)) .pipe(gulp.dest(&apos;./public/uploads&apos;));&#125;);// é»˜è®¤ä»»åŠ¡gulp.task(&apos;default&apos;, [ &apos;minify-html&apos;,&apos;minify-css&apos;,&apos;minify-js&apos;,&apos;minify-images&apos;]);åªéœ€è¦æ¯æ¬¡åœ¨æ‰§è¡Œ generate å‘½ä»¤åæ‰§è¡Œ gulp å°±å¯ä»¥å®ç°å¯¹é™æ€èµ„æºçš„å‹ç¼©ï¼Œå‹ç¼©å®Œæˆåæ‰§è¡Œ deploy å‘½ä»¤åŒæ­¥åˆ°æœåŠ¡å™¨ï¼š123hexo ggulphexo dä¿®æ”¹è®¿é—®URLè·¯å¾„é»˜è®¤æƒ…å†µä¸‹è®¿é—®URLè·¯å¾„ä¸ºï¼šdomain/2018/10/18/å…³äºæœ¬ç«™,ä¿®æ”¹ä¸º domain/About/å…³äºæœ¬ç«™ã€‚ ç¼–è¾‘ Hexo ç«™ç‚¹ä¸‹çš„ _config.yml æ–‡ä»¶ï¼Œä¿®æ”¹å…¶ä¸­çš„ permalinkå­—æ®µï¼š1permalink: :category/:title/åšæ–‡ç½®é¡¶å®‰è£…æ’ä»¶12npm uninstall hexo-generator-index --savenpm install hexo-generator-index-pin-top --saveç„¶ååœ¨éœ€è¦ç½®é¡¶çš„æ–‡ç« çš„Front-matterä¸­åŠ ä¸Štopå³å¯ï¼š12345--title: 2018date: 2018-10-25 16:10:03top: 10---è®¾ç½®ç½®é¡¶æ ‡å¿—æ‰“å¼€ï¼š/themes/*/layout/_macro/post.swigï¼Œå®šä½åˆ°12345&#123;% if post.top %&#125; &lt;i class=&quot;fa fa-thumb-tack&quot;&gt;&lt;/i&gt; &lt;font color=7D26CD&gt;ç½®é¡¶&lt;/font&gt; &lt;span class=&quot;post-meta-divider&quot;&gt;|&lt;/span&gt;&#123;% endif %&#125;","categories":[{"name":"hexo","slug":"hexo","permalink":"http://www.liuyong520.cn/categories/hexo/"}],"tags":[{"name":"hexo","slug":"hexo","permalink":"http://www.liuyong520.cn/tags/hexo/"}]},{"title":"åˆ©ç”¨hexoæ­å»ºåšå®¢","slug":"creatblog","date":"2017-08-27T02:56:51.000Z","updated":"2019-04-27T16:22:09.846Z","comments":true,"path":"2017/08/27/creatblog/","link":"","permalink":"http://www.liuyong520.cn/2017/08/27/creatblog/","excerpt":"","text":"å¦‚æœä½ å’Œæˆ‘ä¸€æ ·æ˜¯å°ç™½ï¼Œé‚£ä¹ˆæ­å–œä½ ï¼çœ‹å®Œè¿™ç¯‡æ–‡ç« ï¼Œä½ ä¹Ÿå¯ä»¥æ‹¥æœ‰ä¸€ä¸ªè¿™æ ·çš„åšå®¢å‰é¢å·²ç»ä»‹ç»è¿‡å¦‚ä½•æ­å»ºhexoç¯å¢ƒï¼Œç°åœ¨æˆ‘å°†ä»‹ç»å¦‚ä½•ç”¨hexoæ­å»ºè‡ªå·±çš„blogåšå®¢æ­å»ºå®æ–½æ–¹æ¡ˆæ–¹æ¡ˆä¸€ï¼šGithubPagesåˆ›å»ºGithubè´¦å·åˆ›å»ºä»“åº“ ï¼Œä»“åº“åä¸ºï¼š&lt;Githubè´¦å·åç§°&gt;.github.ioç‚¹å‡»settingså¾€ä¸‹ç¿»å°±èƒ½çœ‹åˆ°githubPagesï¼Œæˆ‘è¿™é‡Œæ˜¯å·²ç»é…ç½®è¿‡äº†çš„ï¼Œæ²¡æœ‰é…ç½®å¯ä»¥æ˜¯select themes ï¼Œç‚¹å‡»èƒ½å¤Ÿé€‰æ‹©SkyIIä¸»é¢˜ã€‚ï¼ˆSkyIIä¸»é¢˜ä¹Ÿæ˜¯å’Œhexoç±»ä¼¼çš„blogçš„æ¡†æ¶ï¼Œè¿™é‡Œä¸ä¸ä»‹ç»ï¼‰å°†æœ¬åœ°Hexoåšå®¢æ¨é€åˆ°GithubPages3.1. å®‰è£…hexo-deployer-gitæ’ä»¶ã€‚åœ¨å‘½ä»¤è¡Œï¼ˆå³Git Bashï¼‰è¿è¡Œä»¥ä¸‹å‘½ä»¤å³å¯ï¼š1$ npm install hexo-deployer-git --save3.2. æ·»åŠ SSH keyã€‚åˆ›å»ºä¸€ä¸ª SSH key ã€‚åœ¨å‘½ä»¤è¡Œï¼ˆå³Git Bashï¼‰è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼Œ å›è½¦ä¸‰ä¸‹å³å¯ï¼š1$ ssh-keygen -t rsa -C &quot;é‚®ç®±åœ°å€&quot;æ·»åŠ åˆ° githubã€‚ å¤åˆ¶å¯†é’¥æ–‡ä»¶å†…å®¹ï¼ˆè·¯å¾„å½¢å¦‚C:\\Users\\Administrator.ssh\\id_rsa.pubï¼‰ï¼Œç²˜è´´åˆ°New SSH Keyå³å¯ã€‚æµ‹è¯•æ˜¯å¦æ·»åŠ æˆåŠŸã€‚åœ¨å‘½ä»¤è¡Œï¼ˆå³Git Bashï¼‰ä¾æ¬¡è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼Œè¿”å›â€œYouâ€™ve successfully authenticatedâ€å³æˆåŠŸï¼š1ssh -T git@github.com3.3. ä¿®æ”¹_config.ymlï¼ˆåœ¨ç«™ç‚¹ç›®å½•ä¸‹ï¼‰ã€‚æ–‡ä»¶æœ«å°¾ä¿®æ”¹ä¸ºï¼š123456# Deployment## Docs: https://hexo.io/docs/deployment.htmldeploy: type: git repo: git@github.com:&lt;Githubè´¦å·åç§°&gt;/&lt;Githubè´¦å·åç§°&gt;.github.io.git branch: masteræ³¨æ„ï¼šä¸Šé¢ä»“åº“åœ°å€å†™sshåœ°å€ï¼Œä¸å†™httpåœ°å€ã€‚3.4. æ¨é€åˆ°GithubPagesã€‚åœ¨å‘½ä»¤è¡Œï¼ˆå³Git Bashï¼‰ä¾æ¬¡è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼Œ è¿”å›INFO Deploy done: gitå³æˆåŠŸæ¨é€ï¼š12$ hexo g$ hexo dç­‰å¾…1åˆ†é’Ÿå·¦å³ï¼Œæµè§ˆå™¨è®¿é—®ç½‘å€ï¼š https://&lt;Githubè´¦å·åç§°&gt;.github.ioè‡³æ­¤ï¼Œæ‚¨çš„Hexoåšå®¢å·²ç»æ­å»ºåœ¨GithubPages, åŸŸåä¸ºhttps://&lt;Githubè´¦å·åç§°&gt;.github.ioã€‚æ–¹æ¡ˆäºŒï¼šGithubPages + åŸŸååœ¨æ–¹æ¡ˆä¸€çš„åŸºç¡€ä¸Šï¼Œæ·»åŠ è‡ªå®šä¹‰åŸŸåï¼ˆæ‚¨è´­ä¹°çš„åŸŸåï¼‰ã€‚æˆ‘çš„æ˜¯ä»é˜¿é‡Œäº‘è´­ä¹°çš„ã€‚åŸŸåè§£æç±»å‹é€‰æ‹©ä¸º CNAMEï¼›ä¸»æœºè®°å½•å³åŸŸåå‰ç¼€ï¼Œå¡«å†™ä¸ºwwwï¼›è®°å½•å€¼å¡«å†™ä¸º&lt;Githubè´¦å·åç§°&gt;.github.ioï¼›è§£æçº¿è·¯ï¼ŒTTL é»˜è®¤å³å¯ç‚¹å‡» liuyong520.cnä»“åº“è®¾ç½®ã€‚2.1. æ‰“å¼€åšå®¢ä»“åº“è®¾ç½®ï¼šhttps://github.com/&lt;Githubè´¦å·åç§°&gt;/&lt;Githubè´¦å·åç§°&gt;.github.io/settings2.2. åœ¨Custom domainä¸‹ï¼Œå¡«å†™è‡ªå®šä¹‰åŸŸåï¼Œç‚¹å‡»saveã€‚2.3. åœ¨ç«™ç‚¹ç›®å½•çš„sourceæ–‡ä»¶å¤¹ä¸‹ï¼Œåˆ›å»ºå¹¶æ‰“å¼€CNAME.txtï¼Œå†™å…¥ä½ çš„åŸŸåï¼ˆå¦‚www.liuyong520.cnï¼‰ï¼Œä¿å­˜ï¼Œå¹¶é‡å‘½åä¸ºCNAMEã€‚å¦‚å›¾ç­‰å¾…10åˆ†é’Ÿå·¦å³ã€‚æµè§ˆå™¨è®¿é—®è‡ªå®šä¹‰åŸŸåã€‚http://www.liuyong520.cnè‡³æ­¤ï¼Œæ‚¨çš„Hexoåšå®¢å·²ç»è§£æåˆ°è‡ªå®šä¹‰åŸŸåï¼Œhttps://&lt;Githubè´¦å·åç§°&gt;.github.ioä¾ç„¶å¯ç”¨ã€‚æ–¹æ¡ˆä¸‰ï¼šGithubPages + CodingPages + åŸŸåGithubPages åœ¨å›½å†…è¾ƒæ…¢ï¼Œç™¾åº¦ä¸æ”¶å½•ï¼Œè€ŒCodingPages åœ¨å›½å¤–è¾ƒå¿«ã€‚æ‰€ä»¥åœ¨æ–¹æ¡ˆäºŒçš„åŸºç¡€ä¸Šï¼Œæ·»åŠ CodingPages ã€‚åˆ›å»ºCodingè´¦å·åˆ›å»ºä»“åº“ï¼Œ ä»“åº“åä¸ºï¼š&lt;Codingè´¦å·åç§°&gt;è¿›å…¥é¡¹ç›®é‡Œã€ä»£ç ã€é¡µé¢ï¼Œç‚¹å‡»ã€ä¸€é”®å¼€å¯é™æ€ Pagesã€ï¼Œç¨ç­‰ç‰‡åˆ»CodingPageså³å¯éƒ¨ç½²æˆåŠŸã€‚å°†æœ¬åœ°Hexoåšå®¢æ¨é€åˆ°CodingPages4.1. é‰´äºåˆ›å»ºGithubPages æ—¶ï¼Œå·²ç»ç”Ÿæˆè¿‡å…¬é’¥ã€‚å¯ç›´æ¥å¤åˆ¶å¯†é’¥æ–‡ä»¶å†…å®¹ï¼ˆè·¯å¾„å½¢å¦‚C:\\Users\\Administrator.ssh\\id_rsa.pubï¼‰ï¼Œ ç²˜è´´åˆ°æ–°å¢å…¬é’¥ã€‚4.2. æµ‹è¯•æ˜¯å¦æ·»åŠ æˆåŠŸã€‚åœ¨å‘½ä»¤è¡Œï¼ˆå³Git Bashï¼‰ä¾æ¬¡è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼Œè¿”å›â€œYouâ€™ve successfully authenticatedâ€å³æˆåŠŸï¼š12$ ssh -T git@git.coding.net$ yes4.3. ä¿®æ”¹_config.ymlï¼ˆåœ¨å­˜æ”¾Hexoåˆå§‹åŒ–æ–‡ä»¶çš„è·¯å¾„ä¸‹ï¼‰ã€‚æ–‡ä»¶æœ«å°¾ä¿®æ”¹ä¸ºï¼š123456789# Deployment## Docs: https://hexo.io/docs/deployment.htmldeploy:- type: git repo: git@github.com:&lt;Githubè´¦å·åç§°&gt;/&lt;Githubè´¦å·åç§°&gt;.github.io.git branch: master- type: git repo: git@git.dev.tencent.com:&lt;Codingè´¦å·åç§°&gt;/&lt;Codingè´¦å·åç§°&gt;.git branch: master4.4. æ¨é€åˆ°GithubPagesã€‚åœ¨å‘½ä»¤è¡Œï¼ˆå³Git Bashï¼‰ä¾æ¬¡è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼Œ è¿”å›INFO Deploy done: gitå³æˆåŠŸæ¨é€ï¼š12$ hexo g$ hexo dåŸŸåè§£ææ·»åŠ  CNAME è®°å½•æŒ‡å‘ &lt;Codingè´¦å·åç§°&gt;.coding.meç±»å‹é€‰æ‹©ä¸º CNAMEï¼›ä¸»æœºè®°å½•å³åŸŸåå‰ç¼€ï¼Œå¡«å†™ä¸ºwwwï¼›è®°å½•å€¼å¡«å†™ä¸º&lt;Githubè´¦å·åç§°&gt;.coding.meï¼›è§£æçº¿è·¯ï¼ŒTTL é»˜è®¤å³å¯ã€‚æ·»åŠ  ä¸¤æ¡A è®°å½•æŒ‡å‘ 192.30.252.153å’Œ192.30.252.154ç±»å‹é€‰æ‹©ä¸º Aï¼›ä¸»æœºè®°å½•å³åŸŸåå‰ç¼€ï¼Œå¡«å†™ä¸º@ï¼›è®°å½•å€¼å¡«å†™ä¸º192.30.252.153å’Œ192.30.252.154ï¼›è§£æçº¿è·¯ï¼Œå¢ƒå¤–æˆ–è°·æ­Œã€‚åœ¨ã€Pages æœåŠ¡ã€è®¾ç½®é¡µï¼ˆhttps://dev.tencent.com/u/&lt;Codingè´¦å·åç§°&gt;/p/&lt;Codingè´¦å·åç§°&gt;/git/pages/settingsï¼‰ä¸­ç»‘å®šè‡ªå®šä¹‰åŸŸåè‡³æ­¤ï¼Œæ‚¨çš„Hexoåšå®¢å·²ç»è§£æåˆ°è‡ªå®šä¹‰åŸŸåï¼Œhttps://&lt;Githubè´¦å·åç§°&gt;.github.ioå’Œhttps://&lt;Codingè´¦å·åç§°&gt;.coding.meä¾ç„¶å¯ç”¨ã€‚åˆ‡æ¢ä¸»é¢˜é€‰æ‹©ä¸»é¢˜hexoä¸»é¢˜æ˜¯éå¸¸å¤šçš„ï¼Œé»˜è®¤çš„ä¸»é¢˜æ˜¯landscapeï¼Œæ‚¨å¯ä»¥è‡ªä¸»çš„åœ¨hexoå®˜æ–¹ç½‘ç«™ä¸ŠæŒ‘é€‰è‡ªå·±å–œæ¬¢çš„ä¸»é¢˜ï¼Œç½‘ç«™ï¼šhttps://hexo.io/themes/æ¨èä»¥ä¸‹ä¸»é¢˜ï¼šsnippetHieroJsimpleBlueLakePureNextHuemanæˆ‘è¿™é‡Œé€‰æ‹©çš„æ˜¯Pureã€‚1git clone https://github.com/cofess/hexo-theme-pure.git themes/pureæ­¤æ—¶ä¼šåœ¨themes ç›®å½•ä¸‹ç”Ÿæˆ pureç›®å½•åº”ç”¨ä¸»é¢˜æ›´æ”¹ç«™ç‚¹é…ç½®_config.yml ä¿®æ”¹æˆ1234# Extensions## Plugins: https://hexo.io/plugins/## Themes: https://hexo.io/themes/theme: &lt;ä¸»é¢˜æ–‡ä»¶å¤¹çš„åç§°&gt;ä¸»é¢˜ä¼˜åŒ–ä»¥ä¸Šä¸»é¢˜éƒ½æœ‰æ¯”è¾ƒè¯¦ç»†çš„è¯´æ˜æ–‡æ¡£ï¼Œæœ¬èŠ‚ä¸»è¦è§£å†³ä¸»é¢˜ä¼˜åŒ–çš„å¸¸è§é—®é¢˜ã€‚ä¸»é¢˜ä¼˜åŒ–ä¸€èˆ¬åŒ…æ‹¬ï¼šè®¾ç½®ã€ŒRSSã€æ·»åŠ ã€Œæ ‡ç­¾ã€é¡µé¢æ·»åŠ ã€Œåˆ†ç±»ã€é¡µé¢è®¾ç½®ã€Œå­—ä½“ã€è®¾ç½®ã€Œä»£ç é«˜äº®ä¸»é¢˜ã€ä¾§è¾¹æ ç¤¾äº¤é“¾æ¥å¼€å¯æ‰“èµåŠŸèƒ½è®¾ç½®å‹æƒ…é“¾æ¥è…¾è®¯å…¬ç›Š404é¡µé¢ç«™ç‚¹å»ºç«‹æ—¶é—´è®¢é˜…å¾®ä¿¡å…¬ä¼—å·è®¾ç½®ã€ŒåŠ¨ç”»æ•ˆæœã€è®¾ç½®ã€ŒèƒŒæ™¯åŠ¨ç”»ã€ä¸‹ä¸€æ¬¡æˆ‘å°†é’ˆå¯¹Pureè¿›è¡Œä¸»é¢˜æ–¹é¢çš„ç›¸å…³é…ç½®ï¼Œä»¥åŠè®²è§£ä¸€ä¸‹hexoä¸»é¢˜çš„çš„å®ç°åŸç†çš„ã€‚è¿™æ ·ä½ ä»¬é’ˆå¯¹ä¸åŒçš„ä¸»é¢˜ä¹Ÿå°±éƒ½èƒ½é…ç½®äº†ã€‚","categories":[{"name":"hexo","slug":"hexo","permalink":"http://www.liuyong520.cn/categories/hexo/"}],"tags":[{"name":"hexo","slug":"hexo","permalink":"http://www.liuyong520.cn/tags/hexo/"}]},{"title":"Hexoä¹‹ç¯å¢ƒæ­å»º","slug":"hexo-install","date":"2017-08-27T02:56:51.000Z","updated":"2019-04-27T12:11:10.273Z","comments":true,"path":"2017/08/27/hexo-install/","link":"","permalink":"http://www.liuyong520.cn/2017/08/27/hexo-install/","excerpt":"","text":"å¦‚æœä½ å’Œæˆ‘ä¸€æ ·æ˜¯å°ç™½ï¼Œé‚£ä¹ˆæ­å–œä½ ï¼çœ‹å®Œè¿™ç¯‡æ–‡ç« ï¼Œä½ ä¹Ÿå¯ä»¥æ‹¥æœ‰ä¸€ä¸ªè¿™æ ·çš„åšå®¢å•¦ï¼å‰è¨€åœ¨ä»¥å‰æˆ‘ä»¬è¦ç»´æŠ¤ä¸€ä¸ªä¸“å±äºè‡ªå·±çš„blogï¼Œæ˜¯æ¯”è¾ƒéº»çƒ¦çš„ï¼Œè¦è´­ä¹°æœåŠ¡å™¨ï¼Œéƒ¨ç½²åšå®¢ç¨‹åºåˆ°æœåŠ¡å™¨ï¼Œè¿˜è¦ç»´æŠ¤ç›¸å…³æ•°æ®å’Œç½‘ç»œã€‚è¿™ä¸€ç±»blogæœ€ä¸ºå…¸å‹çš„ä¾‹å­å°±æ˜¯WordPressã€‚è€Œä»Šå¤©æˆ‘ä»¬è¦ä»‹ç»çš„æ˜¯å¦‚ä½•åŸºäºHexoåšå®¢å¿«é€Ÿçš„æ­å»ºæˆ‘ä»¬è‡ªå·±æœåŠ¡å™¨ç³»åˆ—ã€‚hexoä»‹ç»Hexo æ˜¯ä¸€ä¸ªå¿«é€Ÿã€ç®€æ´ä¸”é«˜æ•ˆçš„åšå®¢æ¡†æ¶ã€‚Hexo ä½¿ç”¨ Markdownï¼ˆæˆ–å…¶ä»–æ¸²æŸ“å¼•æ“ï¼‰è§£ææ–‡ç« ï¼Œåœ¨å‡ ç§’å†…ï¼Œå³å¯åˆ©ç”¨é“ä¸½çš„ä¸»é¢˜ç”Ÿæˆé™æ€ç½‘é¡µã€‚hexoå®‰è£…hexo æ˜¯åŸºäºnode.jsç¯å¢ƒçš„ï¼Œæ‰€ä»¥å®‰è£…å‰ï¼Œæ‚¨å¿…é¡»æ£€æŸ¥ç”µè„‘ä¸­æ˜¯å¦å·²å®‰è£…ä¸‹åˆ—åº”ç”¨ç¨‹åºï¼šnode.jså¦‚æœæ‚¨çš„ç”µè„‘ä¸­å·²ç»å®‰è£…ä¸Šè¿°å¿…å¤‡ç¨‹åºï¼Œé‚£ä¹ˆæ­å–œæ‚¨ï¼æ¥ä¸‹æ¥åªéœ€è¦ä½¿ç”¨ npm å³å¯å®Œæˆ Hexo çš„å®‰è£…ã€‚1$ npm install -g hexo-cliå¦‚æœæ‚¨çš„ç”µè„‘ä¸­æœªå®‰è£…Nodeï¼Œé‚£ä¹ˆå°±éœ€è¦å®‰è£…Node.jsè¯¦ç»†å®‰è£…æ­¥éª¤å‚è€ƒï¼šhttp://www.liuyong520.cn/2017/08/26/nodejs-install/å†å®‰è£…Hexoï¼Œåœ¨å‘½ä»¤è¡Œï¼ˆå³Git Bashï¼‰è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š1npm install -g hexo-cliè‡³æ­¤Hexoçš„ç¯å¢ƒå°±æ­å»ºå¥½äº†ï¼Œä¸‹ä¸€æ­¥éªŒè¯ä¸€ä¸‹hexo123456789101112131415161718MacBook-Pro:_posts xxydliuyss$ hexo versionhexo: 3.8.0hexo-cli: 1.1.0os: Darwin 18.5.0 darwin x64http_parser: 2.8.0node: 10.15.3v8: 6.8.275.32-node.51uv: 1.23.2zlib: 1.2.11ares: 1.15.0modules: 64nghttp2: 1.34.0napi: 3openssl: 1.1.0jicu: 62.1unicode: 11.0cldr: 33.1tz: 2018eè¿™æ ·hexoå°±å®‰è£…å®Œæˆäº†hexoå‘½ä»¤ä»‹ç»å®˜ç½‘å·²ç»ä»‹ç»çš„æ¯”è¾ƒè¯¦ç»†äº†è¿™é‡Œå°±ä¸å†èµ˜è¿°äº†è¯¦æƒ…è¯·çœ‹å®˜æ–¹å‘½ä»¤åœ°å€ï¼šhttps://hexo.io/zh-cn/docs/commandshexoå¿«é€Ÿæ–°å»ºåšå®¢åˆå§‹åŒ–Hexoï¼Œåœ¨å‘½ä»¤è¡Œï¼ˆå³Git Bashï¼‰ä¾æ¬¡è¿è¡Œä»¥ä¸‹å‘½ä»¤å³å¯ï¼šä»¥ä¸‹ï¼Œå³å­˜æ”¾Hexoåˆå§‹åŒ–æ–‡ä»¶çš„è·¯å¾„ï¼Œ å³ç«™ç‚¹ç›®å½•ã€‚123$ hexo init myproject$ cd myproject$ npm installæ–°å»ºå®Œæˆåï¼Œåœ¨è·¯å¾„ä¸‹ï¼Œä¼šäº§ç”Ÿè¿™äº›æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ï¼š123456789$ tree.â”œâ”€â”€ _config.ymlâ”œâ”€â”€ package.jsonâ”œâ”€â”€ scaffoldsâ”œâ”€â”€ source| â”œâ”€â”€ _drafts| â””â”€â”€ _postsâ””â”€â”€ themesç›®å½•åæˆ–è€…æ–‡ä»¶åè¯¦æƒ…ä»‹ç»_config.ymlhexo å…¨å±€é…ç½®æ–‡ä»¶package.jsonnodejs åŒ…é…ç½®æ–‡ä»¶scaffoldshexoæ¨¡ç‰ˆæ–‡ä»¶å¤¹hexo new filename ä¼šå¯¹åº”æ ¹æ®æ¨¡ç‰ˆæ–‡ä»¶ç”Ÿæˆæ–‡ä»¶sourceé¡¹ç›®æºä»£ç æ–‡ä»¶ç›®å½•_draftsä¸ºè‰ç¨¿åŸæ–‡ä»¶ç›®å½•_postsé¡¹ç›®å‘å¸ƒæ–‡ä»¶ç›®å½• é¡¹ç›®æœ€ç»ˆä¼šæ ¹æ®è¿™ä¸ªç›®å½•ä¸‹çš„æ–‡ä»¶ç”Ÿæˆhtmlthemesåšå®¢ä¸»é¢˜å­˜æ”¾ç›®å½•æ³¨ï¼šhexoç›¸å…³å‘½ä»¤å‡åœ¨ç«™ç‚¹ç›®å½•ä¸‹ï¼Œç”¨Git Bashè¿è¡Œã€‚ç«™ç‚¹é…ç½®æ–‡ä»¶ï¼šç«™ç‚¹ç›®å½•ä¸‹çš„_config.ymlã€‚â€‹ è·¯å¾„ä¸º_config.ymlä¸»é¢˜é…ç½®æ–‡ä»¶ï¼šç«™ç‚¹ç›®å½•ä¸‹çš„themesæ–‡ä»¶å¤¹ä¸‹çš„ï¼Œä¸»é¢˜æ–‡ä»¶å¤¹ä¸‹çš„_config.ymlã€‚â€‹ è·¯å¾„ä¸º\\themes\\&lt;ä¸»é¢˜æ–‡ä»¶å¤¹&gt;_config.ymlå¯åŠ¨æœåŠ¡å™¨ã€‚åœ¨è·¯å¾„ä¸‹ï¼Œå‘½ä»¤è¡Œï¼ˆå³Git Bashï¼‰è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼Œè¿è¡Œå³å¯ï¼š1hexo serveræµè§ˆå™¨è®¿é—®ç½‘å€ï¼š http://localhost:4000/ å°±å¯ä»¥é¢„è§ˆåšå®¢äº†ä¸‹ä¸€ç¯‡ æˆ‘å°†ä»‹ç»å¦‚ä½•æ­å»ºè‡ªå·±çš„blog","categories":[{"name":"hexo","slug":"hexo","permalink":"http://www.liuyong520.cn/categories/hexo/"}],"tags":[{"name":"hexo","slug":"hexo","permalink":"http://www.liuyong520.cn/tags/hexo/"}]},{"title":"node.jsç¯å¢ƒæ­å»º","slug":"nodejs-install","date":"2017-08-26T01:56:51.000Z","updated":"2019-04-27T09:42:47.606Z","comments":true,"path":"2017/08/26/nodejs-install/","link":"","permalink":"http://www.liuyong520.cn/2017/08/26/nodejs-install/","excerpt":"","text":"å®‰è£…node.jsç™»å½•å®˜ç½‘ä¸‹è½½å¯¹åº”çš„exeå®‰è£…åŒ…ã€‚ä¸‹è½½åœ°å€ä¸ºï¼šä½ å¯ä»¥æ ¹æ®ä¸åŒå¹³å°ç³»ç»Ÿé€‰æ‹©ä½ éœ€è¦çš„Node.jså®‰è£…åŒ…ã€‚Node.js å†å²ç‰ˆæœ¬ä¸‹è½½åœ°å€ï¼šhttps://nodejs.org/dist/æ³¨æ„ï¼šLinuxä¸Šå®‰è£…Node.jséœ€è¦å®‰è£…Python 2.6 æˆ– 2.7 ï¼Œä¸å»ºè®®å®‰è£…Python 3.0ä»¥ä¸Šç‰ˆæœ¬ã€‚windows ä¸Šå®‰è£… node.jsä½ å¯ä»¥é‡‡ç”¨ä»¥ä¸‹ä¸¤ç§æ–¹å¼æ¥å®‰è£…ã€‚1ã€Windows å®‰è£…åŒ…(.msi)32 ä½å®‰è£…åŒ…ä¸‹è½½åœ°å€ : https://nodejs.org/dist/v4.4.3/node-v4.4.3-x86.msi64 ä½å®‰è£…åŒ…ä¸‹è½½åœ°å€ : https://nodejs.org/dist/v4.4.3/node-v4.4.3-x64.msiæœ¬æ–‡å®ä¾‹ä»¥ v0.10.26 ç‰ˆæœ¬ä¸ºä¾‹ï¼Œå…¶ä»–ç‰ˆæœ¬ç±»ä¼¼ï¼Œ å®‰è£…æ­¥éª¤ï¼šæ­¥éª¤ 1 : åŒå‡»ä¸‹è½½åçš„å®‰è£…åŒ… v0.10.26ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼šæ­¥éª¤ 2: ç‚¹å‡»ä»¥ä¸Šçš„Run(è¿è¡Œ)ï¼Œå°†å‡ºç°å¦‚ä¸‹ç•Œé¢ï¼šæ­¥éª¤ 3 : å‹¾é€‰æ¥å—åè®®é€‰é¡¹ï¼Œç‚¹å‡» nextï¼ˆä¸‹ä¸€æ­¥ï¼‰ æŒ‰é’® :æ­¥éª¤ 4 : Node.jsé»˜è®¤å®‰è£…ç›®å½•ä¸º â€œC:\\Program Files\\nodejs\\â€ , ä½ å¯ä»¥ä¿®æ”¹ç›®å½•ï¼Œå¹¶ç‚¹å‡» nextï¼ˆä¸‹ä¸€æ­¥ï¼‰ï¼šæ­¥éª¤ 5 : ç‚¹å‡»æ ‘å½¢å›¾æ ‡æ¥é€‰æ‹©ä½ éœ€è¦çš„å®‰è£…æ¨¡å¼ , ç„¶åç‚¹å‡»ä¸‹ä¸€æ­¥ nextï¼ˆä¸‹ä¸€æ­¥ï¼‰æ­¥éª¤ 6 :ç‚¹å‡» Installï¼ˆå®‰è£…ï¼‰ å¼€å§‹å®‰è£…Node.jsã€‚ä½ ä¹Ÿå¯ä»¥ç‚¹å‡» Backï¼ˆè¿”å›ï¼‰æ¥ä¿®æ”¹å…ˆå‰çš„é…ç½®ã€‚ ç„¶åå¹¶ç‚¹å‡» nextï¼ˆä¸‹ä¸€æ­¥ï¼‰ï¼šç‚¹å‡» Finishï¼ˆå®Œæˆï¼‰æŒ‰é’®é€€å‡ºå®‰è£…å‘å¯¼ã€‚æ£€æµ‹PATHç¯å¢ƒå˜é‡æ˜¯å¦é…ç½®äº†Node.jsï¼Œç‚¹å‡»å¼€å§‹=ã€‹è¿è¡Œ=ã€‹è¾“å…¥â€cmdâ€ =&gt; è¾“å…¥å‘½ä»¤â€pathâ€ï¼Œè¾“å‡ºå¦‚ä¸‹ç»“æœï¼š12345PATH=C:\\oraclexe\\app\\oracle\\product\\10.2.0\\server\\bin;C:\\Windows\\system32;C:\\Windows;C:\\Windows\\System32\\Wbem;C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\;c:\\python32\\python;C:\\MinGW\\bin;C:\\Program Files\\GTK2-Runtime\\lib;C:\\Program Files\\MySQL\\MySQL Server 5.5\\bin;C:\\Program Files\\nodejs\\;C:\\Users\\rg\\AppData\\Roaming\\npmæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç¯å¢ƒå˜é‡ä¸­å·²ç»åŒ…å«äº†C:\\Program Files\\nodejs\\æ£€æŸ¥Node.jsç‰ˆæœ¬12E:\\&gt; node --versionv0.10.262ã€Windows äºŒè¿›åˆ¶æ–‡ä»¶ (.exe)å®‰è£…32 ä½å®‰è£…åŒ…ä¸‹è½½åœ°å€ : http://nodejs.org/dist/v0.10.26/node.exe64 ä½å®‰è£…åŒ…ä¸‹è½½åœ°å€ : http://nodejs.org/dist/v0.10.26/x64/node.exeå®‰è£…æ­¥éª¤æ­¥éª¤ 1 : åŒå‡»ä¸‹è½½çš„å®‰è£…åŒ… Node.exe ï¼Œå°†å‡ºç°å¦‚ä¸‹ç•Œé¢ :ç‚¹å‡» Runï¼ˆè¿è¡Œï¼‰æŒ‰é’®å°†å‡ºç°å‘½ä»¤è¡Œçª—å£ï¼šç‰ˆæœ¬æµ‹è¯•è¿›å…¥ node.exe æ‰€åœ¨çš„ç›®å½•ï¼Œå¦‚ä¸‹æ‰€ç¤ºå¦‚æœä½ è·å¾—ä»¥ä¸Šè¾“å‡ºç»“æœï¼Œè¯´æ˜ä½ å·²ç»æˆåŠŸå®‰è£…äº†Node.jsã€‚linuxå®‰è£…node.jsç›´æ¥ä½¿ç”¨å·²ç¼–è¯‘å¥½çš„åŒ…Node å®˜ç½‘å·²ç»æŠŠ linux ä¸‹è½½ç‰ˆæœ¬æ›´æ”¹ä¸ºå·²ç¼–è¯‘å¥½çš„ç‰ˆæœ¬äº†ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä¸‹è½½è§£å‹åä½¿ç”¨ï¼š12345# wget https://nodejs.org/dist/v10.9.0/node-v10.9.0-linux-x64.tar.xz // ä¸‹è½½# tar xf node-v10.9.0-linux-x64.tar.xz // è§£å‹# cd node-v10.9.0-linux-x64/ // è¿›å…¥è§£å‹ç›®å½•# ./bin/node -v // æ‰§è¡Œnodeå‘½ä»¤ æŸ¥çœ‹ç‰ˆæœ¬v10.9.0è§£å‹æ–‡ä»¶çš„ bin ç›®å½•åº•ä¸‹åŒ…å«äº† nodeã€npm ç­‰å‘½ä»¤ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ ln å‘½ä»¤æ¥è®¾ç½®è½¯è¿æ¥12ln -s /usr/software/nodejs/bin/npm /usr/local/bin/ ln -s /usr/software/nodejs/bin/node /usr/local/bin/Ubuntu æºç å®‰è£… Node.jsä»¥ä¸‹éƒ¨åˆ†æˆ‘ä»¬å°†ä»‹ç»åœ¨ Ubuntu Linux ä¸‹ä½¿ç”¨æºç å®‰è£… Node.js ã€‚ å…¶ä»–çš„ Linux ç³»ç»Ÿï¼Œå¦‚ Centos ç­‰ç±»ä¼¼å¦‚ä¸‹å®‰è£…æ­¥éª¤ã€‚åœ¨ Github ä¸Šè·å– Node.js æºç ï¼š12$ sudo git clone https://github.com/nodejs/node.gitCloning into &apos;node&apos;...ä¿®æ”¹ç›®å½•æƒé™ï¼š1$ sudo chmod -R 755 nodeä½¿ç”¨ ./configure åˆ›å»ºç¼–è¯‘æ–‡ä»¶ï¼Œå¹¶æŒ‰ç…§ï¼š1234$ cd node$ sudo ./configure$ sudo make$ sudo make installæŸ¥çœ‹ node ç‰ˆæœ¬ï¼š12$ node --versionv0.10.25Ubuntu apt-getå‘½ä»¤å®‰è£…å‘½ä»¤æ ¼å¼å¦‚ä¸‹ï¼š12sudo apt-get install nodejssudo apt-get install npmCentOS ä¸‹æºç å®‰è£… Node.js1ã€ä¸‹è½½æºç ï¼Œä½ éœ€è¦åœ¨https://nodejs.org/en/download/ ä¸‹è½½æœ€æ–°çš„Nodejsç‰ˆæœ¬ï¼Œæœ¬æ–‡ä»¥v0.10.24ä¸ºä¾‹:12cd /usr/local/src/wget http://nodejs.org/dist/v0.10.24/node-v0.10.24.tar.gz2ã€è§£å‹æºç 1tar zxvf node-v0.10.24.tar.gz3ã€ ç¼–è¯‘å®‰è£…1234cd node-v0.10.24./configure --prefix=/usr/local/node/0.10.24makemake install4ã€ é…ç½®NODE_HOMEï¼Œè¿›å…¥profileç¼–è¾‘ç¯å¢ƒå˜é‡1vim /etc/profileè®¾ç½®nodejsç¯å¢ƒå˜é‡ï¼Œåœ¨ export PATH USER LOGNAME MAIL HOSTNAME HISTSIZE HISTCONTROL ä¸€è¡Œçš„ä¸Šé¢æ·»åŠ å¦‚ä¸‹å†…å®¹:123#set for nodejsexport NODE_HOME=/usr/local/node/0.10.24export PATH=$NODE_HOME/bin:$PATH:wqä¿å­˜å¹¶é€€å‡ºï¼Œç¼–è¯‘/etc/profile ä½¿é…ç½®ç”Ÿæ•ˆ1source /etc/profileéªŒè¯æ˜¯å¦å®‰è£…é…ç½®æˆåŠŸ1node -vè¾“å‡º v0.10.24 è¡¨ç¤ºé…ç½®æˆåŠŸnpmæ¨¡å—å®‰è£…è·¯å¾„:1/usr/local/node/0.10.24/lib/node_modules/æ³¨ï¼šNodejs å®˜ç½‘æä¾›äº†ç¼–è¯‘å¥½çš„LinuxäºŒè¿›åˆ¶åŒ…ï¼Œä½ ä¹Ÿå¯ä»¥ä¸‹è½½ä¸‹æ¥ç›´æ¥åº”ç”¨ã€‚Mac OS ä¸Šå®‰è£…ä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼åœ¨ Mac OS ä¸Šæ¥å®‰è£… nodeï¼š1ã€åœ¨å®˜æ–¹ä¸‹è½½ç½‘ç«™ä¸‹è½½ pkg å®‰è£…åŒ…ï¼Œç›´æ¥ç‚¹å‡»å®‰è£…å³å¯ã€‚2ã€ä½¿ç”¨ brew å‘½ä»¤æ¥å®‰è£…ï¼š1brew install node","categories":[{"name":"node","slug":"node","permalink":"http://www.liuyong520.cn/categories/node/"}],"tags":[{"name":"node","slug":"node","permalink":"http://www.liuyong520.cn/tags/node/"}]},{"title":"xsync åŒæ­¥å‘½ä»¤è„šæœ¬å’Œxcallè¿œç¨‹æ‰§è¡Œå‘½ä»¤è„šæœ¬","slug":"xsync","date":"2017-03-28T16:18:32.000Z","updated":"2019-04-28T16:40:15.580Z","comments":true,"path":"2017/03/29/xsync/","link":"","permalink":"http://www.liuyong520.cn/2017/03/29/xsync/","excerpt":"","text":"ç¼˜ç”±åœ¨linuxæœåŠ¡å™¨é›†ç¾¤ä¸Šï¼Œæœ‰æ—¶æˆ‘ä»¬éœ€è¦å°†æ•°æ®ä»ä¸»æœåŠ¡å™¨åŒæ­¥åˆ°æ‰€æœ‰çš„ä»æœåŠ¡å™¨ä¸Šï¼Œæˆ–è€…åœ¨é›†ç¾¤é‡Œéœ€è¦æ‰§è¡Œä¸€æ¡æˆ–è€…å¤šæ¡å‘½ä»¤ï¼Œå¦‚æœä»¬ä¸€æ¬¡æ¬¡çš„æ‹·è´ï¼Œæˆ–è€…æ¯ä¸ªæœåŠ¡å™¨ä¸€æ¡æ¡çš„æ‰§è¡Œï¼Œä¼šé€ æˆé‡å¤çš„å·¥ä½œã€‚æ‰€ä»¥å°±å†™ä¸¤ä¸ªè„šæœ¬è§£å†³è¿™æ–¹é¢çš„é—®é¢˜ã€‚xsyncå‘½ä»¤çš„ç¼–å†™å®‰è£… syncå‘½ä»¤1yum install -y syncç¼–å†™è„šæœ¬ environment.sh12345#! /usr/bin/bash# é›†ç¾¤ IP æ•°ç»„export NODE_IPS=(172.16.18.198 172.16.18.199 172.16.18.200)# é›†ç¾¤å„ IP å¯¹åº”çš„ ä¸»æœºåæ•°ç»„export NODE_NAMES=(k8s-n1 k8s-n2 k8s-n3)ç¼–å†™xsyncjè€ƒæœ¬1234567891011121314151617181920212223242526272829303132333435363738394041424344#!/bin/bash# è·å–è¾“å‡ºå‚æ•°ï¼Œå¦‚æœæ²¡æœ‰å‚æ•°åˆ™ç›´æ¥è¿”å›pcount=$#if [ $pcount -eq 0 ]then echo &quot;no parameter find !&quot;; exit;fi# è·å–ä¼ è¾“æ–‡ä»¶åp1=$1filename=`basename $p1`echo &quot;load file $p1 success !&quot;# è·å–æ–‡ä»¶çš„ç»å¯¹è·¯å¾„pdir=`cd -P $(dirname $p1); pwd`echo &quot;file path is $pdir&quot;# è·å–å½“å‰ç”¨æˆ·ï¼ˆå¦‚æœæƒ³ä½¿ç”¨rootç”¨æˆ·æƒé™æ‹·è´æ–‡ä»¶ï¼Œåœ¨å‘½ä»¤ååŠ å…¥-rootå‚æ•°å³å¯ï¼‰user=$2case &quot;$user&quot; in&quot;-root&quot;) user=&quot;root&quot;;;&quot;&quot;) user=`whoami`;;*) echo &quot;illegal parameter $user&quot; esacecho $user# æ‹·è´æ–‡ä»¶åˆ°ä»æœº(è¿™é‡Œæ³¨æ„ä¸»æœºçš„hostéœ€è¦æ ¹æ®ä½ çš„å®é™…æƒ…å†µé…ç½®ï¼Œè¦ä¸ä½ å…·ä½“çš„ä¸»æœºåå¯¹åº”)source /opt/user/environment.shindex=0for node_ip in $&#123;NODE_IPS[@]&#125;do echo &quot;================current host is $&#123;NODE_NAMES[$index]&#125; ip is $&#123;node_ip&#125;=================&quot; rsync -rvl $pdir/$filename $user@$&#123;node_ip&#125;:$pdir index=`expr $index + 1`doneecho &quot;complete !&quot;xcallè„šæœ¬çš„ç¼–å†™åˆ©ç”¨sshå‘½ä»¤è¿œç¨‹æ‰§è¡Œè„šæœ¬å‘½ä»¤ã€‚è„šæœ¬å¦‚ä¸‹ï¼š12345678910111213141516171819202122232425#!/bin/bash# è·å–æ§åˆ¶å°æŒ‡ä»¤cmd=$*# åˆ¤æ–­æŒ‡ä»¤æ˜¯å¦ä¸ºç©ºif (( #$cmd -eq # ))then echo &quot;command can not be null !&quot; exitfi# è·å–å½“å‰ç™»å½•ç”¨æˆ·user=`whoami`source /opt/user/environment.sh# åœ¨ä»æœºæ‰§è¡ŒæŒ‡ä»¤,è¿™é‡Œéœ€è¦æ ¹æ®ä½ å…·ä½“çš„é›†ç¾¤æƒ…å†µé…ç½®ï¼Œhostä¸å…·ä½“ä¸»æœºåä¸€è‡´for node_ip in $&#123;NODE_IPS[@]&#125;do echo &quot;================current host is $&#123;node_ip&#125;=================&quot; echo &quot;--&gt; excute command \\&quot;$cmd\\&quot;&quot; ssh $user@$&#123;node_ip&#125; $cmddoneecho &quot;excute successfully !&quot;è¿™ä¸¤ä¸ªè„šæœ¬ä»…ä»…åªæ˜¯ä¸€ä¸ªç®€å•çš„è„šæœ¬ï¼Œæ¬¢è¿å¤§å®¶ä¿®æ”¹å’Œä½¿ç”¨ã€‚","categories":[{"name":"linux shell","slug":"linux-shell","permalink":"http://www.liuyong520.cn/categories/linux-shell/"}],"tags":[{"name":"linux","slug":"linux","permalink":"http://www.liuyong520.cn/tags/linux/"},{"name":"shell","slug":"shell","permalink":"http://www.liuyong520.cn/tags/shell/"}]}]}